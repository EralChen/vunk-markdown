import{k$ as b,aK as $,af as n,ag as r,ai as d,aG as y,aM as h,g6 as w,j as v,bM as O,dW as g,aF as _,oF as C,da as M,bS as V}from"./chunk-CuaFhuP3.js";import"./chunk-Dpk1TJd9.js";import{n as T}from"./chunk-DBIOSom4.js";const R=t=>{let e=class extends b.EsriPromiseMixin(t){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(i){this._userInteractive=i}get updating(){return!1}get visible(){return this.parent==null||this.parent.visible&&!this.parent.suspended}set visible(i){this._overrideIfSome("visible",i)}forceInteractive(){return this._interactiveViewModelCount++,$((()=>this._interactiveViewModelCount--))}};return n([r({constructOnly:!0})],e.prototype,"parent",void 0),n([r({constructOnly:!0})],e.prototype,"view",void 0),n([r({type:Boolean})],e.prototype,"interactive",null),n([r()],e.prototype,"_userInteractive",void 0),n([r({readOnly:!0})],e.prototype,"updating",null),n([r()],e.prototype,"visible",null),n([r()],e.prototype,"_interactiveViewModelCount",void 0),e=n([d("esri.views.3d.analysis.AnalysisView3D")],e),e};let p=class extends T{constructor(t){super(t)}initialize(){this.addHandles(y((()=>this.analysisViewData.visible),(t=>this.visible=t),h))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};p=n([d("esri.views.interactive.AnalysisToolBase")],p);function I(t,e){t.interactive=!0;const{tool:i,view:a}=t;a.activeTool=i;let s=C(e,(()=>{a.activeTool===i&&(a.activeTool=null)}));return w((async o=>{await M((()=>!t.tool?.active),o),s=V(s)}),e)}function S(t,e){return y((()=>t.interactive),(()=>A(t,e)),h)}function A(t,e){t.interactive?j(t,e):f(t)}function j(t,e){f(t);const{view:i,analysis:a}=t,s=new e({view:i,analysis:a,analysisViewData:t});return t.tool=s,i.tools.add(s),s}function f(t){const{view:e,tool:i}=t;i!=null&&(e.tools.remove(i),t.tool=null)}function x(t,e){const i=t.userOperation,a=w((async s=>{if(i){const l=i.promise.catch((()=>{}));i?.abort(),await l,v(s)}const o=I(t,{signal:s}),u=e?.shouldRejectOnCancel??(()=>!0),m=O([g((()=>t.tool),"cancel",(()=>{u()&&o.abort()}))]),{tool:c}=t;try{c&&(c.resetCreated(),e?.onToolActivated?.(c)),await o.promise,v(s)}catch(l){if(s.aborted||!_(l)||u())throw l}finally{m?.remove()}}),{signal:e?.abortOptions?.signal});return t.userOperation=a,a.promise.finally((()=>{t.userOperation===a&&(t.userOperation=null)}))}async function k(t,e){const i=t.analysis.clone();return await x(t,{abortOptions:e?.placementOptions,onToolActivated:e?.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:a}=t;return!a.valid||a.equals(i)}}),{}}export{k as d,f,S as m,p as o,R as s,x as y};
