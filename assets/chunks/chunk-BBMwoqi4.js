import{V as M,_ as P,b as S}from"./chunk-CiduJpHZ.js";import{V as R,M as z}from"./chunk-DH28KSeA.js";import{V as A,a as L}from"./chunk-CCAIAPAf.js";import{_ as O,E as U}from"./chunk-BHBEG1j6.js";import{d as j,t as D,aS as N,g as I,b as w,o as c,y as _,a as n,f as g,c as y,e as p,w as l,u as a,aT as J,aU as F,aV as X,aW as Y,a8 as x,ai as B,aq as T,aX as G,aY as W,ao as H,ap as K,q as Q,aO as Z}from"./chunk-Dpk1TJd9.js";/* empty css              */import{_ as ee}from"./chunk-MqrstuuK.js";const te=["disabled"],ae={class:"status-icon"},ne={class:"label"},se={class:"content"},oe={class:"error-message"},re=j({__name:"index",props:{modelValue:{type:Boolean,default:!0},content:{default:""},status:{default:"start"},disabled:{type:Boolean,default:!1},autoCollapse:{type:Boolean,default:!1},duration:{default:"0.2s"},buttonWidth:{default:"160px"},maxWidth:{default:"500px"},backgroundColor:{default:"#fcfcfc"},color:{default:"var(--el-color-info)"}},emits:["change","update:modelValue"],setup(v,{emit:h}){const t=v,o=h,s=D(t.modelValue);N(()=>t.modelValue,e=>{s.value=e});function r(){t.disabled||(s.value=!s.value,o("change",{value:s.value,status:t.status}),o("update:modelValue",s.value))}const i=I(()=>t.status==="error"?"思考过程中出现错误":t.content);return N(()=>t.status,e=>{e==="end"&&t.autoCollapse&&(s.value=!1,o("update:modelValue",s.value))}),(e,E)=>{const u=U;return c(),w("div",{class:"el-thinking",style:Q({"--el-thinking-button-width":t.buttonWidth,"--el-thinking-animation-duration":t.duration,"--el-thinking-content-wrapper-width":t.maxWidth,"--el-thinking-content-wrapper-background-color":t.backgroundColor,"--el-thinking-content-wrapper-color":t.color})},[_("button",{class:T(["trigger",[e.status,{disabled:!t.disabled}]]),disabled:t.disabled,onClick:r},[_("span",ae,[g(e.$slots,"status-icon",{status:t.status},()=>[e.status==="thinking"?(c(),y(u,{key:0,class:"is-loading el-icon-center"},{default:l(()=>[n(a(J))]),_:1})):p("",!0),e.status==="start"?(c(),y(u,{key:1,class:"el-icon-center start-color"},{default:l(()=>[n(a(F))]),_:1})):p("",!0),e.status==="end"?(c(),y(u,{key:2,class:"el-icon-center end-color"},{default:l(()=>[n(a(X))]),_:1})):p("",!0),e.status==="error"?(c(),y(u,{key:3,class:"el-icon-center error-color"},{default:l(()=>[n(a(Y))]),_:1})):p("",!0)],!0)]),_("span",ne,[g(e.$slots,"label",{status:t.status},()=>[x(B(e.status==="thinking"?"思考中...":e.status==="error"?"思考遇到问题":e.status==="end"?"思考完成":"开始思考"),1)],!0)]),n(W,{name:"rotate"},{default:l(()=>[t.disabled?p("",!0):(c(),w("span",{key:0,class:T(["arrow el-icon-center",{expanded:a(s)}])},[g(e.$slots,"arrow",{},()=>[n(u,{class:"el-icon-center"},{default:l(()=>[n(a(G))]),_:1})],!0)],2))]),_:3})],10,te),n(W,{name:"slide"},{default:l(()=>[a(i)?H((c(),w("div",{key:0,class:T(["content-wrapper",{"error-state":e.status==="error"}])},[_("div",se,[e.status!=="error"?g(e.$slots,"content",{key:0,content:a(i)},()=>[_("pre",null,B(a(i)),1)],!0):g(e.$slots,"error",{key:1,errorContent:a(i)},()=>[_("div",oe,B(a(i)),1)],!0)])],2)),[[K,a(s)]]):p("",!0)]),_:3})],4)}}}),le=O(re,[["__scopeId","data-v-059ddb88"]]);async function ie(v,h,t){return Z.reader({url:"/application/chat_message/d72c0954-819e-11f0-8636-062fece26b16",onmessage:v,abortController:t},{headers:{authorization:"application-9888ea942ed566bce1f7dc8cba294b46"},data:h})}const ue={key:0},me=j({__name:"AgentChatProvider",setup(v){const h=({message:o},{onSuccess:s,onError:r,onUpdate:i})=>{if(!o?.content)return;const e=[],E="assistant";let u=!0,C=!1;const d=new z,$=new AbortController;$.signal.addEventListener("abort",()=>{C=!0,u=!1,d.allViewUpdated(),d.getViews().length===0&&d.upsertView({content:"对话已取消",type:"text",updating:!1}),m()}),m(),ie(k=>{let f={content:"",reasoning_content:""};if(typeof k.data=="string")try{f=JSON.parse(k.data)}catch(b){r(b)}f.reasoning_content&&(u=!1,d.upsertView({content:f.reasoning_content,type:"thinking",updating:!0},{onCreate(b){const V=d.getPrevView(b);V&&(V.updating=!1)}}),m()),f.content&&(u=!1,d.upsertView({content:f.content,type:"text",updating:!0},{onCreate(b){const V=d.getPrevView(b);V&&(V.updating=!1)}}),m()),f.is_end&&(C=!0,d.allViewUpdated(),m(),q())},{message:o.content},$);function m(){const k={role:E,seviceLoading:u,seviceEnd:C,views:d.getViews(),abortController:$};i(k),e.push(k)}function q(){s(e)}},t=o=>{const s=o.views;let r=o.content??"";return s&&(r=s.reduce((i,e)=>(e.type==="thinking"?i+=[`:::thinking ${e.updating?"thinking":"end"}`,"```md",e.content,"```",":::"].join(`
`):i+=`
${e.content}`,i),"")),{role:o.role??"assistant",loading:o.seviceLoading===!0,content:r,abortController:o.abortController}};return(o,s)=>(c(),y(a(R),{request:h,parser:t},{default:l(()=>[n(a(A),null,{default:l(()=>[n(a(L),{"markdown-props":{containers:["thinking"],fences:["json"]}}),n(a(M),null,{default:l(()=>[n(a(P)),n(a(S),{type:"container:thinking"},{default:l(({raw:r})=>[n(a(le),{content:r.children[0].content,status:r.open.info.split(" ")[1]||"thinking"},null,8,["content","status"])]),_:1}),n(a(S),{type:"fence:json"},{default:l(({raw:r})=>[r.info.split(" ")[1]==="layer"?(c(),w("ul",ue,[n(ee,{data:JSON.parse(r.content)},null,8,["data"])])):p("",!0)]),_:1}),g(o.$slots,"default")]),_:3})]),_:3})]),_:3}))}});export{me as _};
