const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/chunk-n2rRX5kf.js","assets/chunks/chunk-BLrLWCUc.js","assets/chunks/chunk-CWUYlh1e.js","assets/chunks/chunk-BDqMgIU1.js","assets/static/onCreateApp.DRclb75I.css","assets/static/src_layouts_default_aside-6ea01de8.BjbON5Ij.css","assets/static/src_layouts_default_navbar-403af73f.u3IytZI2.css","assets/static/vitepress_components_VPDocOutlineItem-0942cada.tkRPm3MX.css","assets/static/vitepress_components_VPDocAsideOutline-b0d47973.Ds9uynvM.css","assets/static/src_styles_common_reset-f7a68b0e.BAKp5MHC.css","assets/static/src_styles_common_color-a7a524c7.CVau4Kly.css","assets/static/src_styles_common_is-19c6c24d.DKAKruk7.css","assets/static/style-96df6854.BAFyCb-T.css","assets/static/style-a1e6feee.Beul3IQx.css","assets/static/src_styles_element-plus_reset-752cc03d.htEpr2M-.css","assets/static/src_styles_element-plus_form-item-877afd6a.Dy4HJB2K.css","assets/static/src_styles_element-plus_table-6cbc5816.DXG1SsxY.css","assets/static/src_styles_element-plus_tabs-67d1a98b.BMDMQPDv.css","assets/static/src_styles_element-plus_tree-cc28503d.nmT5n0wM.css","assets/static/src_styles_element-plus_dialog-7f91a00e.D4nTsJge.css","assets/static/src_styles_element-plus_breadcrumb-8ce3a1a1.CwEEGJYc.css","assets/static/src_styles_element-plus_menu-33b44202.hFAFO4eV.css","assets/static/style-972dd62f.DKHZNGtr.css","assets/static/style-bf255db2.BBK-T9RK.css","assets/static/style-d089cd8f.Cc2PI5FU.css","assets/static/style-f1e9d87d.LlbyWA9E.css","assets/static/style-51eec318.o0zCZ1y4.css","assets/static/src_styles_form_sub-7371c85e.y3zh-mS3.css","assets/static/src_styles_layout_index-2891f17b.BNCqvENj.css","assets/static/style-ab3e4bd5.BuWAVw4m.css","assets/static/style-347ea3e4.CRScSR0a.css","assets/static/style-1a418a90.BZwgKm1s.css","assets/static/style-f7ca24cc.CFNWXuiE.css","assets/static/style-3993dd47.X9gIGpBH.css","assets/static/style-4af18548.Di2LGzYR.css","assets/static/style-cdb3fcab.C8H6Fcyw.css","assets/static/src_styles_markdown_reset-fbd16bdd.D3vNaEcf.css","assets/static/src_styles_markdown_shiki-0d2326df.uut6VZYd.css","assets/static/style-adaa428b.6mnjyT16.css","assets/static/style-a769b432.ChwmoEkt.css","assets/static/pages_uno-88a4f3d7.BFEw1PGl.css","assets/chunks/chunk-DRGGKcD7.js","assets/chunks/chunk-CCSNrXQF.js","assets/chunks/chunk-CtogMB2t.js"])))=>i.map(i=>d[i]);
import{_ as S}from"./chunk-CWUYlh1e.js";import{gG as K,ha as Q,b2 as X,dc as ee,Y as te,bh as se,bw as re,bc as k,gT as oe,p_ as ne,iq as ie,ir as ae,is as ce}from"./chunk-BLrLWCUc.js";import{r as O}from"./chunk-DiS1oclg.js";var N,g;(function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"})(N||(N={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}(g||(g={}));function fe(){return j||(j=new Promise(e=>S(()=>import("./chunk-n2rRX5kf.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40])).then(t=>t.i).then(({default:t})=>{const s=t({locateFile:ue,onRuntimeInitialized:()=>e(s)});delete s.then})).catch(e=>{throw e})),j}function ue(e){return K(`esri/libs/i3s/${e}`)}let j;class le{constructor(t,s,n,o,f,a){this.layout=t,this.interleavedVertexData=s,this.indices=n,this.hasColors=o,this.hasModifications=f,this.positionData=a}}let he=class{constructor(t,s,n,o,f,a,u){this.componentOffsets=t,this.featureIds=s,this.anchorIds=n,this.anchors=o,this.transformedGeometry=f,this.globalTrafo=a,this.obb=u}};class Ne extends Q{constructor(t){super("SceneLayerWorker","process",{process:s=>[s.geometryBuffer],project:s=>[s.positions.buffer],transformNormals:s=>[s.normals.buffer]},t,{hasInitialize:!0})}setModifications(t,s,n,o){const f={context:t,modifications:pe(s,n,o),isGeodetic:o.isGeographic};this.broadcast(f,"setModifications")}setLegacySchema(t,s){const n=JSON.stringify(s);return this.broadcast({context:t,jsonSchema:n},"setLegacySchema")}destroyContext(t){return this.broadcast(t,"destroyContext")}project(t,s){return this.invokeMethod("project",t,s)}transformNormals(t,s){return this.invokeMethod("transformNormals",t,s)}}const r=new X({deallocator:null}),I=se();function pe(e,t,s){r.clear();let n=1/0,o=1/0,f=-1/0,a=-1/0,u=!1;for(const p of t){const w=p.type==="clip"?g.Inside:p.type==="mask"?g.Outside:g.Replace,m=p.geometry;let b=h=>h;if(m.spatialReference){if(!ee(m.spatialReference,s)){te.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}b=h=>(re(h,m.spatialReference,I,s),I)}else m.hasZ||(I[2]=0,b=h=>(I[0]=h[0],I[1]=h[1],I));u=u||w===g.Outside,r.push(w),r.push(m.rings.length);for(const h of m.rings){r.push(h.length);for(const E of h){const l=b(E);r.push(l[0]),r.push(l[1]),r.push(l[2]),n=Math.min(n,l[0]),o=Math.min(o,l[1]),f=Math.max(f,l[0]),a=Math.max(a,l[1])}}}e!=null&&(u?(r.push(g.Inside),r.push(2),r.push(4),r.push(n-1e-4),r.push(o-1e-4),r.push(0),r.push(f+1e-4),r.push(o-1e-4),r.push(0),r.push(f+1e-4),r.push(a+1e-4),r.push(0),r.push(n-1e-4),r.push(a+1e-4),r.push(0),r.push(4),r.push(e[0]),r.push(e[1]),r.push(0),r.push(e[2]),r.push(e[1]),r.push(0),r.push(e[2]),r.push(e[3]),r.push(0),r.push(e[0]),r.push(e[3]),r.push(0)):(r.push(g.Outside),r.push(1),r.push(4),r.push(e[0]),r.push(e[1]),r.push(0),r.push(e[2]),r.push(e[1]),r.push(0),r.push(e[2]),r.push(e[3]),r.push(0),r.push(e[0]),r.push(e[3]),r.push(0))),r.push(g.Finished);const d=new Float64Array(r.length);for(let p=0;p<r.length;++p)d[p]=r.at(p);return d}async function de(e){i=await x();const t=[e.geometryBuffer];return{result:H(i,e,t),transferList:t}}async function me(e){i=await x();const t=[e.geometryBuffer],{geometryBuffer:s}=e,n=s.byteLength,o=i._malloc(n),f=new Uint8Array(i.HEAPU8.buffer,o,n);f.set(new Uint8Array(s));const a=i.dracoDecompressPointCloudData(o,f.byteLength);if(i._free(o),a.error.length>0)throw new Error(`i3s.wasm: ${a.error}`);const u=a.featureIds?.length>0?a.featureIds.slice():null,d=a.positions.slice();return u&&t.push(u.buffer),t.push(d.buffer),{result:{positions:d,featureIds:u},transferList:t}}async function ye(e){await x(),Y(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function be(e){await x(),z(e)}async function ge(e){i=await x(),i.setLegacySchema(e.context,e.jsonSchema)}async function we(e){const{localMatrix:t,origin:s,positions:n,vertexSpace:o}=e,f=k.fromJSON(e.inSpatialReference),a=k.fromJSON(e.outSpatialReference);let u;const[{projectBuffer:d},{initializeProjection:p}]=await Promise.all([S(()=>import("./chunk-BLrLWCUc.js").then(l=>l.Ly),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40])),S(()=>import("./chunk-BLrLWCUc.js").then(l=>l.Lz),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40]))]);await p(f,a);const w=[0,0,0];if(!d(s,f,0,w,a,0))throw new Error("Failed to project");if(o.type==="georeferenced"&&o.origin==null){if(u=new Float64Array(n.length),!d(n,f,0,u,a,0,u.length/3))throw new Error("Failed to project")}else{const l=o.type==="georeferenced"?oe.fromJSON(o):ne.fromJSON(o),{projectMeshVertexPositions:y}=await S(async()=>{const{projectMeshVertexPositions:L}=await import("./chunk-DRGGKcD7.js");return{projectMeshVertexPositions:L}},__vite__mapDeps([41,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,42,43])),_=y({vertexAttributes:{position:n},transform:t?{localMatrix:t}:void 0,vertexSpace:l,spatialReference:f},a);if(!_)throw new Error("Failed to project");u=_}const m=u.length,[b,h,E]=w;for(let l=0;l<m;l+=3)u[l]-=b,u[l+1]-=h,u[l+2]-=E;return{result:{projected:u,original:n,projectedOrigin:w},transferList:[u.buffer,n.buffer]}}async function _e({normalMatrix:e,normals:t}){const s=new Float32Array(t.length);return ie(s,t,e),ae(e)&&ce(s,s),{result:{transformed:s,original:t},transferList:[s.buffer,t.buffer]}}function Ee(e){G(e)}let Le,i;function z(e){if(!i)return;const t=e.modifications,s=i._malloc(8*t.length),n=new Float64Array(i.HEAPU8.buffer,s,t.length);for(let o=0;o<t.length;++o)n[o]=t[o];i.setModifications(e.context,s,t.length,e.isGeodetic),i._free(s)}function H(e,t,s){const{context:n,globalTrafo:o,mbs:f,obbData:a,elevationOffset:u,geometryBuffer:d,geometryDescriptor:p,indexToVertexProjector:w,vertexToRenderProjector:m}=t,b=e._malloc(d.byteLength),h=33,E=e._malloc(h*Float64Array.BYTES_PER_ELEMENT),l=new Uint8Array(e.HEAPU8.buffer,b,d.byteLength);l.set(new Uint8Array(d));const y=new Float64Array(e.HEAPU8.buffer,E,h);P(y,[NaN,NaN,NaN]);let _=y.byteOffset+3*y.BYTES_PER_ELEMENT,L=new Float64Array(y.buffer,_);P(L,o),_+=16*y.BYTES_PER_ELEMENT,L=new Float64Array(y.buffer,_),P(L,f),_+=4*y.BYTES_PER_ELEMENT,a&&(L=new Float64Array(y.buffer,_),P(L,a));const v=p,J={isDraco:!1,isLegacy:!1,color:t.layouts.some(A=>A.some(M=>M.name==="color")),normal:t.needNormals&&t.layouts.some(A=>A.some(M=>M.name==="normalCompressed")),uv0:t.layouts.some(A=>A.some(M=>M.name==="uv0")),uvRegion:t.layouts.some(A=>A.some(M=>M.name==="uvRegion")),featureIndex:v.featureIndex},c=e.process(n,!!t.obbData,b,l.byteLength,v,J,E,u,w,m,t.normalReferenceFrame);if(e._free(E),e._free(b),c.error.length>0)throw new Error(`i3s.wasm: ${c.error}`);if(c.discarded)return null;const R=c.componentOffsets.length>0?c.componentOffsets.slice():null,T=c.featureIds.length>0?c.featureIds.slice():null,W=c.anchorIds.length>0?Array.from(c.anchorIds):null,q=c.anchors.length>0?Array.from(c.anchors):null,F=c.interleavedVertedData.slice().buffer,$=c.indicesType===N.Int16?new Uint16Array(c.indices.buffer,c.indices.byteOffset,c.indices.byteLength/2).slice():new Uint32Array(c.indices.buffer,c.indices.byteOffset,c.indices.byteLength/4).slice(),U=c.positions.slice(),{buffer:D,byteOffset:B,byteLength:C}=c.positionIndices,V=c.positionIndicesType===N.Int16?new Uint16Array(D,B,C/2).slice():new Uint32Array(D,B,C/4).slice(),Z=new le(t.layouts[0],F,$,c.hasColors,c.hasModifications,{data:U,indices:V});return T&&s.push(T.buffer),R&&s.push(R.buffer),s.push(F),s.push($.buffer),s.push(U.buffer),s.push(V.buffer),new he(R,T,W,q,Z,o,c.obb)}function Ae(e){return e===0?O.Unmodified:e===1?O.PotentiallyModified:e===2?O.Culled:O.Unknown}function Y(e){if(!i)return;const{context:t,buffer:s}=e,n=i._malloc(s.byteLength),o=s.byteLength/Float64Array.BYTES_PER_ELEMENT,f=new Float64Array(i.HEAPU8.buffer,n,o),a=new Float64Array(s);f.set(a),i.filterOBBs(t,n,o),a.set(f),i._free(n)}function G(e){i&&i.destroy(e)===0&&(i=null)}function P(e,t){for(let s=0;s<t.length;++s)e[s]=t[s]}async function Me(){i||await x()}async function x(){return i||(i=await(Le??=fe())),i}const Ie={transform:(e,t)=>i&&H(i,e,t),destroy:G},Re=Object.freeze(Object.defineProperty({__proto__:null,destroyContext:Ee,dracoDecompressPointCloudData:me,filterObbsForModifications:ye,filterObbsForModificationsSync:Y,initialize:Me,interpretObbModificationResults:Ae,process:de,project:we,setLegacySchema:ge,setModifications:be,setModificationsSync:z,test:Ie,transformNormals:_e},Symbol.toStringTag,{value:"Module"}));export{Ae as L,Me as P,Y as S,Ne as a,Re as b,pe as f,z as j};
