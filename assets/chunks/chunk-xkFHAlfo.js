import{fJ as d,dh as f,gU as u,V as c,A as n,df as m,ai as l,aj as o,al as p}from"./chunk-DadqOv6U.js";import{l as g}from"./chunk-BWusSGZf.js";import{p as y}from"./chunk-DbeoITFD.js";import{i as I}from"./chunk-Cw2QZ3OE.js";import"./chunk-CPKck_yD.js";let r=class extends d(y(g(m))){constructor(){super(...arguments),this.type="wmts-3d"}initialize(){this._getCompatibleTileInfoMatrixSet((t=>this._getTileInfoSupportError(t.tileInfo,t.fullExtent)));const e=f((()=>this.view?.basemapTerrain?.tilingSchemeLocked)).then((()=>{const t=this._getCompatibleTileInfoMatrixSet((i=>this._getTileInfoError(i.tileInfo,i.fullExtent)));t!=null&&(t.id!==null&&this.layer.activeLayer.tileMatrixSetId!==t.id&&(this.layer.activeLayer.tileMatrixSetId=t.id),t.tileInfo&&(this.tileInfo=t.tileInfo),this.layer.fullExtent=t.fullExtent)}));this.addResolvingPromise(e),this.when((()=>this._postInitialize()))}refresh(){this.emit("data-changed")}canResume(){if(!super.canResume())return!1;const e=this.layer.activeLayer.tileMatrixSet;return e!=null&&!this._getTileInfoError(e.tileInfo,e.fullExtent)}async fetchTile(e,t){return I(this,e,t)}async doRefresh(){this.suspended||this.emit("data-changed")}_postInitialize(){this._updatingHandles.add((()=>this.layer?.activeLayer?.styleId),(()=>this.refresh())),this._updatingHandles.add((()=>this.layer?.activeLayer),(e=>{const t=this._getCompatibleTileInfoMatrixSet((i=>this._getTileInfoError(i.tileInfo,i.fullExtent)),!0);t&&t.id!=null&&e.tileMatrixSetId!==t.id&&(this.layer.activeLayer.tileMatrixSetId=t.id),this.notifyChange("suspended"),this.canResume()&&this.refresh()}))}_getCompatibleTileInfoMatrixSet(e,t=!1){const i=u(this.layer);if(i!=null){if(c.isCollection(i))return i.find((h=>{const s=e(h);return s!=null&&(t?n.getLogger(this).error("The selected tile matrix set is not compatible with the view",s):this.addResolvingPromise(Promise.reject(s))),s==null}));const a=e(i);return a!=null&&(t?n.getLogger(this).error("The selected tile matrix set is not compatible with the view",a):this.addResolvingPromise(Promise.reject(a))),i}return null}_getTileInfoError(e,t){return this._getTileInfoSupportError(e,t)||this._getTileInfoCompatibilityError(e,this.view.basemapTerrain.tilingScheme)}};l([o()],r.prototype,"layer",void 0),l([o()],r.prototype,"suspended",void 0),l([o()],r.prototype,"tileInfo",void 0),r=l([p("esri.views.3d.layers.WMTSLayerView3D")],r);const w=r;export{w as default};
