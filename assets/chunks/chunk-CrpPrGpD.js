const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/chunk-BjmYK-nx.js","assets/chunks/chunk-CET6Djna.js","assets/chunks/chunk-BoJEKryr.js","assets/chunks/chunk-B228RK-4.js"])))=>i.map(i=>d[i]);
import{_ as le}from"./chunk-BoJEKryr.js";import{r6 as ue,r7 as ce,r8 as I,ka as Y,lh as N,r9 as de,ra as me,rb as fe,kj as pe,jg as xe,b9 as F,ef as q,cq as he,rc as U,d3 as Te,gB as ge,n$ as be,k6 as Z,rd as J,gz as ye,nx as L,gA as D,kw as X,re as S,rf as $e,rg as we,rh as Re,nv as W,kN as z,ri as ve,bt as E,kv as Be,be as v,bo as B,kb as Me,jh as Se,kc as G,kd as H,ke as Ae,rj as Oe,rk as Ee,rl as Q,rm as _e,rn as ke,bm as Ie,o$ as Fe,ro as Le,rp as Ce}from"./chunk-CET6Djna.js";import{a as Pe}from"./chunk-CB8wlU_f.js";import{o as je,d as K}from"./chunk-HgJmq8b_.js";import{o as Ve,n as Ne}from"./chunk-DmZD3TxN.js";import{n as _}from"./chunk-B228RK-4.js";function M(r){if(r==null)return null;const t=r.offset!=null?r.offset:ue,o=r.rotation!=null?r.rotation:0,s=r.scale!=null?r.scale:ce,c=I(1,0,0,0,1,0,t[0],t[1],1),f=I(Math.cos(o),-Math.sin(o),0,Math.sin(o),Math.cos(o),0,0,0,1),a=I(s[0],0,0,0,s[1],0,0,0,1),i=Y();return N(i,f,a),N(i,c,i),i}class qe{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class Ue{constructor(t,o,s){this.name=t,this.lodThreshold=o,this.pivotOffset=s,this.stageResources=new qe,this.numberOfVertices=0}}async function De(r,t){const o=ee(Pe(r));if(o.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(o.url,t):de(o.url,t)),{engineResources:p,referenceBoundingBox:x}=me(l,t);return{lods:p,referenceBoundingBox:x,isEsriSymbolResource:!1,isWosr:!0}}let s;if(t.cache)s=await t.cache.loadGLTF(o.url,t,!!t.usePBR);else{const{loadGLTF:l}=await le(()=>import("./chunk-BjmYK-nx.js"),__vite__mapDeps([0,1,2,3]));s=await l(new fe(t.streamDataRequester),o.url,t,t.usePBR)}const c=s.model.meta?.ESRI_proxyEllipsoid,f=s.meta.isEsriSymbolResource&&c!=null&&s.meta.ESRI_webstyle==="EsriRealisticTreesStyle";f&&!s.customMeta.esriTreeRendering&&(s.customMeta.esriTreeRendering=!0,Qe(s,c));const a=!!t.usePBR,i=s.meta.isEsriSymbolResource?{usePBR:a,isSchematic:!1,treeRendering:f,mrrFactors:Le}:{usePBR:a,isSchematic:!1,treeRendering:!1,mrrFactors:Ce},u={...t.materialParameters,treeRendering:f},{engineResources:e,referenceBoundingBox:n}=We(s,i,u,t,o.specifiedLodIndex,f);return{lods:e,referenceBoundingBox:n,isEsriSymbolResource:s.meta.isEsriSymbolResource,isWosr:!1}}function ee(r){const t=r.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:r.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:r,specifiedLodIndex:null}:{fileType:"unknown",url:r,specifiedLodIndex:null}}function We(r,t,o,s,c,f){const a=r.model,i=new Array,u=new Map,e=new Map,n=a.lods.length,l=ye();return a.lods.forEach(((p,x)=>{const h=s.skipHighLods===!0&&(n>1&&x===0||n>3&&x===1)||s.skipHighLods===!1&&c!=null&&x!==c;if(h&&x!==0)return;const d=new Ue(p.name,p.lodThreshold,[0,0,0]);p.parts.forEach((T=>{const g=h?new L({},s):ze(a,T,d,t,o,u,e,s,f),{geometry:y,vertexCount:m}=Ge(T,g??new L({},s)),b=y.boundingInfo;b!=null&&x===0&&(D(l,b.bbMin),D(l,b.bbMax)),g!=null&&(d.stageResources.geometries.push(y),d.numberOfVertices+=m)})),h||i.push(d)})),{engineResources:i,referenceBoundingBox:l}}function ze(r,t,o,s,c,f,a,i,u){const e=r.materials.get(t.material);if(e==null)return null;const{normal:n,color:l,texCoord0:p,tangent:x}=t.attributes,h=t.material+(n?"_normal":"")+(l?"_color":"")+(p?"_texCoord0":"")+(x?"_tangent":""),d=t.attributes.texCoord0!=null,T=t.attributes.normal!=null,g=He(e.alphaMode);if(!f.has(h)){if(d){const R=(O,ne=!1,ae=!1)=>{if(O!=null&&!a.has(O)){const k=r.textures.get(O);if(k){const $=k.data,ie=ne&&!_($)?i.compressionOptions:void 0;a.set(O,new Fe(_($)?$.data:$,{...k.parameters,preMultiplyAlpha:!_($)&&ae,encoding:_($)?$.encoding:void 0,compressionOptions:ie}))}}},oe=g!==S.Opaque&&!u;R(e.colorTexture,oe,g!==S.Opaque),R(e.normalTexture),R(e.occlusionTexture,!0),R(e.emissiveTexture),R(e.metallicRoughnessTexture,!0)}const m=1/X,b=e.color[0]**m,C=e.color[1]**m,P=e.color[2]**m,re=e.emissiveFactor[0]**m,te=e.emissiveFactor[1]**m,se=e.emissiveFactor[2]**m,A=e.colorTexture!=null&&d?a.get(e.colorTexture):null,j=$e(e),V=e.normalTextureTransform?.scale!=null?e.normalTextureTransform?.scale:we;f.set(h,new L({...s,customDepthTest:ve.Lequal,textureAlphaMode:g,textureAlphaCutoff:e.alphaCutoff,diffuse:[b,C,P],ambient:[b,C,P],opacity:e.alphaMode==="OPAQUE"?1:e.opacity,doubleSided:e.doubleSided,doubleSidedType:"winding-order",cullFace:e.doubleSided?z.None:z.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:T?W.Attribute:W.ScreenDerivative,castShadows:!0,receiveShadows:e.receiveShadows,receiveAmbientOcclusion:e.receiveAmbientOcclusion,textureId:A?.id,colorMixMode:e.colorMixMode,normalTextureId:e.normalTexture!=null&&d?a.get(e.normalTexture).id:void 0,textureAlphaPremultiplied:A!=null&&!!A.parameters.preMultiplyAlpha,occlusionTextureId:e.occlusionTexture!=null&&d?a.get(e.occlusionTexture).id:void 0,emissiveTextureId:e.emissiveTexture!=null&&d?a.get(e.emissiveTexture).id:void 0,metallicRoughnessTextureId:e.metallicRoughnessTexture!=null&&d?a.get(e.metallicRoughnessTexture).id:void 0,emissiveBaseColor:[re,te,se],mrrFactors:j?Re:[e.metallicFactor,e.roughnessFactor,s.mrrFactors[2]],isSchematic:j,colorTextureTransformMatrix:M(e.colorTextureTransform),normalTextureTransformMatrix:M(e.normalTextureTransform),scale:[V[0],V[1]],occlusionTextureTransformMatrix:M(e.occlusionTextureTransform),emissiveTextureTransformMatrix:M(e.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:M(e.metallicRoughnessTextureTransform),...c},i))}const y=f.get(h);if(o.stageResources.materials.push(y),d){const m=b=>{b!=null&&o.stageResources.textures.push(a.get(b))};m(e.colorTexture),m(e.normalTexture),m(e.occlusionTexture),m(e.emissiveTexture),m(e.metallicRoughnessTexture)}return y}function Ge(r,t){const o=r.attributes.position.count,s=Ve(r.indices||o,r.primitiveType),c=E(3*o),{typedBuffer:f,typedBufferStride:a}=r.attributes.position;Be(c,f,r.transform,3,a);const i=[[v.POSITION,new B(c,s,3,!0)]];if(r.attributes.normal!=null){const e=E(3*o),{typedBuffer:n,typedBufferStride:l}=r.attributes.normal;Me(w,r.transform),Se(e,n,w,3,l),G(w)&&H(e,e),i.push([v.NORMAL,new B(e,s,3,!0)])}if(r.attributes.tangent!=null){const e=E(4*o),{typedBuffer:n,typedBufferStride:l}=r.attributes.tangent;Ae(w,r.transform),je(e,n,w,4,l),G(w)&&H(e,e,4),i.push([v.TANGENT,new B(e,s,4,!0)])}if(r.attributes.texCoord0!=null){const e=E(2*o),{typedBuffer:n,typedBufferStride:l}=r.attributes.texCoord0;Ne(e,n,2,l),i.push([v.UV0,new B(e,s,2,!0)])}const u=r.attributes.color;if(u!=null){const e=new Uint8Array(4*o);u.elementCount===4?u instanceof J?K(e,u,1,255):(u instanceof Oe||u instanceof Ee)&&K(e,u,1/255,255):(e.fill(255),u instanceof Z?Q(e,u.typedBuffer,1,255,4,u.typedBufferStride):(r.attributes.color instanceof _e||r.attributes.color instanceof ke)&&Q(e,u.typedBuffer,1/255,255,4,r.attributes.color.typedBufferStride)),i.push([v.COLOR,new B(e,s,4,!0)])}return{geometry:new Ie(t,i),vertexCount:o}}const w=Y();function He(r){switch(r){case"BLEND":return S.Blend;case"MASK":return S.Mask;case"OPAQUE":case null:case void 0:return S.Opaque}}function Qe(r,t){for(let o=0;o<r.model.lods.length;++o){const s=r.model.lods[o];for(const c of s.parts){const f=c.attributes.normal;if(f==null)return;const a=c.attributes.position,i=a.count,u=F(),e=F(),n=F(),l=new Float32Array(4*i),p=new Float32Array(3*i),x=pe(xe(),c.transform);let h=0,d=0;for(let T=0;T<i;T++){a.getVec(T,e),f.getVec(T,u),q(e,e,c.transform),he(n,e,t.center),U(n,n,t.radius);const g=n[2],y=Te(n),m=Math.min(.45+.55*y*y,1)**X;U(n,n,t.radius),x!==null&&q(n,n,x),ge(n,n),o+1!==r.model.lods.length&&r.model.lods.length>1&&be(n,n,u,g>-1?.2:Math.min(-4*g-3.8,1)),p[h]=n[0],p[h+1]=n[1],p[h+2]=n[2],h+=3,l[d]=m,l[d+1]=m,l[d+2]=m,l[d+3]=1,d+=4}c.attributes.normal=new Z(p),c.attributes.color=new J(l)}}}const rr=Object.freeze(Object.defineProperty({__proto__:null,fetch:De,parseUrl:ee},Symbol.toStringTag,{value:"Module"}));export{De as Y,rr as o,M as s};
