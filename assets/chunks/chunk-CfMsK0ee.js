import{ai as i,aj as n,al as O,gJ as S,gK as x,s as F,gi as L,gL as P,gM as $,z as A,gj as _,gN as s,gO as z}from"./chunk-CZWLvyZS.js";import{i as C}from"./chunk-D3a8VnAp.js";const J=E=>{let t=class extends E{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return C(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?S(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(l){try{return!this.layer.loaded||!!x(this.layer.serviceRasterInfo,l)}catch{return!1}}async fetchPopupFeaturesAtLocation(l,d){const{layer:e}=this;if(!l)throw new F("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:w}=e,R=L(e,d);if(!w||R==null)return[];const f=[],{value:o,magdirValue:h,processedValue:T}=await e.identify(l,{timeExtent:this.timeExtent,signal:d?.signal});let c="";if(o?.length){c=e.type==="imagery-tile"&&e.hasStandardTime()&&o[0]!=null?o.map((y=>e.getStandardTimeValue(y))).join(", "):o.join(", ");const r={ObjectId:0};r[s.servicePixelValue]=e.type==="imagery-tile"&&P(e.raster)?T?.join(", "):c,r[s.rawServicePixelValue]=c;const m=e.raster?.rasterInfo??e.serviceRasterInfo,p=m?.attributeTable;if(p!=null){const{fields:y,features:V}=p,v=y.find((({name:a})=>a.toLowerCase()==="value")),j=r[s.servicePixelValue],u=v?V.find((a=>String(a.attributes[v.name])===j)):null;if(u)for(const a in u.attributes)u.attributes.hasOwnProperty(a)&&(r[z+a]=u.attributes[a])}const g=m?.dataType;g!=="vector-magdir"&&g!=="vector-uv"||(r[s.magnitude]=h?.[0],r[s.direction]=h?.[1]);const{multidimensionalDefinition:b}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});$(e.rasterFields,r,b);const I=new A({geometry:this.fullExtent?.clone(),attributes:r,layer:e,sourceLayer:e});f.push(I)}return f}async getSourceScale(){return await this.layer.load(),_(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return x(this.layer.serviceRasterInfo,this.view.spatialReference)}};return i([n()],t.prototype,"fullExtent",null),i([n()],t.prototype,"layer",void 0),i([n({readOnly:!0})],t.prototype,"timeExtent",null),i([n()],t.prototype,"tileInfo",void 0),i([n({readOnly:!0})],t.prototype,"hasTilingEffects",null),i([n()],t.prototype,"datumTransformation",null),t=i([O("esri.views.layers.ImageryTileLayerView")],t),t};export{J as f};
