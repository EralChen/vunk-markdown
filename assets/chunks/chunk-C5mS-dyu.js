import{go as k,gp as C,gq as A,gr as x}from"./chunk-Dx0VeHfy.js";import{u as I,d as O,a as R}from"./chunk-DYfvIaKO.js";function B(s,o,f,i){const{rendererJSON:d,isRGBRenderer:b}=s;let t=null,n=null;if(o&&b)t=o;else if(o&&d?.type==="pointCloudUniqueValueRenderer"){n=I.fromJSON(d);const e=n.colorUniqueValueInfos;t=new Uint8Array(3*i);const a=m(n.fieldTransformType);for(let r=0;r<i;r++){const u=(a?a(o[r]):o[r])+"";for(let l=0;l<e.length;l++)if(e[l].values.includes(u)){t[3*r]=e[l].color.r,t[3*r+1]=e[l].color.g,t[3*r+2]=e[l].color.b;break}}}else if(o&&d?.type==="pointCloudStretchRenderer"){n=O.fromJSON(d);const e=n.stops;t=new Uint8Array(3*i);const a=m(n.fieldTransformType);for(let r=0;r<i;r++){const u=a?a(o[r]):o[r],l=e.length-1;if(u<e[0].value)t[3*r]=e[0].color.r,t[3*r+1]=e[0].color.g,t[3*r+2]=e[0].color.b;else if(u>=e[l].value)t[3*r]=e[l].color.r,t[3*r+1]=e[l].color.g,t[3*r+2]=e[l].color.b;else for(let c=1;c<e.length;c++)if(u<e[c].value){const g=(u-e[c-1].value)/(e[c].value-e[c-1].value);t[3*r]=e[c].color.r*g+e[c-1].color.r*(1-g),t[3*r+1]=e[c].color.g*g+e[c-1].color.g*(1-g),t[3*r+2]=e[c].color.b*g+e[c-1].color.b*(1-g);break}}}else if(o&&d?.type==="pointCloudClassBreaksRenderer"){n=R.fromJSON(d);const e=n.colorClassBreakInfos;t=new Uint8Array(3*i);const a=m(n.fieldTransformType);for(let r=0;r<i;r++){const u=a?a(o[r]):o[r];for(let l=0;l<e.length;l++)if(u>=e[l].minValue&&u<=e[l].maxValue){t[3*r]=e[l].color.r,t[3*r+1]=e[l].color.g,t[3*r+2]=e[l].color.b;break}}}else t=new Uint8Array(3*i).fill(255);if(f&&n?.colorModulation){const e=n.colorModulation.minValue,a=n.colorModulation.maxValue,r=.3;for(let u=0;u<i;u++){const l=f[u],c=l>=a?1:l<=e?r:r+(1-r)*(l-e)/(a-e);t[3*u]=c*t[3*u],t[3*u+1]=c*t[3*u+1],t[3*u+2]=c*t[3*u+2]}}return t}function M(s,o){if(s.encoding==null||s.encoding===""){const f=k(o,s);if(f.vertexAttributes.position==null)return;const i=C(o,f.vertexAttributes.position),d=f.header.fields,b=[d.offsetX,d.offsetY,d.offsetZ],t=[d.scaleX,d.scaleY,d.scaleZ],n=i.length/3,e=new Float64Array(3*n);for(let a=0;a<n;a++)e[3*a]=i[3*a]*t[0]+b[0],e[3*a+1]=i[3*a+1]*t[1]+b[1],e[3*a+2]=i[3*a+2]*t[2]+b[2];return e}if(s.encoding==="lepcc-xyz")return A(o).result}function T(s,o,f){return s?.attributeInfo.useElevation?o?S(o,f):null:s?.attributeInfo.storageInfo?x(s.attributeInfo.storageInfo,s.buffer,f,!0):null}function S(s,o){const f=new Float64Array(o);for(let i=0;i<o;i++)f[i]=s[3*i+2];return f}function q(s,o,f,i,d){const b=s.length/3;let t=0;for(let n=0;n<b;n++){let e=!0;for(let a=0;a<i.length&&e;a++){const{filterJSON:r}=i[a],u=d[a].values[n];switch(r.type){case"pointCloudValueFilter":{const l=r.mode==="exclude";r.values.includes(u)===l&&(e=!1);break}case"pointCloudBitfieldFilter":{const l=v(r.requiredSetBits),c=v(r.requiredClearBits);(u&l)===l&&(u&c)===0||(e=!1);break}case"pointCloudReturnFilter":{const l=15&u,c=u>>>4&15,g=c>1,w=l===1,y=l===c;let h=!1;for(const p of r.includedReturns)if(p==="last"&&y||p==="firstOfMany"&&w&&g||p==="lastOfMany"&&y&&g||p==="single"&&!g){h=!0;break}h||(e=!1);break}}}e&&(f[t]=n,s[3*t]=s[3*n],s[3*t+1]=s[3*n+1],s[3*t+2]=s[3*n+2],o[3*t]=o[3*n],o[3*t+1]=o[3*n+1],o[3*t+2]=o[3*n+2],t++)}return t}function m(s){switch(s){default:case null:case"none":return o=>o;case"low-four-bit":return o=>15&o;case"high-four-bit":return o=>(240&o)>>4;case"absolute-value":return o=>Math.abs(o);case"modulo-ten":return o=>o%10}}function v(s){let o=0;for(const f of s||[])o|=1<<f;return o}export{S as a,T as c,q as f,B as i,M as u};
