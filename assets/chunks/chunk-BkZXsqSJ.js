const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/chunk-D1mvvCJk.js","assets/chunks/chunk-Dx0VeHfy.js","assets/chunks/chunk-DHAEDrTs.js","assets/chunks/chunk-DoNQjcuu.js","assets/chunks/chunk-C2CG3HPk.js","assets/chunks/chunk-0POTpz_Y.js","assets/chunks/chunk-CC9Lwq1X.js","assets/chunks/chunk-DZU2A71w.js","assets/chunks/chunk-YeMQfurG.js","assets/chunks/chunk-Ch_PI5oE.js","assets/chunks/chunk-DDmVgC0l.js"])))=>i.map(i=>d[i]);
import{_ as c}from"./chunk-DHAEDrTs.js";import{ar as u,fU as d,at as w,bM as _,bN as y,as as m,aN as g,fK as f,aJ as v,aP as V,L as H,fV as $,f1 as G,ai as a,aj as o,al as b}from"./chunk-Dx0VeHfy.js";import{i as C}from"./chunk-BUMHfC2K.js";let r=class extends u{get updating(){return this.graphicsView?.updating??!1}constructor(s){super(s),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new d,this.graphicsView=null,this.suspended=!1;const e=new w([255,255,255,1/255]);this._symbols=new Map([["point",new _({size:"2px",style:"square",color:e})],["polyline",new y({width:"2px",color:e})],["polygon",new m({outline:null,color:e})]])}highlight(s,e){const t=C(s);if(t.length===0)return g();let p,i=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(t),this._ensureGraphicsView3D()]).then((([h,n])=>{!i&&n&&(p=this._addHighlightGraphics(n,h,e))}))),g((()=>{i=!0,p?.remove()}))}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(s,e,t){for(const i of e)this._highlightCounts.set(i,(this._highlightCounts.get(i)??0)+1);this.graphics.addMany(e);const p=s.highlight(e,t);return g((()=>{this._removeHighlightGraphics(e),p.remove()}))}_removeHighlightGraphics(s){this.graphics.removeMany(s.filter((e=>{const t=Math.max(0,(this._highlightCounts.get(e)??0)-1);return t===0?(this._highlightCounts.delete(e),!0):(this._highlightCounts.set(e,t),!1)})))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=c(()=>import("./chunk-D1mvvCJk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));const{default:s}=await this._graphicsViewLoader;if(this.destroyed)return null;const e=new s({view:this.view,layer:this.layer,getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set("graphicsView",e),this.addHandles([f(this.graphicsView),v((()=>this.suspended),(t=>{e.suspended=t}),V)]),e}async _createHighlightGraphics(s){const e=s.map((({geometry:i})=>i?.spatialReference)).filter(H).reduce(((i,h)=>(i.length!==0&&i.at(-1)?.equals(h)||i.push(h),i)),[]),t=this.view.spatialReference,p=e.map((i=>({source:i,dest:t})));try{await $(p)}catch{return[]}return s.map((i=>{const{geometry:h}=i;try{const n=h?G(h,t):null,l=i.cloneShallow();return l.geometry=n,l.symbol=this._symbols.get(n?.type),l}catch{return i}}))}};a([o()],r.prototype,"graphics",void 0),a([o()],r.prototype,"graphicsView",void 0),a([o()],r.prototype,"view",void 0),a([o()],r.prototype,"layer",void 0),a([o()],r.prototype,"updatingHandles",void 0),a([o()],r.prototype,"suspended",void 0),a([o()],r.prototype,"updating",null),r=a([b("esri.views.3d.layers.support.ImageHighlightHelper3D")],r);export{r as w};
