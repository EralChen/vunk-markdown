import{ar as i,as as n,au as F,fA as S,fB as v,s as j,f2 as O,fC as P,U as $,f3 as L,fD as l,fE as A}from"./chunk-mH00GGPN.js";import{i as _}from"./chunk-EW4iv0xp.js";const z=E=>{let t=class extends E{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return _(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?S(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(o){try{return!this.layer.loaded||!!v(this.layer.serviceRasterInfo,o)}catch{return!1}}async fetchPopupFeaturesAtLocation(o,f){const{layer:e}=this;if(!o)throw new j("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:w}=e,R=O(e,f);if(!w||R==null)return[];const d=[],{value:u,magdirValue:h,processedValue:b}=await e.identify(o,{timeExtent:this.timeExtent,signal:f?.signal});let y="";if(u?.length){y=e.type==="imagery-tile"&&e.hasStandardTime()&&u[0]!=null?u.map(s=>e.getStandardTimeValue(s)).join(", "):u.join(", ");const r={ObjectId:0};r[l.servicePixelValue]=e.type==="imagery-tile"&&e.raster.datasetFormat==="Function"?b?.join(", "):y,r[l.rawServicePixelValue]=y;const m=e.raster?.rasterInfo??e.serviceRasterInfo,p=m?.attributeTable;if(p!=null){const{fields:s,features:I}=p,x=s.find(({name:a})=>a.toLowerCase()==="value"),V=r[l.servicePixelValue],c=x?I.find(a=>String(a.attributes[x.name])===V):null;if(c)for(const a in c.attributes)c.attributes.hasOwnProperty(a)&&(r[A+a]=c.attributes[a])}const g=m?.dataType;if(g!=="vector-magdir"&&g!=="vector-uv"||(r[l.magnitude]=h?.[0],r[l.direction]=h?.[1]),e.type==="imagery-tile"){const{multidimensionalDefinition:s}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});P(e.rasterFields,r,s)}const T=new $({geometry:this.fullExtent?.clone(),attributes:r,layer:e,sourceLayer:e});d.push(T)}return d}async getSourceScale(){return await this.layer.load(),L(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return v(this.layer.serviceRasterInfo,this.view.spatialReference)}};return i([n()],t.prototype,"fullExtent",null),i([n()],t.prototype,"layer",void 0),i([n({readOnly:!0})],t.prototype,"timeExtent",null),i([n()],t.prototype,"tileInfo",void 0),i([n({readOnly:!0})],t.prototype,"hasTilingEffects",null),i([n()],t.prototype,"datumTransformation",null),t=i([F("esri.views.layers.ImageryTileLayerView")],t),t};export{z as y};
