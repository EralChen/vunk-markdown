import{fZ as $,f$ as l,I as M,d3 as j,g2 as y,rD as v,b2 as A,ar as H,rE as O,cW as z,cX as F,b8 as I,b9 as _,A as W,g3 as C,fY as L,eQ as b,jf as G,jg as P,ef as B,eW as q,ai as f,aj as E,al as T}from"./chunk-DadqOv6U.js";import{l as Z}from"./chunk-Cq5GrI5T.js";function V(e,r,t,s){const n=$(r,s);if(n==null)return!1;const o=n.source.spatialReferenceId,a=n.dest.spatialReferenceId;if(o===a&&o!==l.UNKNOWN||M(r,s))return t[0]=1,t[1]=1,t[2]=1,!0;if(o===l.SPHERICAL_ECEF){const u=j(e),d=u/Math.sqrt(e[0]*e[0]+e[1]*e[1]),i=u/y.radius;if(a===l.WEB_MERCATOR)return t[0]=d*i,t[1]=d*i,t[2]=1,!0;if(a===l.WGS84||a===l.CGCS2000){const p=v;return t[0]=p*d*i,t[1]=p*i,t[2]=1,!0}}else if(o===l.PLATE_CARREE){if(a===l.WGS84||a===l.CGCS2000)return t[0]=v,t[1]=v,t[2]=1,!0;if(a===l.WEB_MERCATOR){const u=e[1]/y.radius;return t[0]=1,t[1]=1/Math.cos(u),t[2]=1,!0}}return!1}let h=class extends A.EventedMixin(H){constructor(e){super(e),this._tmpEvent=new O,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=new z(this.view.state.viewingMode),this._intersector.options.store=F.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){return this.view?.elevationProvider?.spatialReference}getElevation(e,r,t,s){const n=this._renderCoordsHelper,o=I(c,e,r,t);if(!n.toRenderCoords(o,s,o))return W.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:a,_intersector:u,intersectionHandler:d}=this,i=a.fullExtent,p=i!=null&&Number.isFinite(i.xmin)&&Number.isFinite(i.xmax)&&Number.isFinite(i.ymin)&&Number.isFinite(i.ymax)&&Number.isFinite(i.zmin)&&Number.isFinite(i.zmax)?new C(i.zmin,i.zmax):a.elevationRange;if(p==null)return null;const R=a.elevationOffset,w=p.elevationRangeMin+R,N=p.elevationRangeMax+R,g=n.setAltitude(D,N,o),x=n.setAltitude(K,w,o);return u.reset(g,x,this.view.state.camera),d.intersect(u,null,g,x,null,!0),u.results.min.getIntersectionPoint(o)?n.getAltitude(o):null}getSphereElevationBounds(e,r){return Z(e,r,S,this._renderSR),this._layerElevationSource.getElevationRange(S)}getRootElevationBounds(){const e=this.layerElevationSource.fullExtent;return e?.hasZ?new C(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,r){b(r),this._expandExtent(e,r)}_computeLayerExtent(e,r){b(r);for(const t of e)this._expandExtent(t,r)}_expandExtent(e,r){const t=this.spatialReference;if(t==null||e==null)return;G(m,e.quaternion),m[12]=e.center[0],m[13]=e.center[1],m[14]=e.center[2];const s=e.halfSize;for(let n=0;n<8;++n)c[0]=1&n?s[0]:-s[0],c[1]=2&n?s[1]:-s[1],c[2]=4&n?s[2]:-s[2],B(c,c,m),this._renderCoordsHelper.fromRenderCoords(c,c,t),q(r,c,r)}};f([E({constructOnly:!0})],h.prototype,"layerElevationSource",void 0),f([E({constructOnly:!0})],h.prototype,"intersectionHandler",void 0),f([E({constructOnly:!0})],h.prototype,"view",void 0),f([E()],h.prototype,"spatialReference",null),h=f([T("esri.views.3d.layers.i3s.LayerElevationProvider")],h);const m=P(),S=L(0,0,0,0),c=_(),D=_(),K=_();class X{constructor(r,t,s,n){this.toMapSpace=r,this.transform=t,this.obb=s,this.geometry=n}}class Y{constructor(r,t){this.position=r,this.rotationScale=t,this.origin=void 0}}export{Y as i,V as n,X as t,h as x};
