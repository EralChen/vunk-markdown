import{V as _}from"./chunk-CZ531eoq.js";import{u as w,M as k}from"./chunk-P3cDqhc5.js";import{a6 as p,d as y,i as l,a7 as M,h as V,c as C,o as L,u as j}from"./chunk-DpJVogQA.js";async function $(s,n,a){return p.reader({url:"/application/chat_message/d72c0954-819e-11f0-8636-062fece26b16",onmessage:s,abortController:a},{headers:{authorization:"application-9888ea942ed566bce1f7dc8cba294b46"},data:n})}async function E(s,n,a){return p.reader({url:"/application/chat_message/238431a8-870a-11f0-85b0-6e0b28fdd362",onmessage:s,abortController:a},{headers:{authorization:"application-30ebbe93cec2d175445f05785e9dde41"},data:n})}const q=y({__name:"AgentEcharts",props:{content:{type:String,default:""},close:{type:Object,default:()=>({})}},setup(s){const n=s,{simplicity:a}=w(),f=l(()=>a.items.value.findLast(e=>e.role==="user")),g=l(()=>a.items.value.at(-1)),h=l(()=>!!n.close.markup),i=M({seviceLoading:!0,seviceEnd:!1,content:""});V(()=>h.value,v);function v(){const e=new k;let r=!0,c=!1;E(t=>{let u={content:""};typeof t.data=="string"&&(u=JSON.parse(t.data)),u.content&&(r=!1,e.upsertView({content:u.content,type:"text",updating:!0},{onCreate(b){const d=e.getPrevView(b);d&&(d.updating=!1)}}),o()),u.is_end&&(c=!0,e.allViewUpdated(),o())},{message:[f.value?.content||"",n.content].join(`
`)},g.value?.abortController);function o(){i.seviceEnd=c,i.seviceLoading=r;const t=e.getViews();i.content=m({views:t}).content}}function m(e){const r=e.views;let c=e.content??"";return r&&(c=r.reduce((o,t)=>(t.type==="thinking"?o+=`
${[`:::thinking ${t.updating?"thinking":"end"}`,"```md",t.content,"```",":::"].join(`
`)}`:o+=`
${t.content}`,o),"")),{role:e.role??"assistant",loading:e.seviceLoading===!0,content:c,abortController:e.abortController}}return(e,r)=>(L(),C(j(_),{source:i.content,containers:["echarts"],dev:""},null,8,["source"]))}});export{q as _,$ as a};
