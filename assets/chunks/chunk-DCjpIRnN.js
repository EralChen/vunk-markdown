import{je as A,j4 as B,gm as M,jf as G,s as H,jg as J,F as K,jh as Q,ji as V,jj as W,jk as X,jl as Y,jm as _}from"./chunk-B0S82j6z.js";import{u as z,t as S,s as $,l as ee,L as ae,p as te,o as le,n as se,e as ne,c as re,m as oe}from"./chunk-w2BRV-dW.js";import{l as R,d as ie}from"./chunk-D970reZY.js";import{resolveWebStyleSymbol as ce}from"./chunk-DnbtqzmD.js";import"./chunk-DsYbGKja.js";import"./chunk-BuZVacDv.js";/* empty css              */import"./chunk-8WtPGj6h.js";import"./chunk-CG7ZQ6BV.js";const L=22,D=120,O=80,I=50,q=20;function j(e){const a=e.outline,l=e.material!=null?e.material.color:null,t=l!=null?l.toHex():null;if(a==null||"pattern"in a&&a.pattern!=null&&a.pattern.type==="style"&&a.pattern.style==="none")return e.type==="fill"&&t==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const n=M(a.size)||0;return{color:"rgba("+(a.color!=null?a.color.toRgba():"255,255,255,1")+")",width:Math.min(n,O),style:"pattern"in a&&a.pattern!=null&&a.pattern.type==="style"?W(a.pattern.style):null,join:"butt",cap:"patternCap"in a?a.patternCap:"butt"}}async function ue(e,a){if(e.thumbnail?.url)return e.thumbnail.url;if(a.type==="icon"&&a?.resource?.href)return X(a);const l=B("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const t=await ce(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(t&&"thumbnail"in t&&t.thumbnail?.url)return t.thumbnail.url}return l}function F(e,a=1){const l=e.a,t=Q(e),n=t.h,c=t.s/a,o=100-(100-t.v)/a,{r:m,g:y,b:i}=V({h:n,s:c,v:o});return[m,y,i,l]}function C(e){return e.type==="water"?e.color==null?null:e.color:e.material?.color==null?null:e.material.color}function r(e,a=0){const l=C(e);if(!l){if(e.type==="fill")return null;const n=G.r,c=z(n,a);return[c,c,c,100]}const t=l.toRgba();for(let n=0;n<3;n++)t[n]=z(t[n],a);return t}async function pe(e,a){const l=e.style;return l==="none"?null:{type:"pattern",x:0,y:0,src:await A(B(`esri/symbols/patterns/${l}.png`),a.toCss(!0)),width:5,height:5}}function N(e){return e.outline?j(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function U(e,a){const l=C(e);if(!l)return null;let t="rgba(";return t+=z(l.r,a)+",",t+=z(l.g,a)+",",t+=z(l.b,a)+",",t+l.a+");"}function T(e,a){const l=e.edges;return!l||!l.color||!l.size?null:{color:l.color.toCss(!0),width:Math.min(M(l.size),a,O),join:"round"}}function E(e,a){const l=U(e,a);if(!l||"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none")return null;const t={color:l,width:Math.min(e.size?M(e.size):.75,O)};return"pattern"in e&&e.pattern?.type==="style"&&(t.style=W(e.pattern.style)),"cap"in e&&e.cap&&(t.cap=e.cap),"join"in e&&e.join&&(t.join=e.join==="miter"?M(2):e.join),t}function P(e,a,l){const t=l!=null?.75*l:0;return{type:"linear",x1:t?.25*t:0,y1:t?.5*t:0,x2:t||4,y2:t?.5*t:4,colors:[{color:e,offset:0},{color:a,offset:1}]}}function he(e){const a=e.depth,l=e.height,t=e.width;return t!==0&&a!==0&&l!==0&&t===a&&t!=null&&l!=null&&t<l}function me(e,a,l){const t=[];if(!e)return t;switch(e.type){case"icon":{const o=a,m=a;switch(e.resource?.primitive??_){case"circle":t.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:r(e,0),stroke:j(e)});break;case"square":t.push({shape:{type:"path",path:[{command:"M",values:[0,m]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,m]},{command:"Z",values:[]}]},fill:r(e,0),stroke:j(e)});break;case"triangle":t.push({shape:{type:"path",path:[{command:"M",values:[0,m]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,m]},{command:"Z",values:[]}]},fill:r(e,0),stroke:j(e)});break;case"cross":t.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,m]},{command:"M",values:[0,.5*m]},{command:"L",values:[o,.5*m]}]},stroke:N(e)});break;case"x":t.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,m]},{command:"M",values:[o,0]},{command:"L",values:[0,m]}]},stroke:N(e)});break;case"kite":t.push({shape:{type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*m]},{command:"L",values:[.5*o,m]},{command:"Z",values:[]}]},fill:r(e,0),stroke:j(e)})}break}case"object":switch(e.resource?.primitive??Y){case"cone":{const n=P(r(e,0),r(e,-.6),l?q:a),c=se(a,l);t.push({shape:c[0],fill:n},{shape:c[1],fill:n});break}case"inverted-cone":{const n=r(e,0),c=P(n,r(e,-.6),a),o=le(a);t.push({shape:o[0],fill:c},{shape:o[1],fill:n});break}case"cube":{const n=te(a,l);t.push({shape:n[0],fill:r(e,0)},{shape:n[1],fill:r(e,-.3)},{shape:n[2],fill:r(e,-.5)});break}case"cylinder":{const n=P(r(e,0),r(e,-.6),l?q:a),c=ae(a,l);t.push({shape:c[0],fill:n},{shape:c[1],fill:n},{shape:c[2],fill:r(e,0)});break}case"diamond":{const n=ee(a);t.push({shape:n[0],fill:r(e,-.3)},{shape:n[1],fill:r(e,0)},{shape:n[2],fill:r(e,-.3)},{shape:n[3],fill:r(e,-.7)});break}case"sphere":{const n=P(r(e,0),r(e,-.6));n.x1=0,n.y1=0,n.x2=.25*a,n.y2=.25*a,t.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:n});break}case"tetrahedron":{const n=$(a);t.push({shape:n[0],fill:r(e,-.3)},{shape:n[1],fill:r(e,0)},{shape:n[2],fill:r(e,-.6)});break}}break}return t}function Z(e){const a=typeof e?.size=="number"?e?.size:null;return a?M(a):null}function fe(e){return e.type==="icon"?"multiply":"tint"}async function ye(e,a){const l=Z(a),t=a?.maxSize?M(a.maxSize):null,n=a?.disableUpsampling??!1,c=e.symbolLayers,o=[],m=[];let y=!1,i=0,d=0,w=0;c.forEach(s=>{if(s.type!=="icon"&&s.type!=="object")return;s&&s.type==="icon"&&(w=Math.max(s.size&&M(s.size),w));const p=s.type==="icon"?s.size&&M(s.size):0,h=l||p?Math.ceil(Math.min(l||p,t||D)):L;let f=s.type==="icon"?s.angle:null;if(a?.rotation!=null&&(f=(f??0)+a.rotation),m.push(f),s?.resource?.href){const b=ue(e,s).then(k=>{const v=s?.material?.color,x=fe(s);return ie(k,h,v,x,n)}).then(k=>{const v=k.width,x=k.height;return i=Math.max(i,v),d=Math.max(d,x),f&&(y=!0),[{shape:{type:"image",x:0,y:0,width:v,height:x,src:k.url},fill:null,stroke:null}]});o.push(b)}else{let b=h;s.type==="icon"&&l&&(b=h*(p/w));const k=a?.symbolConfig==="tall"||a?.symbolConfig?.isTall||s.type==="object"&&he(s);i=Math.max(i,k?q:b),d=Math.max(d,b),f&&s.resource?.primitive&&["square","triangle","x"].includes(s.resource?.primitive)&&(y=!0),o.push(Promise.resolve(me(s,b,k)))}});const u=await Promise.allSettled(o),g=[];return u.forEach(s=>{s.status==="fulfilled"?g.push(s.value):s.reason&&K.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",s.reason)}),R(g,[i,d],{node:a?.node,scale:!1,opacity:a?.opacity,ariaLabel:a?.ariaLabel,rotations:m,useRotationSize:y})}function de(e,a){const l=e.symbolLayers,t=[],n=J(e),c=Z(a),o=(a?.maxSize?M(a.maxSize):null)||O;let m,y=0,i=0;return l.forEach((d,w)=>{if(!d||d.type!=="line"&&d.type!=="path")return;const u=[];switch(d.type){case"line":{const g=E(d,0);if(g==null)break;const s=g?.width||0;w===0&&(m=s);const p=Math.min(c||s,o),h=w===0?p:c?p*(s/m):p,f=h>I/2?2*h:I;i=Math.max(i,h),y=Math.max(y,f),g.width=h,u.push({shape:{type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[y,.5*i]}]},stroke:g});break}case"path":{const g=Math.min(c||L,o),s=r(d,0),p=r(d,-.2),h=U(d,-.4),f=h?{color:h,width:1}:{};if(d.profile==="quad"){const b=d.width,k=d.height,v=ne(b&&k?b/k:1,k===0,b===0),x={...f,join:"bevel"};u.push({shape:v[0],fill:p,stroke:x},{shape:v[1],fill:p,stroke:x},{shape:v[2],fill:s,stroke:x})}else u.push({shape:S.pathSymbol3DLayer[0],fill:p,stroke:f},{shape:S.pathSymbol3DLayer[1],fill:s,stroke:f});i=Math.max(i,g),y=i}}t.push(u)}),Promise.resolve(R(t,[y,i],{node:a?.node,scale:n,opacity:a?.opacity,ariaLabel:a?.ariaLabel}))}async function be(e,a){const l=e.type==="mesh-3d",t=e.symbolLayers,n=Z(a),c=a?.maxSize?M(a.maxSize):null,o=n||L,m=[];let y=0,i=0,d=!1;for(let w=0;w<t.length;w++){const u=t.at(w),g=[];if(!l||u.type==="fill"){switch(u.type){case"fill":{const s=Math.min(o,c||D);if(y=Math.max(y,s),i=Math.max(i,s),d=!0,l){const p=S.meshSymbol3DFill,h=U(u,-.4),f=T(u,.05*s)??(h?{join:"round",color:h,width:1}:null);g.push({shape:p[0],fill:r(u,0),stroke:f},{shape:p[1],fill:r(u,-.2),stroke:f},{shape:p[2],fill:r(u,-.6),stroke:f})}else{let p=r(u,0);const h="pattern"in u?u.pattern:null,f=j(u),b=C(u);h!=null&&h.type==="style"&&h.style!=="solid"&&b&&(p=await pe(h,b)),g.push({shape:S.fill[0],fill:p,stroke:f})}break}case"line":{const s=E(u,0);if(s==null)break;const p={stroke:s,shape:S.fill[0]};y=Math.max(y,L),i=Math.max(i,L),g.push(p);break}case"extrude":{const s=r(u,0),p=r(u,-.2),h=Math.min(o,c||D),f=oe(h),b=L,k=.7*L+.5*h,v=T(u,.1*Math.min(b,k))??{join:"round",...E(u,-.4),width:1};g.push({shape:f[0],fill:p,stroke:v},{shape:f[1],fill:p,stroke:v},{shape:f[2],fill:s,stroke:v}),y=Math.max(y,b),i=Math.max(i,k);break}case"water":{const s=C(u),p=F(s),h=F(s,2),f=F(s,3),b=re();d=!0,g.push({shape:b[0],fill:p},{shape:b[1],fill:h},{shape:b[2],fill:f});const k=Math.min(o,c||D);y=Math.max(y,k),i=Math.max(i,k);break}}m.push(g)}}return R(m,[y,i],{node:a?.node,scale:d,opacity:a?.opacity,ariaLabel:a?.ariaLabel})}function Se(e,a){if(e.symbolLayers.length===0)return Promise.reject(new H("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return ye(e,a);case"line-3d":return de(e,a);case"polygon-3d":case"mesh-3d":return be(e,a)}return Promise.reject(new H("symbolPreview: swatchInfo3D","symbol not supported."))}export{pe as getPatternDescriptor,Z as getSizeFromOptions,r as getSymbolLayerFill,Se as previewSymbol3D};
