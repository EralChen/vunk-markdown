import{V as M,_ as P,b as N}from"./chunk-50xLZI31.js";import{V as R,M as W}from"./chunk-CnGCtVXf.js";import{V as q,a as D}from"./chunk-DsSV5A-D.js";import{_ as L,E as U}from"./chunk-C89WVBiH.js";import{d as z,t as I,ay as S,g as J,b as w,o as c,y as _,a as n,f as g,c as V,e as p,w as l,u as a,az as O,aA as F,aB as x,aC as G,U as H,a4 as B,ac as E,aD as K,aE as j,aa as Q,ab as X,q as Y,au as Z}from"./chunk-DyqHK6XP.js";/* empty css              */import{_ as ee}from"./chunk-BnyPt0Xa.js";const te=["disabled"],ae={class:"status-icon"},ne={class:"label"},se={class:"content"},oe={class:"error-message"},re=z({__name:"index",props:{modelValue:{type:Boolean,default:!0},content:{default:""},status:{default:"start"},disabled:{type:Boolean,default:!1},autoCollapse:{type:Boolean,default:!1},duration:{default:"0.2s"},buttonWidth:{default:"160px"},maxWidth:{default:"500px"},backgroundColor:{default:"#fcfcfc"},color:{default:"var(--el-color-info)"}},emits:["change","update:modelValue"],setup(v,{emit:h}){const t=v,o=h,s=I(t.modelValue);S(()=>t.modelValue,e=>{s.value=e});function r(){t.disabled||(s.value=!s.value,o("change",{value:s.value,status:t.status}),o("update:modelValue",s.value))}const i=J(()=>t.status==="error"?"思考过程中出现错误":t.content);return S(()=>t.status,e=>{e==="end"&&t.autoCollapse&&(s.value=!1,o("update:modelValue",s.value))}),(e,T)=>{const u=U;return c(),w("div",{class:"el-thinking",style:Y({"--el-thinking-button-width":t.buttonWidth,"--el-thinking-animation-duration":t.duration,"--el-thinking-content-wrapper-width":t.maxWidth,"--el-thinking-content-wrapper-background-color":t.backgroundColor,"--el-thinking-content-wrapper-color":t.color})},[_("button",{class:E(["trigger",[e.status,{disabled:!t.disabled}]]),disabled:t.disabled,onClick:r},[_("span",ae,[g(e.$slots,"status-icon",{status:t.status},()=>[e.status==="thinking"?(c(),V(u,{key:0,class:"is-loading el-icon-center"},{default:l(()=>[n(a(O))]),_:1})):p("",!0),e.status==="start"?(c(),V(u,{key:1,class:"el-icon-center start-color"},{default:l(()=>[n(a(F))]),_:1})):p("",!0),e.status==="end"?(c(),V(u,{key:2,class:"el-icon-center end-color"},{default:l(()=>[n(a(x))]),_:1})):p("",!0),e.status==="error"?(c(),V(u,{key:3,class:"el-icon-center error-color"},{default:l(()=>[n(a(G))]),_:1})):p("",!0)],!0)]),_("span",ne,[g(e.$slots,"label",{status:t.status},()=>[H(B(e.status==="thinking"?"思考中...":e.status==="error"?"思考遇到问题":e.status==="end"?"思考完成":"开始思考"),1)],!0)]),n(j,{name:"rotate"},{default:l(()=>[t.disabled?p("",!0):(c(),w("span",{key:0,class:E(["arrow el-icon-center",{expanded:a(s)}])},[g(e.$slots,"arrow",{},()=>[n(u,{class:"el-icon-center"},{default:l(()=>[n(a(K))]),_:1})],!0)],2))]),_:3})],10,te),n(j,{name:"slide"},{default:l(()=>[a(i)?Q((c(),w("div",{key:0,class:E(["content-wrapper",{"error-state":e.status==="error"}])},[_("div",se,[e.status!=="error"?g(e.$slots,"content",{key:0,content:a(i)},()=>[_("pre",null,B(a(i)),1)],!0):g(e.$slots,"error",{key:1,errorContent:a(i)},()=>[_("div",oe,B(a(i)),1)],!0)])],2)),[[X,a(s)]]):p("",!0)]),_:3})],4)}}}),le=L(re,[["__scopeId","data-v-059ddb88"]]);async function ie(v,h,t){return Z.reader({url:"/application/chat_message/d72c0954-819e-11f0-8636-062fece26b16",onmessage:v,abortController:t},{headers:{authorization:"application-9888ea942ed566bce1f7dc8cba294b46"},data:h})}const ue={key:0},me=z({__name:"AgentChatProvider",setup(v){const h=({message:o},{onSuccess:s,onError:r,onUpdate:i})=>{if(!o?.content)return;const e=[],T="assistant";let u=!0,C=!1;const d=new W,$=new AbortController;$.signal.addEventListener("abort",()=>{C=!0,u=!1,d.allViewUpdated(),d.getViews().length===0&&d.upsertView({content:"对话已取消",type:"text",updating:!1}),m()}),m(),ie(k=>{let f={content:"",reasoning_content:""};if(typeof k.data=="string")try{f=JSON.parse(k.data)}catch(b){r(b)}f.reasoning_content&&(u=!1,d.upsertView({content:f.reasoning_content,type:"thinking",updating:!0},{onCreate(b){const y=d.getPrevView(b);y&&(y.updating=!1)}}),m()),f.content&&(u=!1,d.upsertView({content:f.content,type:"text",updating:!0},{onCreate(b){const y=d.getPrevView(b);y&&(y.updating=!1)}}),m()),f.is_end&&(C=!0,d.allViewUpdated(),m(),A())},{message:o.content},$);function m(){const k={role:T,seviceLoading:u,seviceEnd:C,views:d.getViews(),abortController:$};i(k),e.push(k)}function A(){s(e)}},t=o=>{const s=o.views;let r=o.content??"";return s&&(r=s.reduce((i,e)=>(e.type==="thinking"?i+=[`:::thinking ${e.updating?"thinking":"end"}`,"```md",e.content,"```",":::"].join(`
`):i+=`
${e.content}`,i),"")),{role:o.role??"assistant",loading:o.seviceLoading===!0,content:r,abortController:o.abortController}};return(o,s)=>(c(),V(a(R),{request:h,parser:t},{default:l(()=>[n(a(q),null,{default:l(()=>[n(a(D),{"markdown-props":{containers:["thinking"],fences:["json"]}}),n(a(M),null,{default:l(()=>[n(a(P)),n(a(N),{type:"container:thinking"},{default:l(({raw:r})=>[n(a(le),{content:r.children[0].content,status:r.open.info.split(" ")[1]||"thinking"},null,8,["content","status"])]),_:1}),n(a(N),{type:"fence:json"},{default:l(({raw:r})=>[r.info.split(" ")[1]==="layer"?(c(),w("ul",ue,[n(ee,{data:JSON.parse(r.content)},null,8,["data"])])):p("",!0)]),_:1}),g(o.$slots,"default")]),_:3})]),_:3})]),_:3}))}});export{me as _};
