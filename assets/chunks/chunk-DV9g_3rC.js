import{_ as M,ld as z,le as q,lf as G,b0 as m,j0 as H,b2 as N,d4 as Q,ct as D,gG as J,c$ as K,lg as O,lh as V,i$ as Z,N as P,li as X,kx as Y,fB as k,lj as ee,w as te,h as ae,P as ne,kC as se,lk as _,y as re,m as le,ll as oe}from"./chunk-DbiObNSB.js";import{c as ie}from"./chunk-DER_1SyX.js";import{c as ce,u as he}from"./chunk-BAQYUxr7.js";function b(s,e,t=null){return t!=null?[s,e,t]:[s,e]}function o(s,e,t=null){return t!=null?{x:s,y:e,z:t}:{x:s,y:e}}class j{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(t=>this.mapToLocal(t)).filter(P)}get doUnnormalization(){return!1}}let ue=class extends j{constructor(e,t,n=null){super(t),this._defaultZ=n,this.transform=z(),this.transformInv=z(),this.transform=q(e),G(this.transformInv,this.transform)}makeMapPoint(e,t){return b(e,t,this._defaultZ)}mapToLocal(e){return o(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return b(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},fe=class extends j{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=m(),this.tangentFrameUpWS=m(),this.tangentFrameRightWS=m(),this.tangentFrameForwardWS=m(),this.localFrameRightWS=m(),this.localFrameUpWS=m(),this.worldToLocalTransform=H(),this.localToWorldTransform=H(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);const l=m();N(l,this.tangentFrameForwardWS,Q(n,this.tangentFrameForwardWS)),D(this.localFrameRightWS,n,l),J(this.localFrameRightWS,this.localFrameRightWS),K(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),O(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),V(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,t){return b(e,t,this.defaultZ)}mapToLocal(e){const t=m();this.view.renderCoordsHelper.toRenderCoords(new M({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Z(t,t,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,new M({spatialReference:this.view.spatialReference}));return n!=null?o(n.x/this.scale,n.y/this.scale):null}localToMap(e){const t=m();this.view.renderCoordsHelper.toRenderCoords(new M({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Z(t,t,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,new M({spatialReference:this.view.spatialReference}));return n!=null?b(n.x,n.y,this.defaultZ):null}};function Re(s,e){if(s.type==="2d")return new ue(s.state.transform,s.spatialReference,e.length>2?e[2]:null);if(s.type==="3d"){const t=e.length>2?new M({x:e[0],y:e[1],z:e[2],spatialReference:s.spatialReference}):new M({x:e[0],y:e[1],spatialReference:s.spatialReference});return new fe(s,t)}return null}function g(s,e){const t=new M({x:s[0],y:s[1],spatialReference:e});return s.length>2&&(t.z=s[2]),t}function Me(s,e){return new le({points:s,spatialReference:e})}function ge(s,e,t){const n=new re({paths:s,spatialReference:e});return t&&_(n),n}function C(s,e,t,n=!0){const l=te(s);l.forEach(r=>{const c=r[0],i=r[r.length-1];ae(c,i)&&r.length!==1||r.push(r[0])});let a=new ne({rings:l,spatialReference:e});return a.rings.forEach(r=>{se(r)||r.reverse()}),t&&_(a),n&&!ce(a)&&k(e)&&(a=he(a)||a),a}function we(s,e,t){const n=e.mapToLocalMultiple(s),l=[],a={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y},c=Math.round(r.x-a.x),i=Math.round(r.y-a.y),f=Math.max(Math.abs(c),Math.abs(i));if(t){const h={x:a.x+f,y:a.y+f},d={x:a.x-f,y:a.y-f};l.push(o(h.x,d.y),o(d.x,d.y),o(d.x,h.y),o(h.x,h.y))}else{const h={x:c>0?a.x+f:a.x-f,y:i>0?a.y+f:a.y-f};l.push(o(a.x,a.y),o(h.x,a.y),o(h.x,h.y),o(a.x,h.y))}return A(C([l.map(h=>e.localToMap(h)).filter(P)],e.spatialReference,e.doUnnormalization,!0),l,e)}function Te(s,e,t){let n=e.mapToLocalMultiple(s);if(n.length===1){const i=n[0];n=[o(i.x-48,i.y+48),o(i.x+48,i.y-48),o(i.x+48,i.y-48),o(i.x-48,i.y+48)]}const l=[],a={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y};if(t){const c=Math.round(r.x-a.x),i=Math.round(r.y-a.y);l.push(o(a.x-c,a.y-i),o(r.x,a.y-i),o(r.x,r.y),o(a.x-c,r.y))}else l.push(o(a.x,a.y),o(r.x,a.y),o(r.x,r.y),o(a.x,r.y));return A(C([l.map(c=>e.localToMap(c)).filter(P)],e.spatialReference,e.doUnnormalization,!0),l,e)}function A(s,e,t){const n=S(e[3],e[2],t),l=S(e[1],e[2],t),a=S(e[0],e[1],t),r=S(e[0],e[3],t);return{geometry:s,midpoints:n!=null&&l!=null&&a!=null&&r!=null?{top:n,right:l,bottom:a,left:r}:null}}function S(s,e,t){W[0]=s.x,W[1]=s.y,W[2]=0,v[0]=e.x,v[1]=e.y,v[2]=0,oe(W,W,v,.5),$.x=W[0],$.y=v[1],$.z=v[2];const n=t.localToMap($);return n!=null?g(n,t.spatialReference):null}const $=o(0,0,0),W=m(),v=m();function We(s,e,t,n){const l=e.mapToLocalMultiple(s);let a=null,r=null;if(t)a=l[0],r=l[1];else{const u=l[0],p=l[1],w=Math.round(p.x-u.x),T=Math.round(p.y-u.y),x=Math.max(Math.abs(w),Math.abs(T));a=o(w>0?u.x+x/2:u.x-x/2,T>0?u.y+x/2:u.y-x/2),r=o(Math.abs(w)>Math.abs(T)?a.x-x/2:a.x,Math.abs(w)>Math.abs(T)?a.y:a.y-x/2)}const c=e.localToMap(a),i=e.localToMap(r);if(c==null||i==null)return null;e.doUnnormalization&&X([[c,i]],e.spatialReference);const f=g(c,e.spatialReference),h=g(i,e.spatialReference),d=Y(e.spatialReference);let y=0;if(k(e.spatialReference))y=d*ie(f,h);else{const u=a.x-r.x,p=a.y-r.y;y=d*Math.sqrt(u*u+p*p)*(n||1)}const F=new ee({center:f,radius:y,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:C(F.rings,F.spatialReference,!1),center:f,edge:h}}function ve(s,e,t){const n=e.mapToLocalMultiple(s),l=n[0],a=n[1],r=Math.round(a.x-l.x),c=Math.round(a.y-l.y),i=o(t?l.x:l.x+r/2,t?l.y:l.y+c/2),f=t?r:r/2,h=t?c:c/2,d=60,y=[],F=2*Math.PI/d;function u(R){const B=Math.cos(R),E=Math.sin(R);return o(f*B+i.x,h*E+i.y)}for(let R=0;R<d;R++)y.push(u(R*F));y.push(y[0]);const{spatialReference:p,doUnnormalization:w}=e,T=C([y.map(R=>e.localToMap(R)).filter(P)],p,w,!1),x=e.localToMap(u(Math.PI/2)),I=e.localToMap(u(0)),L=e.localToMap(u(-Math.PI/2)),U=e.localToMap(u(Math.PI));return{geometry:T,midpoints:x!=null&&I!=null&&L!=null&&U!=null?{top:g(x,p),right:g(I,p),bottom:g(L,p),left:g(U,p)}:null}}export{ue as R,C as T,Te as U,Re as W,Me as a,we as b,ge as j,We as k,ve as v};
