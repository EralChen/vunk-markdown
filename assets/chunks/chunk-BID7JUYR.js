import{s as W,a as P,S as N}from"./chunk-7WtmbgDT.js";import{_ as m,g as t,a8 as H,l as S,a9 as C,af as z,ba as U,bg as F,al as O}from"./chunk-BxmsXNuz.js";import{G as J}from"./chunk-Bf8CiyL0.js";import{l as X}from"./chunk-BfIhNp49.js";import"./chunk-CdXCTgd6.js";import"./chunk-BIY0MvRL.js";import"./chunk-DKLxNM5h.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-DRwnlOiu.js";import"./chunk-CkowMHsi.js";import"./chunk-BFk67kSi.js";import"./chunk-DAMRS0zl.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-29fEP0PO.js";import"./chunk-DCTIbqSe.js";var L={},D=m((e,a)=>{L[e]=a},"set"),Y=m(e=>L[e],"get"),G=m(()=>Object.keys(L),"keys"),$=m(()=>G().length,"size"),I={get:Y,set:D,keys:G,size:$},j=m(e=>e.append("circle").attr("class","start-state").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit).attr("cy",t().state.padding+t().state.sizeUnit),"drawStartState"),q=m(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",t().state.textHeight).attr("class","divider").attr("x2",t().state.textHeight*2).attr("y1",0).attr("y2",0),"drawDivider"),Z=m((e,a)=>{const s=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+2*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(a.id),d=s.node().getBBox();return e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",d.width+2*t().state.padding).attr("height",d.height+2*t().state.padding).attr("rx",t().state.radius),s},"drawSimpleState"),K=m((e,a)=>{const s=m(function(c,B,y){const k=c.append("tspan").attr("x",2*t().state.padding).text(B);y||k.attr("dy",t().state.textHeight)},"addTspan"),n=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+1.3*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(a.descriptions[0]).node().getBBox(),l=n.height,x=e.append("text").attr("x",t().state.padding).attr("y",l+t().state.padding*.4+t().state.dividerMargin+t().state.textHeight).attr("class","state-description");let i=!0,o=!0;a.descriptions.forEach(function(c){i||(s(x,c,o),o=!1),i=!1});const w=e.append("line").attr("x1",t().state.padding).attr("y1",t().state.padding+l+t().state.dividerMargin/2).attr("y2",t().state.padding+l+t().state.dividerMargin/2).attr("class","descr-divider"),h=x.node().getBBox(),p=Math.max(h.width,n.width);return w.attr("x2",p+3*t().state.padding),e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",p+2*t().state.padding).attr("height",h.height+l+2*t().state.padding).attr("rx",t().state.radius),e},"drawDescrState"),Q=m((e,a,s)=>{const d=t().state.padding,n=2*t().state.padding,l=e.node().getBBox(),x=l.width,i=l.x,o=e.append("text").attr("x",0).attr("y",t().state.titleShift).attr("font-size",t().state.fontSize).attr("class","state-title").text(a.id),h=o.node().getBBox().width+n;let p=Math.max(h,x);p===x&&(p=p+n);let c;const B=e.node().getBBox();a.doc,c=i-d,h>x&&(c=(x-p)/2+d),Math.abs(i-B.x)<d&&h>x&&(c=i-(h-x)/2);const y=1-t().state.textHeight;return e.insert("rect",":first-child").attr("x",c).attr("y",y).attr("class",s?"alt-composit":"composit").attr("width",p).attr("height",B.height+t().state.textHeight+t().state.titleShift+1).attr("rx","0"),o.attr("x",c+d),h<=x&&o.attr("x",i+(p-n)/2-h/2+d),e.insert("rect",":first-child").attr("x",c).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",p).attr("height",t().state.textHeight*3).attr("rx",t().state.radius),e.insert("rect",":first-child").attr("x",c).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",p).attr("height",B.height+3+2*t().state.textHeight).attr("rx",t().state.radius),e},"addTitleAndBox"),V=m(e=>(e.append("circle").attr("class","end-state-outer").attr("r",t().state.sizeUnit+t().state.miniPadding).attr("cx",t().state.padding+t().state.sizeUnit+t().state.miniPadding).attr("cy",t().state.padding+t().state.sizeUnit+t().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit+2).attr("cy",t().state.padding+t().state.sizeUnit+2)),"drawEndState"),tt=m((e,a)=>{let s=t().state.forkWidth,d=t().state.forkHeight;if(a.parentId){let n=s;s=d,d=n}return e.append("rect").style("stroke","black").style("fill","black").attr("width",s).attr("height",d).attr("x",t().state.padding).attr("y",t().state.padding)},"drawForkJoinState"),et=m((e,a,s,d)=>{let n=0;const l=d.append("text");l.style("text-anchor","start"),l.attr("class","noteText");let x=e.replace(/\r\n/g,"<br/>");x=x.replace(/\n/g,"<br/>");const i=x.split(z.lineBreakRegex);let o=1.25*t().state.noteMargin;for(const w of i){const h=w.trim();if(h.length>0){const p=l.append("tspan");if(p.text(h),o===0){const c=p.node().getBBox();o+=c.height}n+=o,p.attr("x",a+t().state.noteMargin),p.attr("y",s+n+1.25*t().state.noteMargin)}}return{textWidth:l.node().getBBox().width,textHeight:n}},"_drawLongText"),it=m((e,a)=>{a.attr("class","state-note");const s=a.append("rect").attr("x",0).attr("y",t().state.padding),d=a.append("g"),{textWidth:n,textHeight:l}=et(e,0,0,d);return s.attr("height",l+2*t().state.noteMargin),s.attr("width",n+t().state.noteMargin*2),s},"drawNote"),_=m(function(e,a){const s=a.id,d={id:s,label:a.id,width:0,height:0},n=e.append("g").attr("id",s).attr("class","stateGroup");a.type==="start"&&j(n),a.type==="end"&&V(n),(a.type==="fork"||a.type==="join")&&tt(n,a),a.type==="note"&&it(a.note.text,n),a.type==="divider"&&q(n),a.type==="default"&&a.descriptions.length===0&&Z(n,a),a.type==="default"&&a.descriptions.length>0&&K(n,a);const l=n.node().getBBox();return d.width=l.width+2*t().state.padding,d.height=l.height+2*t().state.padding,I.set(s,d),d},"drawState"),A=0,at=m(function(e,a,s){const d=m(function(o){switch(o){case N.relationType.AGGREGATION:return"aggregation";case N.relationType.EXTENSION:return"extension";case N.relationType.COMPOSITION:return"composition";case N.relationType.DEPENDENCY:return"dependency"}},"getRelationType");a.points=a.points.filter(o=>!Number.isNaN(o.y));const n=a.points,l=U().x(function(o){return o.x}).y(function(o){return o.y}).curve(F),x=e.append("path").attr("d",l(n)).attr("id","edge"+A).attr("class","transition");let i="";if(t().state.arrowMarkerAbsolute&&(i=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,i=i.replace(/\(/g,"\\("),i=i.replace(/\)/g,"\\)")),x.attr("marker-end","url("+i+"#"+d(N.relationType.DEPENDENCY)+"End)"),s.title!==void 0){const o=e.append("g").attr("class","stateLabel"),{x:w,y:h}=O.calcLabelPosition(a.points),p=z.getRows(s.title);let c=0;const B=[];let y=0,k=0;for(let u=0;u<=p.length;u++){const g=o.append("text").attr("text-anchor","middle").text(p[u]).attr("x",w).attr("y",h+c),f=g.node().getBBox();y=Math.max(y,f.width),k=Math.min(k,f.x),S.info(f.x,w,h+c),c===0&&(c=g.node().getBBox().height,S.info("Title height",c,h)),B.push(g)}let E=c*p.length;if(p.length>1){const u=(p.length-1)*c*.5;B.forEach((g,f)=>g.attr("y",h+f*c-u)),E=c*p.length}const r=o.node().getBBox();o.insert("rect",":first-child").attr("class","box").attr("x",w-y/2-t().state.padding/2).attr("y",h-E/2-t().state.padding/2-3.5).attr("width",y+t().state.padding).attr("height",E+t().state.padding),S.info(r)}A++},"drawEdge"),b,T={},rt=m(function(){},"setConf"),nt=m(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),ot=m(function(e,a,s,d){b=t().state;const n=t().securityLevel;let l;n==="sandbox"&&(l=H("#i"+a));const x=n==="sandbox"?H(l.nodes()[0].contentDocument.body):H("body"),i=n==="sandbox"?l.nodes()[0].contentDocument:document;S.debug("Rendering diagram "+e);const o=x.select(`[id='${a}']`);nt(o);const w=d.db.getRootDoc();R(w,o,void 0,!1,x,i,d);const h=b.padding,p=o.node().getBBox(),c=p.width+h*2,B=p.height+h*2,y=c*1.75;C(o,B,y,b.useMaxWidth),o.attr("viewBox",`${p.x-b.padding}  ${p.y-b.padding} `+c+" "+B)},"draw"),st=m(e=>e?e.length*b.fontSizeFactor:1,"getLabelWidth"),R=m((e,a,s,d,n,l,x)=>{const i=new J({compound:!0,multigraph:!0});let o,w=!0;for(o=0;o<e.length;o++)if(e[o].stmt==="relation"){w=!1;break}s?i.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:w?1:b.edgeLengthFactor,nodeSep:w?1:50,isMultiGraph:!0}):i.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:w?1:b.edgeLengthFactor,nodeSep:w?1:50,ranker:"tight-tree",isMultiGraph:!0}),i.setDefaultEdgeLabel(function(){return{}});const h=x.db.getStates(),p=x.db.getRelations(),c=Object.keys(h);for(const r of c){const u=h[r];s&&(u.parentId=s);let g;if(u.doc){let f=a.append("g").attr("id",u.id).attr("class","stateGroup");g=R(u.doc,f,u.id,!d,n,l,x);{f=Q(f,u,d);let v=f.node().getBBox();g.width=v.width,g.height=v.height+b.padding/2,T[u.id]={y:b.compositTitleSize}}}else g=_(a,u,i);if(u.note){const f={descriptions:[],id:u.id+"-note",note:u.note,type:"note"},v=_(a,f,i);u.note.position==="left of"?(i.setNode(g.id+"-note",v),i.setNode(g.id,g)):(i.setNode(g.id,g),i.setNode(g.id+"-note",v)),i.setParent(g.id,g.id+"-group"),i.setParent(g.id+"-note",g.id+"-group")}else i.setNode(g.id,g)}S.debug("Count=",i.nodeCount(),i);let B=0;p.forEach(function(r){B++,S.debug("Setting edge",r),i.setEdge(r.id1,r.id2,{relation:r,width:st(r.title),height:b.labelHeight*z.getRows(r.title).length,labelpos:"c"},"id"+B)}),X(i),S.debug("Graph after layout",i.nodes());const y=a.node();i.nodes().forEach(function(r){r!==void 0&&i.node(r)!==void 0?(S.warn("Node "+r+": "+JSON.stringify(i.node(r))),n.select("#"+y.id+" #"+r).attr("transform","translate("+(i.node(r).x-i.node(r).width/2)+","+(i.node(r).y+(T[r]?T[r].y:0)-i.node(r).height/2)+" )"),n.select("#"+y.id+" #"+r).attr("data-x-shift",i.node(r).x-i.node(r).width/2),l.querySelectorAll("#"+y.id+" #"+r+" .divider").forEach(g=>{const f=g.parentElement;let v=0,M=0;f&&(f.parentElement&&(v=f.parentElement.getBBox().width),M=parseInt(f.getAttribute("data-x-shift"),10),Number.isNaN(M)&&(M=0)),g.setAttribute("x1",0-M+8),g.setAttribute("x2",v-M-8)})):S.debug("No Node "+r+": "+JSON.stringify(i.node(r)))});let k=y.getBBox();i.edges().forEach(function(r){r!==void 0&&i.edge(r)!==void 0&&(S.debug("Edge "+r.v+" -> "+r.w+": "+JSON.stringify(i.edge(r))),at(a,i.edge(r),i.edge(r).relation))}),k=y.getBBox();const E={id:s||"root",label:s||"root",width:0,height:0};return E.width=k.width+2*b.padding,E.height=k.height+2*b.padding,S.debug("Doc rendered",E,i),E},"renderDoc"),dt={setConf:rt,draw:ot},Ne={parser:P,get db(){return new N(1)},renderer:dt,styles:W,init:m(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")};export{Ne as diagram};
