import{le as b,aO as O,aj as n,ak as r,am as d,aK as y,aQ as h,gg as w,n as v,bT as $,e3 as g,aJ as _,oZ as C,di as T,bZ as V}from"./chunk-XGpVqsM_.js";import{n as I}from"./chunk-Qdx-kEuS.js";const R=t=>{let e=class extends b.EsriPromiseMixin(t){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(i){this._userInteractive=i}get updating(){return!1}get visible(){return this.parent==null||this.parent.visible&&!this.parent.suspended}set visible(i){this._overrideIfSome("visible",i)}forceInteractive(){return this._interactiveViewModelCount++,O((()=>this._interactiveViewModelCount--))}};return n([r({constructOnly:!0})],e.prototype,"parent",void 0),n([r({constructOnly:!0})],e.prototype,"view",void 0),n([r({type:Boolean})],e.prototype,"interactive",null),n([r()],e.prototype,"_userInteractive",void 0),n([r({readOnly:!0})],e.prototype,"updating",null),n([r()],e.prototype,"visible",null),n([r()],e.prototype,"_interactiveViewModelCount",void 0),e=n([d("esri.views.3d.analysis.AnalysisView3D")],e),e};let p=class extends I{constructor(t){super(t)}initialize(){this.addHandles(y((()=>this.analysisViewData.visible),(t=>this.visible=t),h))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};p=n([d("esri.views.interactive.AnalysisToolBase")],p);function M(t,e){t.interactive=!0;const{tool:i,view:s}=t;s.activeTool=i;let a=C(e,(()=>{s.activeTool===i&&(s.activeTool=null)}));return w((async o=>{await T((()=>!t.tool?.active),o),a=V(a)}),e)}function Z(t,e){return y((()=>t.interactive),(()=>A(t,e)),h)}function A(t,e){t.interactive?j(t,e):f(t)}function j(t,e){f(t);const{view:i,analysis:s}=t,a=new e({view:i,analysis:s,analysisViewData:t});return t.tool=a,i.tools.add(a),a}function f(t){const{view:e,tool:i}=t;i!=null&&(e.tools.remove(i),t.tool=null)}function x(t,e){const i=t.userOperation,s=w((async a=>{if(i){const l=i.promise.catch((()=>{}));i?.abort(),await l,v(a)}const o=M(t,{signal:a}),u=e?.shouldRejectOnCancel??(()=>!0),m=$([g((()=>t.tool),"cancel",(()=>{u()&&o.abort()}))]),{tool:c}=t;try{c&&(c.resetCreated(),e?.onToolActivated?.(c)),await o.promise,v(a)}catch(l){if(a.aborted||!_(l)||u())throw l}finally{m?.remove()}}),{signal:e?.abortOptions?.signal});return t.userOperation=s,s.promise.finally((()=>{t.userOperation===s&&(t.userOperation=null)}))}async function k(t,e){const i=t.analysis.clone();return await x(t,{abortOptions:e?.placementOptions,onToolActivated:e?.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:s}=t;return!s.valid||s.equals(i)}}),{}}export{k as d,f,Z as m,p as o,R as s,x as y};
