import{b as y,_ as T,a as h,t as $}from"./chunk-CZ531eoq.js";import{_ as x}from"./chunk-Wqtp42vn.js";import{V as B,M}from"./chunk-P3cDqhc5.js";import{V as P,a as R}from"./chunk-BJUmiKhw.js";import{T as A}from"./chunk-68dipXmU.js";import{_ as L,a as N}from"./chunk-BAszkjv3.js";/* empty css              */import{d as S,c as k,o as V,w as f,a,u as n,b as j,g as q}from"./chunk-DpJVogQA.js";const I=S({__name:"AgentChatProvider",setup(E){const w=({message:t},{onSuccess:i,onError:e,onUpdate:l})=>{if(!t?.content)return;const r=[],v="assistant";let g=!0,_=!1;const o=new M,m=new AbortController;m.signal.addEventListener("abort",()=>{_=!0,g=!1,o.allViewUpdated(),o.getViews().length===0&&o.upsertView({content:"对话已取消",type:"text",updating:!1}),c()}),c(),N(p=>{let s={content:"",reasoning_content:""};if(typeof p.data=="string")try{s=JSON.parse(p.data)}catch(u){e(u)}s.reasoning_content&&(g=!1,o.upsertView({content:s.reasoning_content,type:"thinking",updating:!0},{onCreate(u){const d=o.getPrevView(u);d&&(d.updating=!1)}}),c()),s.content&&(g=!1,o.upsertView({content:s.content,type:"text",updating:!0},{onCreate(u){const d=o.getPrevView(u);d&&(d.updating=!1)}}),c()),s.is_end&&(_=!0,o.allViewUpdated(),c(),C())},{message:t.content},m);function c(){const p={role:v,seviceLoading:g,seviceEnd:_,views:o.getViews(),abortController:m};l(p),r.push(p)}function C(){i(r)}},b=t=>{const i=t.views;let e=t.content??"";return i&&(e=i.reduce((l,r)=>(r.type==="thinking"?l+=`
${[`:::thinking ${r.updating?"thinking":"end"}`,"```md",r.content,"```",":::"].join(`
`)}`:l+=`
${r.content}`,l),"")),{role:t.role??"assistant",loading:t.seviceLoading===!0,content:e,abortController:t.abortController}};return(t,i)=>(V(),k(n(B),{request:w,parser:b},{default:f(()=>[a(n(P),null,{default:f(()=>[a(n(R),{"markdown-props":{containers:["thinking","agent"],fences:[]}}),a(n(y),null,{default:f(()=>[a(n(T)),a(n(x)),a(n(h),{type:"container:thinking"},{default:f(({raw:e})=>[a(n(A),{content:e.children[0].content,status:e.open.info.split(" ")[1]||"thinking"},null,8,["content","status"])]),_:1}),a(n(h),{type:"container:agent"},{default:f(({raw:e})=>[e.open.info.split(" ")[1]==="echarts"?(V(),k(L,{key:0,content:n($)(e.children),close:e.close},null,8,["content","close"])):q("",!0)]),_:1}),j(t.$slots,"default")]),_:3})]),_:3})]),_:3}))}});export{I as _};
