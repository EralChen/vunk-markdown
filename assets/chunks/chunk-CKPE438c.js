import{gM as I,O,gN as Q,a4 as S,gO as T,gP as R,Q as w,cE as h}from"./chunk-DB7j5ecc.js";import{c as v,C as E,V as M}from"./chunk-DWOo7WlG.js";import{I as j}from"./chunk-PuVz-kKr.js";async function B(e,n,u){const a=I(u),{point:t,distance:i,returnEdge:p,vertexMode:f}=n;if(!p&&f==="none")return{candidates:[]};let r=O(n.query);r=await e.schedule(()=>Q(r,e.definitionExpression,e.spatialReference),a),r=await e.reschedule(()=>v(r,{availableFields:e.availableFields,fieldsIndex:e.fieldsIndex,geometryType:e.geometryType,spatialReference:e.spatialReference}),a);const o=!S(t.spatialReference,e.spatialReference);o&&await T(t.spatialReference,e.spatialReference);const m=typeof i=="number"?i:i.x,d=typeof i=="number"?i:i.y,y={xmin:t.x-m,xmax:t.x+m,ymin:t.y-d,ymax:t.y+d,spatialReference:t.spatialReference},s=o?R(y,e.spatialReference):y;if(!s)return{candidates:[]};const c=(await w(h(t),null,{signal:a}))[0],x=(await w(h(s),null,{signal:a}))[0];if(c==null||x==null)return{candidates:[]};const l=new E(await e.reschedule(()=>e.searchFeatures(M(x.toJSON())),a),r,e);await e.reschedule(()=>e.executeObjectIdsQuery(l),a),await e.reschedule(()=>e.executeTimeQuery(l),a),await e.reschedule(()=>e.executeAttributesQuery(l),a),await e.reschedule(()=>q(e,l,a),a);const g=c.toJSON(),b=o?R(g,e.spatialReference):g,F=o?Math.max(s.xmax-s.xmin,s.ymax-s.ymin)/2:i;return l.createSnappingResponse({...n,point:b,distance:F},t.spatialReference)}async function q(e,n,u){const{query:a}=n,{spatialRel:t}=a;if(!n?.items?.length||!a.geometry||!t)return;const i=await j(t,a.geometry,e.geometryType,e.hasZ,e.hasM),p=await e.runSpatialFilter(n.items,f=>i(f.geometry),u);n.items=p}export{B as u};
