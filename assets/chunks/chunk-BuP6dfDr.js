import{_ as d}from"./chunk-DsYbGKja.js";import{j7 as g,j8 as h,am as w}from"./chunk-B0S82j6z.js";import{x as _,f as D}from"./chunk-DnY6Pqdz.js";import"./chunk-BuZVacDv.js";/* empty css              */import"./chunk-DP0_5kNb.js";let u=class{constructor(){this._tileData=new Map}async generateStreamlines(i){const{flowData:n,flowExtentInfo:t,needsMagnitude:e,simulationSettings:l,startPositions:f}=i,o=m(g(l,n),l,t.modelSize,e,f);return{result:{streamlines:o},transferList:o?.map(a=>a.vertices.buffer)}}async generateTiledStreamlines(i){const{flowDataTiles:n,flowExtentInfo:t,needsMagnitude:e,reset:l,simulationSettings:f,startPositions:o}=i;this._updateTileData(n,l);const a=m(_(f,this._tileData,t),f,t.modelSize,e,o);return{result:{streamlines:a},transferList:a?.map(r=>r.vertices.buffer)??[]}}_updateTileData(i,n){n&&this._tileData.forEach((t,e)=>{i.get(e)==null&&this._tileData.delete(e)}),i.forEach((t,e)=>{t.type==="delete"?this._tileData.delete(e):t.type!=="on-worker"&&t.type!=="waiting"&&this._tileData.set(e,t.data)})}};u=d([w("esri.views.3d.support.flow.FlowWorker")],u);const T=u;function m(i,n,t,e,l){if(i==null)return;const f=h(n,i,t[0],t[1],{positions:l}),o=[],a=D(e);for(const{vertices:r,stage:p}of f){const c=new Float32Array(r.length*a);for(let s=0;s<r.length;s++)c[s*a]=r[s].x,c[s*a+1]=r[s].y,c[s*a+2]=r[s].t,e&&(c[s*a+3]=r[s].speed);o.push({vertices:c,stage:p,hasMagnitude:e})}return o}export{T as default};
