import{a7 as x,a8 as y,dx as E,x as T,a9 as A,aa as b}from"./chunk-XGpVqsM_.js";import{h as M,n as f,j as S,t as C}from"./chunk-C3k8PDaJ.js";import"./chunk-DyqHK6XP.js";import"./chunk-Dix477Sg.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-CrMA_peF.js";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function g(h){return h?.tagName==="CALCITE-TREE-ITEM"}function w(h){return Array.from(h.querySelectorAll("calcite-tree-item:not([disabled])")).filter(t=>{let e=t;for(;e!==h&&e!==void 0;){const s=e.parentElement;if(!(!g(s)||!s.hasChildren||s.expanded))return!1;e=e.parentElement}return!0})}const D=A`:host{display:block}:host(:focus){outline:2px solid transparent;outline-offset:2px}:host([hidden]){display:none}[hidden]{display:none}`;class k extends x{constructor(){super(),this.items=[],this.lines=!1,this.parentExpanded=!1,this.scale="m",this.selectedItems=[],this.selectionMode="single",this.calciteTreeSelect=y({cancelable:!1}),this.listen("focus",this.onFocus),this.listen("focusin",this.onFocusIn),this.listen("focusout",this.onFocusOut),this.listen("calciteInternalTreeItemSelect",this.onInternalTreeItemSelect),this.listen("keydown",this.keyDownHandler)}static{this.properties={child:[7,{},{reflect:!0,type:Boolean}],lines:[7,{},{reflect:!0,type:Boolean}],parentExpanded:[5,{},{type:Boolean}],scale:[3,{},{reflect:!0}],selectedItems:[0,{},{attribute:!1}],selectionMode:[3,{},{reflect:!0}]}}static{this.styles=D}willUpdate(t){t.has("parentExpanded")&&(this.hasUpdated||this.parentExpanded!==!1)&&this.updateItems();const e=this.el.parentElement?.closest("calcite-tree");this.lines=e?e.lines:this.lines,this.scale=e?e.scale:this.scale,this.selectionMode=e?e.selectionMode:this.selectionMode,this.child=!!e}onFocus(){if(!this.child){const t=this.el.querySelector("calcite-tree-item[selected]:not([disabled])")||this.el.querySelector("calcite-tree-item:not([disabled])");M(t)}}onFocusIn(t){(t.relatedTarget===this.el||!this.el.contains(t.relatedTarget))&&this.el.removeAttribute("tabindex")}onFocusOut(t){!this.el.contains(t.relatedTarget)&&(this.el.tabIndex=this.getRootTabIndex())}onInternalTreeItemSelect(t){if(this.child)return;const e=t.target,s=f(e.querySelectorAll("calcite-tree-item"));if(t.preventDefault(),t.stopPropagation(),this.selectionMode==="ancestors"){this.updateAncestorTree(t);return}const n=this.selectionMode==="none",r=this.selectionMode!==null&&(!e.hasChildren||e.hasChildren&&(this.selectionMode==="children"||this.selectionMode==="multichildren")),l=this.selectionMode==="multichildren"&&e.hasChildren,c=!n&&t.detail.modifyCurrentSelection&&(this.selectionMode==="multiple"||this.selectionMode==="multichildren"),m=!c&&((this.selectionMode==="single"||this.selectionMode==="multiple")&&s.length<=0||this.selectionMode==="children"||this.selectionMode==="multichildren"||this.selectionMode==="single-persist"&&!e.hasChildren),d=["multiple","none","single","single-persist"].includes(this.selectionMode)&&e.hasChildren,a=[];r&&a.push(e),m&&f(this.el.querySelectorAll("calcite-tree-item[selected]")).forEach(o=>{a.includes(o)||(o.selected=!1)}),d&&["multiple","none","single","single-persist"].includes(this.selectionMode)&&(e.expanded=!e.expanded),l&&s.forEach(i=>{i.selected=!1,i.hasChildren&&(i.expanded=!1)}),c&&window.getSelection().removeAllRanges(),c&&e.selected?a.forEach(i=>{i.disabled||(i.selected=!1)}):n||a.forEach(i=>{i.disabled||(i.selected=this.selectionMode!=="single"||!i.selected)}),this.selectedItems=n?[]:f(this.el.querySelectorAll("calcite-tree-item")).filter(i=>i.selected),this.calciteTreeSelect.emit(),t.stopPropagation()}keyDownHandler(t){if(this.child)return;const e=this.el,s=t.target,n=["ArrowRight","ArrowDown","ArrowLeft","ArrowUp","Home","End","Tab"];if(!(g(s)&&this.el.contains(s))||!n.includes(t.key))return;const r=w(e);if(t.key==="Tab"){r.forEach(l=>l.tabIndex=-1);return}if(t.key==="ArrowDown"){const l=r.indexOf(s);r[l+1]?.focus(),t.preventDefault();return}if(t.key==="ArrowUp"){const l=r.indexOf(s);r[l-1]?.focus(),t.preventDefault();return}if(t.key==="ArrowLeft"){if(s.hasChildren&&s.expanded){s.expanded=!1,t.preventDefault();return}r.slice(0,r.indexOf(s)).reverse().find(m=>m.depth===s.depth-1)?.focus(),t.preventDefault();return}if(t.key==="ArrowRight"){if(!s.disabled&&s.hasChildren)if(!s.expanded)s.expanded=!0,t.preventDefault();else{const l=r.indexOf(s);r[l+1]?.focus(),t.preventDefault()}return}if(t.key==="Home"){const l=r.shift();l&&(l.focus(),t.preventDefault());return}if(t.key==="End"){const l=r.pop();l&&(l.focus(),t.preventDefault());return}}updateAncestorTree(t){const e=t.target,s=t.detail.updateItem;if(e.disabled||e.indeterminate&&!s)return;const n=[];let r=e.parentElement.closest("calcite-tree-item");for(;r;)n.push(r),r=r.parentElement.closest("calcite-tree-item");const l=Array.from(e.querySelectorAll("calcite-tree-item:not([disabled])")),c=l.filter(i=>!i.hasChildren),m=l.filter(i=>i.hasChildren);let d;s?d=e.hasChildren?!(e.selected||e.indeterminate):!e.selected:d=e.selected,c.forEach(i=>{i.selected=d,i.indeterminate=!1});function a(i,o){const u=i.filter(p=>p.selected),I=i.filter(p=>!p.selected);o.selected=u.length===i.length,o.indeterminate=u.length>0&&I.length>0}m.reverse().forEach(i=>{const o=Array.from(i.querySelectorAll(":scope > calcite-tree > calcite-tree-item"));a(o,i)}),s&&(e.hasChildren?a(l,e):(e.selected=d,e.indeterminate=!1)),n.forEach(i=>{const o=f(i.querySelectorAll("calcite-tree-item")),u=o.filter(p=>p.selected);if(u.length===0){i.selected=!1,i.indeterminate=!1;return}const I=u.length<o.length;i.indeterminate=I,i.selected=!I}),this.selectedItems=f(this.el.querySelectorAll("calcite-tree-item")).filter(i=>i.selected),s&&this.calciteTreeSelect.emit()}updateItems(){this.items.forEach(t=>t.parentExpanded=this.parentExpanded)}handleDefaultSlotChange(t){const e=S(t).filter(s=>s.matches("calcite-tree-item"));this.items=e,this.updateItems()}getRootTabIndex(){return this.child?-1:0}render(){return this.el.ariaMultiSelectable=this.child?void 0:C(this.selectionMode==="multiple"||this.selectionMode==="multichildren"),this.el.role=this.child?void 0:"tree",E(this.el,"tabIndex",this.getRootTabIndex()),T`<slot @slotchange=${this.handleDefaultSlotChange}></slot>`}}b("calcite-tree",k);export{k as Tree};
