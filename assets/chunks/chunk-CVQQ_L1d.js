import{ie as $,y as F,ig as S,I as T,ih as v,ii as h,R as w,id as g}from"./chunk-CZWLvyZS.js";import{d as O,O as Q,V as j}from"./chunk-bazOiTLH.js";import{I as q}from"./chunk-Cw-luiDo.js";async function Z(e,n,u){const a=$(u),{point:t,distance:i,returnEdge:p,vertexMode:d}=n;if(!p&&d==="none")return{candidates:[]};let s=F(n.query);s=await e.schedule((()=>S(s,e.definitionExpression,e.spatialReference)),a),s=await e.reschedule((()=>O(s,{availableFields:e.availableFields,fieldsIndex:e.fieldsIndex,geometryType:e.geometryType,spatialReference:e.spatialReference})),a);const o=!T(t.spatialReference,e.spatialReference);o&&await v(t.spatialReference,e.spatialReference);const f=typeof i=="number"?i:i.x,m=typeof i=="number"?i:i.y,y={xmin:t.x-f,xmax:t.x+f,ymin:t.y-m,ymax:t.y+m,spatialReference:t.spatialReference},r=o?h(y,e.spatialReference):y;if(!r)return{candidates:[]};const x=(await w(g(t),null,{signal:a}))[0],c=(await w(g(r),null,{signal:a}))[0];if(x==null||c==null)return{candidates:[]};const l=new Q(await e.reschedule((()=>e.searchFeatures(j(c.toJSON()))),a),s,e);await e.reschedule((()=>e.executeObjectIdsQuery(l)),a),await e.reschedule((()=>e.executeTimeQuery(l)),a),await e.reschedule((()=>e.executeAttributesQuery(l)),a),await e.reschedule((()=>E(e,l,a)),a);const R=x.toJSON(),b=o?h(R,e.spatialReference):R,I=o?Math.max(r.xmax-r.xmin,r.ymax-r.ymin)/2:i;return l.createSnappingResponse({...n,point:b,distance:I},s.returnZ,t.spatialReference)}async function E(e,n,u){const{query:a}=n,{spatialRel:t}=a;if(!n?.items?.length||!a.geometry||!t)return;const i=await q(t,a.geometry,e.geometryType,e.hasZ,e.hasM),p=await e.runSpatialFilter(n.items,(d=>i(d.geometry)),u);n.items=p}export{Z as u};
