import{_ as r}from"./chunk-DsYbGKja.js";import{ai as d,aj as g,eT as v,bi as f,sF as $,ak as s,rf as C,eu as L,ef as U,am as h,au as b,F as H,al as w}from"./chunk-DbiObNSB.js";import{u as N,a as D,b as E,n as I,r as _}from"./chunk-DWLWd_LJ.js";var c;const y=new WeakMap;let O=0,n=class extends d(g){static{c=this}constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,o,a){if(e instanceof HTMLImageElement){const m={type:"image-element",src:v(e.src,a),crossOrigin:e.crossOrigin};t[o]=m}else if(e instanceof HTMLCanvasElement){const m={type:"canvas-element",imageData:x(e.getContext("2d").getImageData(0,0,e.width,e.height))};t[o]=m}else if(e instanceof HTMLVideoElement){const m={type:"video-element",src:v(e.src,a),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[o]=m}else if(e instanceof ImageData){const m={type:"image-data",imageData:x(e)};t[o]=m}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=M(e.imageData),o=document.createElement("canvas");return o.width=t.width,o.height=t.height,o.getContext("2d").putImageData(t,0,0),o}case"image-data":return M(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const{data:e,url:t}=this,o=a=>a?.toLowerCase().endsWith(".png")||a?.toLocaleLowerCase().startsWith("data:image/png;");return e instanceof HTMLCanvasElement?j(e.getContext("2d").getImageData(0,0,e.width,e.height)):e instanceof ImageData?j(e):!(!t||!o(t))||!!(e instanceof HTMLImageElement&&o(e.src))}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(o="")=>`d:${o},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(y.has(this.data)||y.set(this.data,++O),t(y.get(this.data))):t()}get memoryUsage(){let e=0;if(e+=this.url!=null?this.url.length:0,this.data!=null){const t=this.data;"data"in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}clone(e){const t=N(e),o=t?.textureMap?.get(this);if(o)return o;const a=super.clone(e);return t?.textureMap?.set(this,a),a}static from(e){return typeof e=="string"?new c({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new c({data:e}):f(c,e)}};function x(e){let t="";for(let o=0;o<e.data.length;o++)t+=String.fromCharCode(e.data[o]);return{data:btoa(t),width:e.width,height:e.height}}function M(e){const t=atob(e.data),o=new Uint8ClampedArray(t.length);for(let a=0;a<t.length;a++)o[a]=t.charCodeAt(a);return $(o,e.width,e.height)}function j(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}r([s({type:String,json:{write:C}})],n.prototype,"url",null),r([s({clonable:"reference",json:{write:{overridePolicy(){return{enabled:!this.url}}}}})],n.prototype,"data",null),r([L("data")],n.prototype,"writeData",null),r([U("data")],n.prototype,"readData",null),r([s({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],n.prototype,"transparent",null),r([s({json:{write:!0}})],n.prototype,"wrap",void 0),r([s({readOnly:!0})],n.prototype,"contentHash",null),n=c=r([h("esri.geometry.support.MeshTexture")],n);let u=class extends d(g){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};r([s({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"offset",void 0),r([s({type:Number,nonNullable:!0,json:{write:!0}})],u.prototype,"rotation",void 0),r([s({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"scale",void 0),u=r([h("esri.geometry.support.MeshTextureTransform")],u);let i=class extends d(g){constructor(e){super(e),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(e){const t=D(e),o=t?.materialMap?.get(this);if(o)return o;const a=super.clone(E(e));return t?.materialMap?.set(this,a),a}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let e=0;return e+=this.color!=null?16:0,this.colorTexture!=null&&(e+=this.colorTexture.memoryUsage),e+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(e+=this.normalTexture.memoryUsage),e+=this.normalTextureTransform!=null?20:0,e}};r([s({type:b,json:{write:!0}})],i.prototype,"color",void 0),r([s({type:n,json:{write:!0}})],i.prototype,"colorTexture",void 0),r([s({type:u,json:{write:!0}})],i.prototype,"colorTextureTransform",void 0),r([s({type:n,json:{write:!0}})],i.prototype,"normalTexture",void 0),r([s({type:u,json:{write:!0}})],i.prototype,"normalTextureTransform",void 0),r([s({nonNullable:!0,json:{write:!0}})],i.prototype,"alphaMode",void 0),r([s({nonNullable:!0,json:{write:!0}})],i.prototype,"alphaCutoff",void 0),r([s({nonNullable:!0,json:{write:!0}})],i.prototype,"doubleSided",void 0),i=r([h("esri.geometry.support.MeshMaterial")],i);let l=class extends i{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}};r([s({type:b,json:{write:!0}})],l.prototype,"emissiveColor",void 0),r([s({type:n,json:{write:!0}})],l.prototype,"emissiveTexture",void 0),r([s({type:u,json:{write:!0}})],l.prototype,"emissiveTextureTransform",void 0),r([s({type:n,json:{write:!0}})],l.prototype,"occlusionTexture",void 0),r([s({type:u,json:{write:!0}})],l.prototype,"occlusionTextureTransform",void 0),r([s({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],l.prototype,"metallic",void 0),r([s({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],l.prototype,"roughness",void 0),r([s({type:n,json:{write:!0}})],l.prototype,"metallicRoughnessTexture",void 0),r([s({type:u,json:{write:!0}})],l.prototype,"metallicRoughnessTextureTransform",void 0),l=r([h("esri.geometry.support.MeshMaterialMetallicRoughness")],l);var T;let p=T=class extends d(g){static from(e){return f(T,e)}constructor(e){super(e),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return I(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},H.getLogger(this))}castMaterial(e){return f(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?l:i,e)}get memoryUsage(){let e=0;return this.faces!=null&&(e+=this.faces.byteLength),this.material!=null&&(e+=this.material.memoryUsage),e}};r([s({json:{write:_}})],p.prototype,"faces",void 0),r([w("faces")],p.prototype,"castFaces",null),r([s({type:i,json:{write:!0}})],p.prototype,"material",void 0),r([w("material")],p.prototype,"castMaterial",null),r([s({json:{write:!0}})],p.prototype,"name",void 0),r([s({type:String,json:{write:!0}})],p.prototype,"shading",void 0),r([s({type:Boolean})],p.prototype,"trustSourceNormals",void 0),p=T=r([h("esri.geometry.support.MeshComponent")],p);export{n as g,p as h,u as p,l as u};
