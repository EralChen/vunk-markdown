import{ar as h,aJ as c,aP as d,s as o,gf as u,n as V,bX as p,aC as A,fR as _,ai as n,aj as r,al as v}from"./chunk-cvHeDBxF.js";let t=class extends h{get updating(){return this._createAnalysisViewTask!=null||this.analysisView!=null&&this.analysisView.updating}constructor(s){super(s),this._analysisModule=null,this._emitOnView=(e,a)=>this.parent.view.emit(e,a)}initialize(){this.addHandles(c((()=>this.getAnalysis()),(s=>this._createAnalysisView(s)),d))}destroy(){this._destroyAnalysisView()}async whenAnalysisView(){if(this.analysisView!=null)return this.analysisView;if(this._createAnalysisViewTask!=null)return this._createAnalysisViewTask.promise;throw new o("layerview:no-analysisview-for-analysis","The analysis has not been set on the layer of this layer view")}_createAnalysisView(s){const e=this._createAnalysisViewTask?.promise;if(this._destroyAnalysisView(),!s)return;const a=u((async l=>{try{await Promise.allSettled([e]);const i=await this._createAnalysisViewPromise(s,l);return V(l),this.analysisView=i,this._emitOnView("analysis-view-create",{analysis:s,analysisView:i}),i}catch(i){throw this._emitOnView("analysis-view-create-error",{analysis:s,error:i}),i}finally{this._createAnalysisViewTask===a&&(this._createAnalysisViewTask=null)}}));this._createAnalysisViewTask=a}_destroyAnalysisView(){const s=this.getAnalysis();this._createAnalysisViewTask=p(this._createAnalysisViewTask);const{analysisView:e}=this;e&&(this.analysisView=A(e),this._emitOnView("analysis-view-destroy",{analysis:s,analysisView:e}))}async _createAnalysisViewPromise(s,e){let a,l=this._analysisModule;const i=w=>{if(!_(w))return;a?.destroy();const y=this.getAnalysis();throw new o("layerview:no-analysisview-for-analysis",y!=null&&s!==y?"The analysis changed before the analysis view could be created":"The analysis has not been added to the layer of this layer view",{analysis:s})};return l||(l=await this.loadAnalysisViewModule(),i(e),this._analysisModule=l),a=new l.default({analysis:s,parent:this.parent,view:this.parent.view}),await a.when(),i(e),a}};n([r({constructOnly:!0})],t.prototype,"getAnalysis",void 0),n([r({constructOnly:!0})],t.prototype,"loadAnalysisViewModule",void 0),n([r({constructOnly:!0})],t.prototype,"parent",void 0),n([r()],t.prototype,"analysisView",void 0),n([r()],t.prototype,"_createAnalysisViewTask",void 0),n([r()],t.prototype,"updating",null),n([r()],t.prototype,"_analysisModule",void 0),t=n([v("esri.views.3d.layers.support.LayerViewAnalysisViewManager")],t);export{t as h};
