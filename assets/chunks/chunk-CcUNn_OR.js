import{c2 as g,dd as u,aj as o,am as h,fL as w,aK as n,aQ as c,ar as y,d7 as x,ak as l}from"./chunk-XGpVqsM_.js";import{C as _,h as f}from"./chunk-BttyZXvq.js";import{b as D}from"./chunk-EbsByUpQ.js";import{w as H}from"./chunk-rwmoHDrt.js";import{m as b}from"./chunk-Dnh1XqyV.js";import"./chunk-DyqHK6XP.js";import"./chunk-Dix477Sg.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-CrMA_peF.js";import"./chunk-BS6MVtAd.js";import"./chunk-BoY5tY6Y.js";import"./chunk-CFw9_Mlk.js";import"./chunk-DTv8BWs_.js";import"./chunk-CTxi0THw.js";import"./chunk-D0Rb7foR.js";import"./chunk-B_0s3AtF.js";import"./chunk-Chy3Nvc4.js";import"./chunk-aL52J51R.js";let p=class extends _{constructor(t){super(t),this.redrawDebounced=g((async i=>{this.redraw(((e,r)=>this._redrawImage(e,r)),i)}),2e3)}initialize(){this.addHandles([u((()=>this.view.basemapTerrain.ready),(()=>this._initializeMaximumDataResolution()),{once:!0,initial:!0}),this.layer.on("redraw",(()=>this.updatingHandles.addPromise(this.redrawDebounced())))])}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}async processResult(t,i,e){i.imageOrCanvasElement?t.image=i.imageOrCanvasElement:(t.image=document.createElement("canvas"),t.pixelData=i.pixelData,await this._redrawImage(t,e))}async _redrawImage(t,i){if(!(t.image instanceof HTMLCanvasElement)||t.pixelData==null)throw new Error;const e=t.image,r=e.getContext("2d"),d=await this.layer.applyRenderer(t.pixelData,{signal:i}),a=this.layer.applyFilter(d).pixelBlock;if(a==null)throw new Error;e.width=a.width,e.height=a.height;const m=r.createImageData(a.width,a.height);m.data.set(a.getAsRGBA()),r.putImageData(m,0,0)}};p=o([h("esri.views.3d.layers.ImagerySubView3D")],p);let s=class extends b(f){constructor(){super(...arguments),this.type="imagery-3d"}get highlightOptions(){return null}get pixelData(){return null}initialize(){const t=()=>this._updatingHandles.addPromise(this.refreshDebounced());this._updatingHandles.add((()=>this.layer?.exportImageServiceParameters?.version),t),this._updatingHandles.add((()=>this.layer?.renderer),t),this._updatingHandles.add((()=>this.timeExtent),t),this._highlightHelper=new H({view:this.view,layer:this.layer,updatingHandles:this._updatingHandles}),this.addHandles([w(this._highlightHelper),n((()=>this.suspended),(i=>this._highlightHelper.suspended=i),c)])}_initSubView(){this.addHandles([n((()=>this.layer.renderer),(t=>this._recreateSubView(t)),y)])}_recreateSubView(t){const i=t?.type==="flow",e=this.subView?.type==="flow",r=this.subView;r&&i===e||(this.subView=i&&x("enable-feature:3d-flow")?new D({layerView:this}):new p({layerView:this}),r?.destroy())}getFetchOptions(){return{timeExtent:this.timeExtent}}highlight(t,i){return this._highlightHelper.highlight(t,i)}isUpdating(){return super.isUpdating()||this._highlightHelper.updating}};o([l()],s.prototype,"highlightOptions",null),o([l()],s.prototype,"pixelData",null),s=o([h("esri.views.3d.layers.ImageryLayerView3D")],s);const bt=s;export{bt as default};
