import{iW as v,N as M,bj as c,iX as d,b6 as g,iY as h,iZ as y,i_ as I,i$ as w,j0 as S}from"./chunk-DbiObNSB.js";import{u as x,c as m,i as F,f as O}from"./chunk-DORsKcix.js";import"./chunk-DsYbGKja.js";import"./chunk-BBnM6NiO.js";/* empty css              */import"./chunk-rsBP39gk.js";class j{transform(t){const a=this._transform(t),e=[a.points.buffer,a.rgb.buffer];a.pointIdFilterMap!=null&&e.push(a.pointIdFilterMap.buffer);for(const i of a.attributes)"buffer"in i.values&&v(i.values.buffer)&&i.values.buffer!==a.rgb.buffer&&e.push(i.values.buffer);return Promise.resolve({result:a,transferList:e})}_transform(t){const a=x(t.schema,t.geometryBuffer);let e=a.length/3,i=null;const f=new Array,n=m(t.primaryAttributeData,a,e);t.primaryAttributeData!=null&&n&&f.push({attributeInfo:t.primaryAttributeData.attributeInfo,values:n});const s=m(t.modulationAttributeData,a,e);t.modulationAttributeData!=null&&s&&f.push({attributeInfo:t.modulationAttributeData.attributeInfo,values:s});let r=F(t.rendererInfo,n,s,e);if(t.filterInfo&&t.filterInfo.length>0&&t.filterAttributesData!=null){const l=t.filterAttributesData.filter(M).map(o=>{const D=m(o,a,e),p={attributeInfo:o.attributeInfo,values:D};return f.push(p),p});i=new Uint32Array(e),e=O(a,r,i,t.filterInfo,l)}for(const l of t.userAttributesData){const o=m(l,a,e);f.push({attributeInfo:l.attributeInfo,values:o})}3*e<r.length&&(r=new Uint8Array(r.buffer.slice(0,3*e))),_(a,e,t.elevationOffset);const b=N(a,e,d.fromData(t.obbData),c.fromJSON(t.inSR),c.fromJSON(t.outSR));return{obbData:t.obbData,points:b,rgb:r,attributes:f,pointIdFilterMap:i}}}function N(u,t,a,e,i){if(!g(u,e,0,u,i,0,t))throw new Error("Can't reproject");const f=h(a.center),n=I(),s=I(),r=h(a.halfSize);y(A,a.quaternion);const b=new Float32Array(3*t);for(let l=0;l<t;l++){let o=3*l;n[0]=u[o]-f[0],n[1]=u[o+1]-f[1],n[2]=u[o+2]-f[2],w(s,n,A),r[0]=Math.max(r[0],Math.abs(s[0])),r[1]=Math.max(r[1],Math.abs(s[1])),r[2]=Math.max(r[2],Math.abs(s[2])),b[o++]=n[0],b[o++]=n[1],b[o]=n[2]}return a.halfSize=r,b}function _(u,t,a){if(a!==0)for(let e=0;e<t;e++)u[3*e+2]+=a}const A=S();function C(){return new j}export{C as default};
