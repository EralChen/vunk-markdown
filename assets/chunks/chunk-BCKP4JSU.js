import{_ as w}from"./chunk-DsYbGKja.js";import{aF as d,aL as v,am as y,gd as p,n as c,bx as h,eo as b,aE as O,h1 as $,dh as T,bB as g}from"./chunk-DbiObNSB.js";import{r as A}from"./chunk-CTyU4wrK.js";let u=class extends A{constructor(t){super(t)}initialize(){this.addHandles(d(()=>this.analysisViewData.visible,t=>this.visible=t,v))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};u=w([y("esri.views.interactive.AnalysisToolBase")],u);function C(t,a){t.interactive=!0;const{tool:e,view:s}=t;s.activeTool=e;let i=$(a,()=>{s.activeTool===e&&(s.activeTool=null)});return p(async n=>{await T(()=>!t.tool?.active,n),i=g(i)},a)}function V(t,a){return d(()=>t.interactive,()=>_(t,a),v)}function _(t,a){t.interactive?j(t,a):f(t)}function j(t,a){f(t);const{view:e,analysis:s}=t,i=new a({view:e,analysis:s,analysisViewData:t});return t.tool=i,e.tools.add(i),i}function f(t){const{view:a,tool:e}=t;e!=null&&(a.tools.remove(e),t.tool=null)}function x(t,a){const e=t.userOperation,s=p(async i=>{if(e){const o=e.promise.catch(()=>{});e?.abort(),await o,c(i)}const n=C(t,{signal:i}),l=a?.shouldRejectOnCancel??(()=>!0),m=h([b(()=>t.tool,"cancel",()=>{l()&&n.abort()})]),{tool:r}=t;try{r&&(r.resetCreated(),a?.onToolActivated?.(r)),await n.promise,c(i)}catch(o){if(i.aborted||!O(o)||l())throw o}finally{m?.remove()}},{signal:a?.abortOptions?.signal});return t.userOperation=s,s.promise.finally(()=>{t.userOperation===s&&(t.userOperation=null)})}async function q(t,a){const e=t.analysis.clone();return await x(t,{abortOptions:a?.placementOptions,onToolActivated:a?.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:s}=t;return!s.valid||s.equals(e)}}),{}}export{q as d,f,V as m,u as o,x as y};
