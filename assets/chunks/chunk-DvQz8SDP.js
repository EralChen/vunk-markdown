import{V as C}from"./chunk-CoPuPkIg.js";import{r as v,av as w,a4 as I,d as S,c as A,o as T,w as V,b as x,e as L,u as c}from"./chunk-D3r4aXmB.js";var k=(e=>(e.User="user",e.Assistant="assistant",e))(k||{});const M=[{label:"用户",value:"user",isMarkdown:!1,placement:"end",templateType:"Typewriter"},{label:"助手",value:"assistant",placement:"start",templateType:"VkMarkdown"}],$=M.reduce((e,t)=>(e[t.value]=t,e),{}),z="1284bf40-44d3-11f0-b87e-e2bb3033b0f6",b="application-75e669f4809759ce384605945f907cf8";async function B(e){return w({method:"GET",url:`/application/${e.application_id}/chat/open`,headers:{authorization:b}}).then(t=>t.data)}async function E(e,t,s){return I.reader({url:`/application/chat_message/${t.chatId}`,onmessage:e,abortController:s},{headers:{authorization:b},data:{message:t.message}})}function N(){const e=v(""),t=v(!1);return B({application_id:z}).then(n=>{e.value=n,t.value=!0}),{request:(n,i)=>{const{message:h}=n,{onSuccess:y,onUpdate:q}=i;if(!h?.content)return;const u=new AbortController;let l="";const g=k.Assistant;let r="",p="start",d=!0;const o=()=>{q({role:g,content:l,thinkingContent:r,thinkingStatus:p,seviceLoading:d,abortController:u})},m=()=>{y({role:g,content:l,thinkingContent:r,thinkingStatus:"end",seviceLoading:!1,seviceEnd:!0,abortController:u})};o(),E(_=>{let a={content:"",reasoning_content:""};if(typeof _.data=="string"&&(a=JSON.parse(_.data)),a.is_end){m();return}a.reasoning_content&&(r+=a.reasoning_content,p="thinking",d=!1,o()),a.content&&(l+=a.content,d=!1,o()),r&&a.content&&(p="end",o())},{message:h?.content,chatId:e.value},u).catch(()=>{m()})},parser:n=>[{...n,...$[n.role],loading:n.seviceLoading}],ready:t}}const j=S({__name:"index",setup(e){const{ready:t,request:s,parser:f}=N();return(n,i)=>(T(),A(c(C),{parser:c(f),request:c(s)},{default:V(()=>[c(t)?x(n.$slots,"default",{key:0}):L("",!0)]),_:3},8,["parser","request"]))}});export{j as _};
