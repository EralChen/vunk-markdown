import{ai as F,al as P,s as l,gi as u,gs as b,gt as v,gu as I}from"./chunk-CET6Djna.js";const x=d=>{let r=class extends d{_validateFetchPopupFeatures(t){const{layer:s}=this,{popupEnabled:i}=s;if(!i)throw new l("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:s});if(!u(s,t))throw new l("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:s})}async prepareFetchPopupFeatures(t){}async fetchPopupFeaturesFromGraphics(t,s){if(this._validateFetchPopupFeatures(s),t.length===0)return[];const i=this.layer.type==="scene"&&this.layer.associatedLayer!=null?this.layer.associatedLayer:this.layer;let p=[];"fieldsIndex"in this.layer&&(p=b(this.layer.fieldsIndex,await v(i,u(this.layer,s)))),await this.prepareFetchPopupFeatures(p);const o=new Set,n=[],a=[];for(const e of t)I(e,p,o)?a.push(e):n.push(e);if(a.length===0)return n;const c=new Map;for(let e=0;e<t.length;e++)c.set(t[e].getObjectId()??0,e);const h=await this.whenGraphicAttributes(a,[...o]).catch((()=>a)).then((e=>n.concat(e)));return h.sort(((e,y)=>{const f=e.getObjectId()??0,w=c.get(f)??0,g=y.getObjectId()??0;return w-(c.get(g)??0)})),h}};return r=F([P("esri.views.3d.layers.support.PopupSceneLayerView")],r),r};export{x as i};
