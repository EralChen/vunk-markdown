import{hy as F,hp as y,bj as p}from"./chunk-BrJ3DEnk.js";import{a as b}from"./chunk-dAS3to-g.js";import{CIMSymbolRasterizer as R}from"./chunk-CdztC__8.js";import{OverrideHelper as V}from"./chunk-WT0sxVoT.js";import{l as $,t as S}from"./chunk-CXxqRx15.js";import"./chunk-B5uEfUiB.js";import"./chunk-BY4ynHbL.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-SqlbPPT2.js";import"./chunk-QXap_35O.js";import"./chunk-BfMkR9-C.js";import"./chunk-CUzevAry.js";import"./chunk-Cky24vJb.js";import"./chunk-C1bWBi-v.js";import"./chunk-CMARrY9N.js";import"./chunk-8WtPGj6h.js";const f=new R(null),u=p(S.size),P=p(S.maxSize),M=p(S.lineWidth),q=1;async function D(a,t,l){const e=t?.size;let i=e!=null&&typeof e=="object"&&"width"in e?e.width:e,r=e!=null&&typeof e=="object"&&"height"in e?e.height:e;if(i==null||r==null)if(l==="esriGeometryPolygon")i=r=t.maxSize?Math.min(t.maxSize,u):u;else{const o=await E(a,t,l);o&&(i=o.width,r=o.height),l==="esriGeometryPolyline"&&(i=t.maxSize?Math.min(t.maxSize,M):M),i=i!=null&&isFinite(i)?Math.min(i,P):u,r=r!=null&&isFinite(r)?Math.max(Math.min(r,P),q):u}return t.style==="legend"&&l==="esriGeometryPolyline"&&(i=M),{width:i,height:r}}async function E(a,t,l){const{feature:e,fieldMap:i,viewParams:r}=t.cimOptions||t,o=await V.resolveSymbolOverrides(a.data,e,null,i,l,null,r);if(!o)return null;(a=a.clone()).data={type:"CIMSymbolReference",symbol:o},a.data.primitiveOverrides=void 0;const n=[];return b.fetchResources(o,f.resourceManager,n),b.fetchFonts(o,f.resourceManager,n),n.length>0&&await Promise.all(n),b.getEnvelope(o,null,f.resourceManager)}async function qt(a,t={}){const{node:l,opacity:e,symbolConfig:i}=t,r=i!=null&&typeof i=="object"&&"isSquareFill"in i&&i.isSquareFill,o=t.cimOptions||t,n=o.geometryType||F(a?.data?.symbol),m=await D(a,t,n),{feature:C,fieldMap:G}=o,I=t?.geometry||r||n!=="esriGeometryPolygon"?"preview":"legend";let v=m;const x=m;if(t?.geometry&&(n==="esriGeometryPolygon"||n==="esriGeometryPolyline")&&(y(m.width)<200||y(m.height)<200)){const j=m.width>m.height?p(200)*m.height/m.width:p(200);v={width:m.width>m.height?p(200):p(200)*m.width/m.height,height:j}}const g=await f.rasterizeCIMSymbolAsync(a,C,v,I,G,n,null,o.viewParams,o.allowScalingUp,t?.geometry?.toJSON());if(!g)return null;const{width:L,height:O}=g,h=document.createElement("canvas");h.width=L,h.height=O,h.getContext("2d").putImageData(g,0,0);const d=y(x.width),w=y(x.height),s=new Image(d,w);s.src=h.toDataURL(),s.ariaLabel=t.ariaLabel??null,s.alt=t.ariaLabel??"",e!=null&&(s.style.opacity=`${e}`);let c=s;if(t.effectView!=null){const z={shape:{type:"image",x:0,y:0,width:d,height:w,src:s.src},fill:null,stroke:null,offset:[0,0]};c=$([[z]],[d,w],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return l&&c&&l.appendChild(c),c}export{qt as previewCIMSymbol};
