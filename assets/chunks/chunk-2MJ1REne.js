import{aj as i,ak as n,am as O,gK as P,gL as x,s as S,gj as F,gM as L,gN as $,z as A,gk as _,gO as s,gP as k}from"./chunk-XGpVqsM_.js";import{i as z}from"./chunk-aL52J51R.js";const D=E=>{let t=class extends E{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return z(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?P(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(l){try{return!this.layer.loaded||!!x(this.layer.serviceRasterInfo,l)}catch{return!1}}async fetchPopupFeaturesAtLocation(l,d){const{layer:e}=this;if(!l)throw new S("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:w}=e,R=F(e,d);if(!w||R==null)return[];const f=[],{value:o,magdirValue:h,processedValue:T}=await e.identify(l,{timeExtent:this.timeExtent,signal:d?.signal});let c="";if(o?.length){c=e.type==="imagery-tile"&&e.hasStandardTime()&&o[0]!=null?o.map((y=>e.getStandardTimeValue(y))).join(", "):o.join(", ");const r={ObjectId:0};r[s.servicePixelValue]=e.type==="imagery-tile"&&L(e.raster)?T?.join(", "):c,r[s.rawServicePixelValue]=c;const m=e.raster?.rasterInfo??e.serviceRasterInfo,p=m?.attributeTable;if(p!=null){const{fields:y,features:V}=p,v=y.find((({name:a})=>a.toLowerCase()==="value")),j=r[s.servicePixelValue],u=v?V.find((a=>String(a.attributes[v.name])===j)):null;if(u)for(const a in u.attributes)u.attributes.hasOwnProperty(a)&&(r[k+a]=u.attributes[a])}const g=m?.dataType;g!=="vector-magdir"&&g!=="vector-uv"||(r[s.magnitude]=h?.[0],r[s.direction]=h?.[1]);const{multidimensionalDefinition:b}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});$(e.rasterFields,r,b);const I=new A({geometry:this.fullExtent?.clone(),attributes:r,layer:e,sourceLayer:e});f.push(I)}return f}async getSourceScale(){return await this.layer.load(),_(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return x(this.layer.serviceRasterInfo,this.view.spatialReference)}};return i([n()],t.prototype,"fullExtent",null),i([n()],t.prototype,"layer",void 0),i([n({readOnly:!0})],t.prototype,"timeExtent",null),i([n()],t.prototype,"tileInfo",void 0),i([n({readOnly:!0})],t.prototype,"hasTilingEffects",null),i([n()],t.prototype,"datumTransformation",null),t=i([O("esri.views.layers.ImageryTileLayerView")],t),t};export{D as f};
