import{iF as C,gc as y,bC as p}from"./chunk-CuaFhuP3.js";import{a as b}from"./chunk-BnVb9rzE.js";import{CIMSymbolRasterizer as L}from"./chunk-Cj0ptgC-.js";import{OverrideHelper as R}from"./chunk-CxCp05cb.js";import{l as q,t as M}from"./chunk-CQKD2SKz.js";import"./chunk-Dpk1TJd9.js";import"./chunk-iOPJXyP1.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-DGmg3LSc.js";import"./chunk-QXap_35O.js";import"./chunk-HW0UV52H.js";import"./chunk-CUzevAry.js";import"./chunk-CoihRuOM.js";import"./chunk-Dzjh6wc3.js";import"./chunk-BZ2iHbAJ.js";import"./chunk-CB8wlU_f.js";const u=new L(null),g=p(M.size),x=p(M.maxSize),S=p(M.lineWidth),D=1;async function E(m,t,l){const r=t?.size;let i=r!=null&&typeof r=="object"&&"width"in r?r.width:r,o=r!=null&&typeof r=="object"&&"height"in r?r.height:r;if(!i||!o)if(l==="esriGeometryPolygon")i=o=t.maxSize?Math.min(t.maxSize,g):g;else{const n=await T(m,t,l);n&&(i=n.width,o=n.height),l==="esriGeometryPolyline"&&(i=t.maxSize?Math.min(t.maxSize,S):S),i=i!=null&&isFinite(i)?Math.min(i,x):g,o=o!=null&&isFinite(o)?Math.max(Math.min(o,x),D):g}return t.style==="legend"&&l==="esriGeometryPolyline"&&(i=S),{width:i,height:o}}async function T(m,t={},l){const r=t.cimOptions||t;l??=r.geometryType||C(m?.data?.symbol);const{feature:i,fieldMap:o,viewParams:n}=r,a=await R.resolveSymbolOverrides(m.data,i,null,o,l,null,n);if(!a)return null;(m=m.clone()).data={type:"CIMSymbolReference",symbol:a},m.data.primitiveOverrides=void 0;const e=[];return b.fetchResources(a,u.resourceManager,e),b.fetchFonts(a,u.resourceManager,e),e.length>0&&await Promise.all(e),b.getEnvelope(a,null,u.resourceManager)}async function Dt(m,t={}){const{node:l,opacity:r,symbolConfig:i}=t,o=i!=null&&typeof i=="object"&&"isSquareFill"in i&&i.isSquareFill,n=t.cimOptions||t,a=n.geometryType||C(m?.data?.symbol),e=await E(m,t,a),{feature:I,fieldMap:F}=n,G=t?.geometry||o||a!=="esriGeometryPolygon"?"preview":"legend";let v=e;const z=e;if(t?.geometry&&(a==="esriGeometryPolygon"||a==="esriGeometryPolyline")&&(y(e.width)<200||y(e.height)<200)){const j=e.width>e.height?p(200)*e.height/e.width:p(200);v={width:e.width>e.height?p(200):p(200)*e.width/e.height,height:j}}const d=await u.rasterizeCIMSymbolAsync(m,I,v,G,F,a,null,n.viewParams,n.allowScalingUp,t?.geometry?.toJSON());if(!d)return null;const{width:O,height:$}=d,h=document.createElement("canvas");h.width=O,h.height=$,h.getContext("2d").putImageData(d,0,0);const f=y(z.width),w=y(z.height),s=new Image(f,w);s.src=h.toDataURL(),s.ariaLabel=t.ariaLabel??null,s.alt=t.ariaLabel??"",r!=null&&(s.style.opacity=`${r}`);let c=s;if(t.effectView!=null){const P={shape:{type:"image",x:0,y:0,width:f,height:w,src:s.src},fill:null,stroke:null,offset:[0,0]};c=q([[P]],[f,w],t)}return l&&c&&l.appendChild(c),c}export{T as getCIMSymbolPreviewSize,Dt as previewCIMSymbol};
