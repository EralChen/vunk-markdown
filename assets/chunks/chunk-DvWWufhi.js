import{j as x}from"./chunk-B8h3Mgtp.js";import{f as c,i as l,u as h,J as p,F as d,d as O,K as g}from"./chunk-AYRxNqGd.js";function k(e){const a=Math.max(e.lastIndexOf("}"),e.lastIndexOf("]"),e.lastIndexOf(","));return a===-1?"":e.slice(0,a+1)}function v(e,a={}){const r=a.repair??!0,t=c(null),s=l(()=>k(h(e))),n=c(),o=c(!1);return p(async()=>{if(s.value){await d(),o.value=!1,n.value=null;try{t.value=JSON.parse(s.value)}catch(i){if(!r){n.value=i;return}try{const u=x(s.value);t.value=JSON.parse(u),o.value=!0}catch(u){n.value=u}}}}),{json:t,error:n,repaired:o}}const w={source:{type:null,default:()=>[]},repair:{type:Boolean,default:!0}},I={},f=O({name:"VkResolverJson",props:w,emits:I,setup(e,{slots:a}){const r=c();p(async()=>{g(e.source),await d();const j=(Array.isArray(e.source)?e.source:[e.source]).find(J=>J.info?.split(" ")[0]==="json");r.value=j});const t=l(()=>r.value?r.value.info.split(" "):[]),s=l(()=>t.value[0]||""),n=l(()=>t.value.slice(1).join(" ")||""),o=l(()=>r.value?.content||""),{json:i,error:u,repaired:m}=v(o,{repair:e.repair}),{json:y}=v(n);return()=>r.value?a.default?.({language:s.value,description:n.value,content:o.value,json:i.value,attrs:y.value,repaired:m.value,error:u.value}):null}});f.install=e=>{e.component(f.name||"VkResolverJson",f)};export{f as _};
