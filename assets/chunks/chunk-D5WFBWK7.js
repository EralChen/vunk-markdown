import{GN as E,GI as H,GJ as y,H3 as D,H4 as O,H5 as w,H6 as x,H7 as A,bR as n,H8 as P,GK as _,H9 as S,GM as C,Ha as R,p4 as N,GO as G,GP as M,Hb as I,GQ as V,Hc as j,Hd as F,He as L,Hf as B,GR as U,Hg as z,Hh as W,Hi as q,Hj as k,GS as Q,Hk as J,GU as K,Hl as X,jb as g,qc as Y,Hm as Z,ar as c,Hn as u,GT as ee,p5 as f,Ho as m,Hp as v,Hq as te,Hr as se,Hs as ie,GV as ae,vk as re,Ht as oe,Hu as ne,qe as le}from"./chunk-Br7Cq08f.js";import{f as ce}from"./chunk-CeS5M_tG.js";import{_ as ue}from"./chunk-CPn_Zo84.js";class T extends E{}function $(s){const e=new H,{vertex:t,fragment:i}=e,{output:d,perspectiveInterpolation:a}=s;return y(t,s),e.include(D,s),e.include(O,s),e.fragment.include(w,s),e.include(x,s),e.include(A,s),e.attributes.add(n.POSITION,"vec3"),e.attributes.add(n.UV0,"vec2"),a&&e.attributes.add(n.PERSPECTIVEDIVIDE,"float"),t.main.add(_`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${P(a,"gl_Position *= perspectiveDivide;")}`),e.varyings.add("vpos","vec3"),e.varyings.add("vTexCoord","vec2"),i.include(S),i.uniforms.add(new C("opacity",r=>r.opacity),new R("tex",r=>r.texture)).main.add(_`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${P(d===N.ObjectAndLayerIdColor,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos);`),e}const pe=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:T,build:$},Symbol.toStringTag,{value:"Module"}));let de=class extends G{constructor(e,t){super(e,t,new M(pe,()=>ue(()=>Promise.resolve().then(()=>ge),void 0)),b)}_getPipelineState(e,t){const{oitPass:i,output:d,hasOccludees:a,enableOffset:r,cullFace:p}=e,l=i===I.NONE,h=i===I.FrontFace;return V({blending:K(d)?l?Q:J(i):null,culling:k(p),depthTest:{func:q(i)},depthWrite:W(e),drawBuffers:z(i,d),colorWrite:U,stencilWrite:a?B:null,stencilTest:a?t?F:L:null,polygonOffset:l||h?null:j(r)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}};const b=new Map([[n.POSITION,0],[n.UV0,2],[n.PERSPECTIVEDIVIDE,3]]);class o extends X{constructor(){super(...arguments),this.cullFace=g.None,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=Y.None,this.emissionSource=Z.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}c([u({count:g.COUNT})],o.prototype,"cullFace",void 0),c([u()],o.prototype,"enableOffset",void 0),c([u()],o.prototype,"writeDepth",void 0),c([u()],o.prototype,"hasOccludees",void 0),c([u()],o.prototype,"terrainDepthTest",void 0),c([u()],o.prototype,"cullAboveTerrain",void 0),c([u()],o.prototype,"perspectiveInterpolation",void 0);class Te extends ee{constructor(e){super(e,ve),this._configuration=new o,this.vertexAttributeLocations=b,this.supportsEdges=!0,this.produces=new Map([[f.OPAQUE_MATERIAL,t=>m(t)],[f.TRANSPARENT_MATERIAL,t=>v(t)&&this.parameters.writeDepth],[f.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,t=>v(t)&&!this.parameters.writeDepth],[f.DRAPED_MATERIAL,t=>v(t)||m(t)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<te,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new he(e)}createBufferWriter(){const e=ce.clone();return this.parameters.perspectiveInterpolation&&e.f32(n.PERSPECTIVEDIVIDE),new fe(e)}}class he extends ie{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(de,e)}}class fe extends ae{write(e,t,i,d,a,r){for(const p of this.vertexBufferLayout.fields.keys()){const l=i.get(p);if(l)if(p===n.PERSPECTIVEDIVIDE){re(l.size===1);const h=a.getField(p,oe);h&&ne(l,h,r)}else le(p,l,e,t,a,r)}}}class ve extends se{constructor(e){super(),this.textureId=e,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=g.None,this.opacity=1,this.perspectiveInterpolation=!1}}const ge=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:T,build:$},Symbol.toStringTag,{value:"Module"}));export{Te as I};
