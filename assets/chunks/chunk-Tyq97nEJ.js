import{e as y,b as et,j as xt,P as Rt,a as Ct,x as _t,o as Mt,d as ft,k as Dt,L as Tt,n as Y,B as Z,M as Gt,s as Et,t as U,u as D,Q as lt,Y as b,$ as Pt}from"./chunk-BALWqwPe.js";import{K as G,a2 as A,G as st,a3 as x,az as zt,aA as k,L as J,a as wt,o as ut,j as ct,f as pt,n as N,p as Lt,m as it,a6 as kt,aB as rt,aC as Ft,a0 as qt,aD as St,aE as gt,aF as C,g as R,aG as yt,aH as K,w as Ot,a1 as bt,U as Nt}from"./chunk-BprwJtTT.js";import{w as Ut}from"./chunk-DRJhmUhU.js";import{hl as F,hm as tt}from"./chunk-DYmUVOBN.js";import"./chunk-B92kdZ15.js";import"./chunk-DODhI9iV.js";import"./chunk-DdHotv1K.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-SqlbPPT2.js";let Jt=class{constructor(t,i,s,n,a=0,e=4){this.m_ptDistFrom=new y,this.m_segStartPt=new y,this.m_segEndPt=new y,this.m_geodeticLength=new G,this.m_az12=new G,this.m_minGeodeticDist=new G,this.m_segStartPt3d=new A,this.m_segEndPt3d=new A,this.m_sr=n,this.m_distCurveType=a,this.m_segCurveType=e,this.m_inputGCS=this.m_sr.getGCS(),this.m_rpu=this.m_inputGCS.getUnit().getUnitToBaseFactor(),this.m_bIsPannablePcs=this.m_sr.getCoordinateSystemType()===2&&this.m_sr.isPannable();const _=st();this.m_inputGCS.querySpheroidData(_),this.m_a=_.majorSemiAxis,this.m_eSquared=_.e2,this.setPointDistFrom(t),this.setSegmentEndPoints(i,s)}setSegmentEndPoints(t,i){this.m_segStartPt.assign(t),this.m_segEndPt.assign(i),this.m_bIsPannablePcs||(this.m_segStartPt.mulThis(this.m_rpu),this.m_segEndPt.mulThis(this.m_rpu)),this.m_segCurveType===2&&(this.m_segStartPt3d.assign(x(this.m_a,this.m_eSquared,this.m_segStartPt)),this.m_segEndPt3d.assign(x(this.m_a,this.m_eSquared,this.m_segEndPt))),this.calculateAndUpdateSegmentLength()}setPointDistFrom(t){this.m_ptDistFrom.assign(t),this.m_ptDistFrom.scale(this.m_rpu)}setSegmentCurveType(t){this.m_segCurveType=t}setDistanceCurveType(t){this.m_distCurveType=t}makeFunctor(){return t=>{let i;switch(this.m_segCurveType){case 0:case 1:case 3:{const s={stack:[],error:void 0,hasError:!1};try{const n=F(s,new G,!1),a=F(s,new G,!1);J.geodeticCoordinate(this.m_a,this.m_eSquared,this.m_segStartPt.x,this.m_segStartPt.y,this.m_geodeticLength.val*t,this.m_az12.val,n,a,this.m_segCurveType),i=new y(n.val,a.val);break}catch(n){s.error=n,s.hasError=!0}finally{tt(s)}}case 2:{const s=A.lerp(this.m_segStartPt3d,this.m_segEndPt3d,t);i=k(this.m_a,this.m_eSquared,s);break}case 4:i=y.lerp(this.m_segStartPt,this.m_segEndPt,t),this.m_bIsPannablePcs&&(zt(this.m_sr,0,[i],1),i.mulThis(this.m_rpu));break;default:et("Invalid curve type")}return J.geodeticDistance(this.m_a,this.m_eSquared,this.m_ptDistFrom.x,this.m_ptDistFrom.y,i.x,i.y,this.m_minGeodeticDist,null,null,this.m_distCurveType),this.m_minGeodeticDist.val}}calculateAndUpdateSegmentLength(){switch(this.m_segCurveType){case 0:case 2:case 1:case 3:J.geodeticDistance(this.m_a,this.m_eSquared,this.m_segStartPt.x,this.m_segStartPt.y,this.m_segEndPt.x,this.m_segEndPt.y,this.m_geodeticLength,this.m_az12,null,this.m_segCurveType);break;case 4:this.m_geodeticLength.val=y.distance(this.m_segStartPt,this.m_segEndPt);break;default:et("Invalid curve type")}}[Symbol.dispose](){this.m_geodeticLength[Symbol.dispose](),this.m_az12[Symbol.dispose](),this.m_minGeodeticDist[Symbol.dispose]()}};class Yt{constructor(t,i,s,n,a=100){this.m_startPt=t.clone(),this.m_endPt=i.clone(),this.m_cE2=n,this.m_cE=Math.sqrt(this.m_cE2),this.m_c1By2e=1/(2*this.m_cE),this.m_cRpu=s.getGCS().getUnit().getUnitToBaseFactor(),this.isPcs=s.getCoordinateSystemType()===2,this.PEProjcs=s.getPECoordSys(),this.m_points=Tt(2*a,Number.NaN)}setSegmentEndPoints(t,i){this.m_startPt.assign(t),this.m_endPt.assign(i)}makeFunctor(){return t=>{const i=[0,0];i[0]=this.m_startPt.x*(1-t)+this.m_endPt.x*t,i[1]=this.m_startPt.y*(1-t)+this.m_endPt.y*t,this.isPcs&&qt.projToGeogCenter(this.PEProjcs,1,i,0);const s=Math.sin(i[1]*this.m_cRpu);return this.m_cE2===0?s:-Math.log((1-this.m_cE*s)/(1+this.m_cE*s))*this.m_c1By2e+s/(1-this.m_cE2*s*s)}}}function Xt(p,t,i){const s=new N;p.queryEnvelope(s);const n=Ot(t,s,!0).total(),a=t.getPannableExtent();a.xmin=s.xmin-10*n,a.xmax=s.xmax+10*n;const e=new bt().execute(p,a,t,i).getImpl().querySegmentIterator();e.stripAttributes();const _=st();t.querySpheroidData(_);const m=_.e2,o=m===0?2:1,l=new y(0,0),r=new y(0,0),h=new Y(0),u=new Yt(l,r,t,m,100);for(;e.nextPath();)for(;e.hasNextSegment();){const d=e.nextSegment();l.assign(d.getStartXY()),r.assign(d.getEndXY()),u.setSegmentEndPoints(l,r);const g=K(6,0,1,1e-12,1e-15,u.makeFunctor());h.pe((r.x-l.x)*g)}const c=_.majorSemiAxis;return o*c*c*(1-m)*Math.PI*h.getResult()/t.getPannableExtent().width()}function Bt(p,t,i,s,n){const a=jt(p,t,n);let e=At(p,a.first,i,s,n),_=1,m=0,o=0;do{if(_++,a.first*=.5,a.first<50*t.getTolerance(0))return e;a.second*=2,o=At(p,a.first,i,s,n),m=Math.abs(o-e),e=o}while(Math.abs(e)>1&&m>1e-8*Math.abs(e)&&(a.second<65e3&&_<8||_<4));return o}function At(p,t,i,s,n){const a=new ut().execute(p,t,0,0,n);let e;e=s?new it().execute(a,s,n):a;const _=i.getUnit().getUnitToBaseFactor()===1?Math.PI/180:1,m=new N;e.queryEnvelope(m);const o=new N,l=new N,r=new N;o.setCoords({xmin:m.xmin,ymin:75*_,xmax:m.xmax,ymax:90*_}),l.setCoords({xmin:m.xmin,ymin:-60*_,xmax:m.xmax,ymax:75*_}),r.setCoords({xmin:m.xmin,ymin:-90*_,xmax:m.xmax,ymax:-60*_}),o.inflateCoords(.01*o.width(),0),l.inflateCoords(.01*l.width(),0),r.inflateCoords(.01*r.width(),0);let h=0;return h+=ht(e,o,i,n),h+=ht(e,l,i,n),h+=ht(e,r,i,n),h}function ht(p,t,i,s){const n=new bt().execute(p,t,i,s);if(n!==null&&!n.isEmpty()){const a=new N;n.queryEnvelope(a);const{first:e,second:_}=Qt(i,a,!1),m=ct(i,e,null),o=new it().execute(n,m,s).calculateArea2D();return _&&e.destroy(),o}return 0}const W=[null,null,null,null,null,null,null];function Ht(p,t,i){const s=p.getUnit().getUnitToBaseFactor(),n=t.getCenter();n.scale(180*s/Math.PI);const a=new y;a.x=0,a.y=0;let e=0;if(e===0){n.y>45?(a.y=b,e=0):n.y<-45?(a.y=-b,e=1):n.x>=45&&n.x<135?(a.x=b,e=2):n.x>=135||n.x<-135?(a.x=b,e=3):n.x<-45&&n.x>=-135?(a.x=-b,e=4):(a.x=0,e=5);const S=s*Math.sqrt(Pt(t.xmin-t.xmax)+Pt(t.ymin-t.ymax)),E=a.clone(),P=t.getCenter();if(P.scale(s),e<2&&(E.x=P.x),y.distance(E,P)+.5*S>b)return null}const _=W[e];if(_!==null&&_.getGCS().equalHorizontal(p))return _;const m=p.getText(),o=a.x,l=a.y,r=0,h=0;let u=0,c=-1;e!==6?c=C.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA:(Mt(i),u=0,c=C.PE_PRJ_CYLINDRICAL_EQAREA);const d=gt("EqualAreaPCS");let g;c===C.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?g=`PROJCS["${d}",${m},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${r}],PARAMETER["False_Northing",${h}],PARAMETER["Central_Meridian",${o}],PARAMETER["Latitude_of_Origin",${l}],UNIT["Meter",1.0]]`:c===C.PE_PRJ_CYLINDRICAL_EQAREA?g=`PROJCS["${d}",${m},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",${r}],PARAMETER["False_Northing",${h}],PARAMETER["Central_Meridian",${o}],PARAMETER["Standard_Parallel_1",${u}],PARAMETER["Latitude_of_Origin",${l}],UNIT["Meter",1.0]]`:et("getEqualAreaPcsFixed");const f=Nt(g);return W[e]&&W[e].destroy(),W[e]=f,f}function Qt(p,t,i){const s=Ht(p,t,i);if(s!==null)return lt(s,!1);const n=p.getText(),a=p.getUnit().getUnitToBaseFactor(),e=(t.xmin+t.width()/2)*a,_=(t.ymin+t.height()/2)*a,m=0,o=0;let l=0,r=0,h=-1;t.ymin*a>=75*Math.PI/180||t.ymax*a<=-60*Math.PI/180?h=C.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA:t.ymin>0||t.ymax<0?(l=(t.ymin+1/3*t.height())*a,r=(t.ymin+2/3*t.height())*a,h=C.PE_PRJ_ALBERS):(l=(t.ymin+2/3*t.height())*a,h=C.PE_PRJ_CYLINDRICAL_EQAREA);const u=gt("EqualAreaPCS");let c;return h===C.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?c=`PROJCS["${u}",${n},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${m}],PARAMETER["False_Northing",${o}],PARAMETER["Central_Meridian",${e}],PARAMETER["Latitude_of_Origin",${_}],UNIT["Meter",1.0]]`:h===C.PE_PRJ_ALBERS?c=`PROJCS["${u}",${n},PROJECTION["Albers"],PARAMETER["False_Easting",${m}],PARAMETER["False_Northing",${o}],PARAMETER["Central_Meridian",${e}],PARAMETER["Standard_Parallel_1",${l}],PARAMETER["Standard_Parallel_2",${r}],PARAMETER["Latitude_of_Origin",${_}],UNIT["Meter",1.0]]`:h===C.PE_PRJ_CYLINDRICAL_EQAREA?c=`PROJCS["${u}",${n},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",${m}],PARAMETER["False_Northing",${o}],PARAMETER["Central_Meridian",${e}],PARAMETER["Standard_Parallel_1",${l}],PARAMETER["Latitude_of_Origin",${_}],UNIT["Meter",1.0]]`:et("getEqualAreaPCSInstance"),lt(Nt(c),!0)}function jt(p,t,i){const s=p.calculateLength2D(),n=new Ut().execute(p,t,i)/25e3,a=s/p.getSegmentCount()*2;let e=Math.min(a,s/n);return e===0&&(e=1),lt(e,s/e)}class Vt{getOperatorType(){return 10314}supportsCurves(){return!0}accelerateGeometry(t,i,s){return!1}canAccelerateGeometry(t){return!1}execute(t,i,s){if(i.getCoordinateSystemType()===0&&Rt(""),t.isEmpty()||t.getDimension()<2)return 0;if(xt(t),t.getGeometryType()===Ct.enumEnvelope){const o=new wt;return o.addEnvelope(t,!1),this.execute(o,i,s)}let n=t;t.getDescription().getAttributeCount()>1&&(n=t.clone(),n.dropAllAttributes());const a=new ut().execute(n,0,i.getTolerance(0),0,s);let e=null;const _=i.getGCS();_!==i&&(e=ct(i,_));let m=new pt().execute(a,i,!1,s);return m.isEmpty()?0:(m===t&&(m=t.clone()),i.isPannable()?Xt(m,i,s):Bt(m,i,_,e,s))}}function mt(){return{m_p_PCS:new y,m_factor:Number.NaN,setValues:Zt,assign:Wt}}function Zt(p,t){this.m_factor=p,this.m_p_PCS.assign(t)}function Wt(p){this.m_factor=p.m_factor,this.m_p_PCS.assign(p.m_p_PCS)}class Kt{constructor(t,i,s,n){this.m_ptStart=new A,this.m_ptEnd=new A,this.m_ptStart.assign(i),this.m_ptEnd.assign(s),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y,this.m_e=Math.sqrt(t),this.m_e2=t,this.m_c1MinusE2=1-t;const a=Math.sin(n);let e;e=this.m_e2===0?2*a:a*(U(this.m_e*a)+1/(1-this.m_e2*a*a)),this.m_baseA=e}setSegmentEndPoints(t,i){this.m_ptStart.assign(t),this.m_ptEnd.assign(i),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y}makeFunctor(){return t=>{const i=1-t,s=i*this.m_ptStart.x+t*this.m_ptEnd.x,n=i*this.m_ptStart.y+t*this.m_ptEnd.y,a=i*this.m_ptStart.z+t*this.m_ptEnd.z,e=s*s+n*n,_=a/Math.sqrt(a*a+this.m_c1MinusE2*this.m_c1MinusE2*e);let m;return this.m_e2===0?m=2*_:m=_*(U(this.m_e*_)+1/(1-this.m_e2*_*_)),(this.m_deltaY*s-this.m_deltaX*n)/e*(m-this.m_baseA)}}}function te(){return{e:Number.NaN,one_p_e:Number.NaN,one_m_e:Number.NaN,one_m_e_2:Number.NaN,atanh_e_over_e:Number.NaN,half_qp:Number.NaN,f:Number.NaN,z:Number.NaN}}function ot(){return{sin_phi:Number.NaN,one_p_sin_phi:Number.NaN,one_m_sin_phi:Number.NaN,one_m_e_2_sin_2_phi:Number.NaN,sin_half_phi_pf:Number.NaN,sin_half_phi_pz:Number.NaN,sin_half_asin_e_sin_phi_pf:Number.NaN,sin_half_asin_e_sin_phi_pz:Number.NaN,atanh_sin_phi:Number.NaN,atanh_esin_phi:Number.NaN,make_negative:!1,initialize:ee,changeSign:se,assign:ie,clone:ne}}function ee(p,t,i,s){const n=.5*p;this.sin_phi=Math.sin(p);const a=t*this.sin_phi,e=.5*Math.asin(a);this.one_p_sin_phi=1+this.sin_phi,this.one_m_sin_phi=1-this.sin_phi,this.one_m_e_2_sin_2_phi=(1+a)*(1-a),this.sin_half_phi_pf=Math.sin(n+i),this.sin_half_phi_pz=Math.sin(n+s),this.sin_half_asin_e_sin_phi_pf=Math.sin(e+i),this.sin_half_asin_e_sin_phi_pz=Math.sin(e+s),this.atanh_sin_phi=Math.log(this.sin_half_phi_pf/this.sin_half_phi_pz),this.atanh_esin_phi=Math.log(this.sin_half_asin_e_sin_phi_pf/this.sin_half_asin_e_sin_phi_pz)}function se(){this.sin_phi=-this.sin_phi;let p=this.one_p_sin_phi;this.one_p_sin_phi=this.one_m_sin_phi,this.one_m_sin_phi=p,p=this.sin_half_phi_pf,this.sin_half_phi_pf=this.sin_half_phi_pz,this.sin_half_phi_pz=p,p=this.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pf=this.sin_half_asin_e_sin_phi_pz,this.sin_half_asin_e_sin_phi_pz=p,this.atanh_sin_phi=-this.atanh_sin_phi,this.atanh_esin_phi=-this.atanh_esin_phi}function ie(p){this.sin_phi=p.sin_phi,this.one_p_sin_phi=p.one_p_sin_phi,this.one_m_sin_phi=p.one_m_sin_phi,this.one_m_e_2_sin_2_phi=p.one_m_e_2_sin_2_phi,this.sin_half_phi_pf=p.sin_half_phi_pf,this.sin_half_phi_pz=p.sin_half_phi_pz,this.sin_half_asin_e_sin_phi_pf=p.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pz=p.sin_half_asin_e_sin_phi_pz,this.atanh_sin_phi=p.atanh_sin_phi,this.atanh_esin_phi=p.atanh_esin_phi,this.make_negative=p.make_negative}function ne(){return{...this}}class ae{constructor(t,i,s){this.m_transformPCS2GCS=null,this.m_scaleToRadians=new _t,this.m_scaleToDegrees=new _t,this.m_progressTracker=s,Mt(i!==4),this.m_curveType=i,this.m_inputSR=t,t&&t.getCoordinateSystemType()!==0||Rt(""),this.m_inputGCS=t.getGCS(),this.m_a=0,this.m_eSquared=0,this.m_b=0,this.m_rpu=0}executePolygonGeodeticArea(t){let i,s=t.clone();if(s.dropAllAttributes(),t.hasNonLinearSegments()&&(s=new ut().execute(s,0,this.m_inputSR.getTolerance(0),0,this.m_progressTracker)),this.m_inputSR.isPannable()){const e=new N;s.queryEnvelope(e);const _=this.m_inputSR.getPannableExtent();if(!_.containsEnvelope(e)){const m=_.getCenterX()-e.getCenterX(),o=new _t;o.setShiftCoords(m,0),s.applyTransformation(o),e.move(m,0);const l=new ft;_.queryIntervalX(l);const r=new ft;e.queryIntervalX(r),s=l.contains(r)?Lt(s,this.m_inputSR):new it().foldInto360RangeGeodetic(s,this.m_inputSR,this.m_curveType)}}if(this.m_transformPCS2GCS?(s=new pt().execute(s,this.m_inputSR,!1,this.m_progressTracker),i=s.createInstance(),kt(this.m_transformPCS2GCS,s,i,this.m_progressTracker)||(i=new it().execute(s,this.m_transformPCS2GCS,this.m_progressTracker))):i=new pt().execute(s,this.m_inputGCS,!1,this.m_progressTracker),i.isEmpty())return 0;if(this.m_curveType===1){const e=st();return this.m_inputGCS.querySpheroidData(e),this.m_a=e.majorSemiAxis,this.m_eSquared=e.e2,this.loxodromeArea(i)}const n=i.getImpl();this.m_rpu=this.m_inputGCS.getUnit().getUnitToBaseFactor(),this.m_scaleToRadians.setScale(this.m_rpu),n.applyTransformation(this.m_scaleToRadians),this.m_scaleToDegrees=this.m_scaleToRadians,this.m_scaleToDegrees.invertThis();const a=st();if(this.m_inputGCS.querySpheroidData(a),this.m_a=a.majorSemiAxis,this.m_b=a.minorSemiAxis,this.m_eSquared=a.e2,this.m_curveType===2)return this.executeClippedPolygonGreatEllipticArea(i);{const e={stack:[],error:void 0,hasError:!1};try{const _=rt.unit(9101),m=this.m_inputGCS.getPECoordSys(),o=F(e,m.cloneAlterUnits(_),!1);let l,r,h=this.executeClippedPolygonGeodeticArea(i,o,0),u=0;do u++,l=this.executeClippedPolygonGeodeticArea(i,o,u),r=Math.abs(l-h),h=l;while(Math.abs(l)>1&&r>1e-8*Math.abs(l)&&u<7);return l}catch(_){e.error=_,e.hasError=!0}finally{tt(e)}}}executeClippedPolygonGeodeticArea(t,i,s){const n={stack:[],error:void 0,hasError:!1};try{const a=new N;t.queryEnvelope(a);const e=F(n,this.getEqualAreaPCSInstance(i,a),!1),_=t.clone();Ft(e,_);const m=50,o=_.getImpl().getAttributeStreamRef(0),l=t.getImpl().getAttributeStreamRef(0),r=F(n,new G,!1),h=F(n,new G,!1),u=40,c=[0,0],d=Dt(mt,u),g=Tt(u,-1),f=mt(),S=mt();let E,P;const v=e;let T=_.calculateArea2D();const w=new Y(0),z=.5*Math.PI,X=1e-10*Math.abs(T)+1e-6,nt=t.getPathCount();let L,O,I,q;const M=new y,$=new y,B=new y,H=new y,Q=new y,j=new y;let dt,at;for(O=t.getPathStart(0),L=0;L<nt;L++,O=I)for(I=t.getPathEnd(L),o.queryPoint2D(I-1<<1,B),l.queryPoint2D(I-1<<1,M),Math.abs(M.y)>z&&(M.y=Z(z,M.y)),q=O;q<I;q++,B.assign(H),M.assign($)){if(o.queryPoint2D(q<<1,H),l.queryPoint2D(q<<1,$),Math.abs($.y)>z&&($.y=Z(z,$.y)),dt=y.distance(B,H),dt<m||M.y===0&&$.y===0)continue;J.geodeticDistance(this.m_a,this.m_eSquared,M.x,M.y,$.x,$.y,r,h,null,this.m_curveType);const vt=r.val,It=h.val;for(f.setValues(0,B),S.setValues(1,H),P=s,d[0].assign(S),g[0]=s,E=0;E>=0;){at=.5*(f.m_factor+S.m_factor),J.geodeticCoordinate(this.m_a,this.m_eSquared,M.x,M.y,vt*at,It,r,h,this.m_curveType),Q.x=r.val,Q.y=h.val,c[0]=Q.x,c[1]=Q.y,qt.geogToProj(v,1,c),j.x=c[0],j.y=c[1];const $t=-j.offset(f.m_p_PCS,S.m_p_PCS),V=.5*$t*y.distance(f.m_p_PCS,S.m_p_PCS);if(w.pe(V),Math.abs(V)>X||Math.abs(V)>0&&P>0)S.setValues(at,j),E++,d[E].assign(S),Math.abs(V)<=X?(P--,g[E-1]=P,g[E]=P):(P=g[E-1],g[E]=P);else{if(E<=0)break;f.assign(S),E--,S.assign(d[E]),P=g[E]}}}return T+=w.getResult(),Math.abs(T)}catch(a){n.error=a,n.hasError=!0}finally{tt(n)}}executeClippedPolygonGreatEllipticArea(t){const i=[],s=[],n=new y,a=new y,e=x(1,this.m_eSquared,new y(0,.5*Math.PI)),_=new Y(0),m=new Y(0),o=new Y(0),l=new A,r=new A,h=new N;t.queryLooseEnvelope(h);let u=0;h.containsCoords(h.xmin,0)||(u=Math.abs(h.ymin)<Math.abs(h.ymax)?h.ymin:h.ymax);const c=new Kt(this.m_eSquared,l,r,u),d=this.m_a*this.m_a,g=t.getImpl().querySegmentIterator();for(g.stripAttributes();g.nextPath();)for(;g.hasNextSegment();){const f=g.nextSegment();n.assign(f.getStartXY()),a.assign(f.getEndXY()),a.x-n.x>Math.PI?n.x+=2*Math.PI:a.x-n.x<-Math.PI&&(a.x+=2*Math.PI),this.splitSegmentCrossingItegralThreshold(f,i,s);for(let S of i)l.assign(x(this.m_a,this.m_eSquared,S.getStartXY())),r.assign(x(this.m_a,this.m_eSquared,S.getEndXY())),c.setSegmentEndPoints(l,r),this.adaptiveIntegrationWithRomberg(c,_);for(let S of s){let E=S.getStartXY(),P=S.getEndXY(),v=u;E.y<0&&(P=Gt(E,E=P),E.y=-E.y,P.y=-P.y,v=-v);const T=x(1,this.m_eSquared,E),w=x(1,this.m_eSquared,P),z=Math.min(E.y,P.y),X=St(this.m_eSquared,E.x,P.x,v,z);m.pe(X);const nt=Math.abs(St(this.m_eSquared,E.x,P.x,z,b)),L=new A;L.setSub(T,e);const O=new A;O.setSub(w,e);const I=new A;I.setCrossProductVector(L,O);let q=d*(nt-.5*I.length());q=Z(q,P.x-E.x),o.pe(q)}i.length=0,s.length=0}return o.getResult()+d*(.5*(1-this.m_eSquared)*_.getResult()+m.getResult())}getEqualAreaPCSInstance(t,i){const s=i.getCenterX(),n=0,a=0;let e,_;const m=i.height();let o,l;(o=i.ymin>45*Math.PI/180||i.ymax<45*-Math.PI/180)?e=Z(.5*Math.PI,i.getCenterY()):(e=i.getCenterY(),_=i.ymin+m*(2/3));const r=gt("EqualAreaPCS"),h=t.toString();return l=o?rt.fromString(C.PE_TYPE_PROJCS,`PROJCS["${r}", ${h}, PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${n}],PARAMETER["False_Northing", ${a}],PARAMETER["Central_Meridian", ${s}], PARAMETER["Latitude_of_Origin", ${e}], UNIT["Meter",1.0]]`):rt.fromString(C.PE_TYPE_PROJCS,`PROJCS["${r}", ${h}, PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting", ${n}],PARAMETER["False_Northing", ${a}],PARAMETER["Central_Meridian", ${s}],PARAMETER["Standard_Parallel_1", ${_}],PARAMETER["Latitude_of_Origin", ${e}],UNIT["Meter",1.0]]`),l}splitSegmentCrossingItegralThreshold(t,i,s){const _=x(this.m_a,this.m_eSquared,new y(0,b)),m=x(this.m_a,this.m_eSquared,new y(0,-b)),o=this.splitSegmentPassingThroughPole(t);for(let l of o){const r=l.getStartXY(),h=l.getEndXY(),u=x(this.m_a,this.m_eSquared,r),c=x(this.m_a,this.m_eSquared,h),d=new y,g=new A;let f=A.sqrDistance(_,u),S=A.sqrDistance(u,c);if(f<=100){if(!(S>400)){s.push(new R({start:r,end:h}));continue}g.assign(c.sub(u)),g.normalizeThis(),g.assign(u.add(g.mul(20))),d.assign(k(this.m_a,this.m_eSquared,g)),s.push(new R({start:r,end:d})),r.assign(d)}if(u.assign(x(this.m_a,this.m_eSquared,r)),f=A.sqrDistance(_,c),S=A.sqrDistance(u,c),f<=100){if(!(S>400)){s.push(new R({start:r,end:h}));continue}g.assign(c.sub(u)),g.normalizeThis(),g.assign(c.sub(g.mul(20))),d.assign(k(this.m_a,this.m_eSquared,g)),s.push(new R({start:d,end:h})),h.assign(d)}if(u.assign(x(this.m_a,this.m_eSquared,r)),c.assign(x(this.m_a,this.m_eSquared,h)),f=A.sqrDistance(m,u),S=A.sqrDistance(u,c),f<=100){if(!(S>400)){s.push(new R({start:r,end:h}));continue}g.assign(c.sub(u)),g.normalizeThis(),g.assign(u.add(g.mul(20))),d.assign(k(this.m_a,this.m_eSquared,g)),s.push(new R({start:r,end:d})),r.assign(d)}if(u.assign(x(this.m_a,this.m_eSquared,r)),c.assign(x(this.m_a,this.m_eSquared,h)),f=A.sqrDistance(m,c),S=A.sqrDistance(u,c),f<=100){if(!(S>400)){s.push(new R({start:r,end:h}));continue}g.assign(c.sub(u)),g.normalizeThis(),g.assign(c.sub(g.mul(20))),d.assign(k(this.m_a,this.m_eSquared,g)),s.push(new R({start:d,end:h})),h.assign(d)}i.push(new R({start:r,end:h}))}}splitSegmentPassingThroughPole(t){const i={stack:[],error:void 0,hasError:!1};try{const s=[],n=new A,a=new A,e=new A,_=new y,m=20,o=3.124139361,l=10,r=t.getStartXY(),h=t.getEndXY(),u=F(i,new G,!1);if(J.geodeticDistance(this.m_a,this.m_eSquared,r.x,r.y,h.x,h.y,u,null,null,2),Math.abs(h.x-r.x)>o&&u.val>m){const c=new Jt(new y(0,90),r.divide(this.m_rpu),h.divide(this.m_rpu),this.m_inputGCS,2,2);let d=yt(c.makeFunctor(),0,1,1e-10);if(d.second<=l&&d.first>0&&d.first<1)return n.assign(x(this.m_a,this.m_eSquared,r)),a.assign(x(this.m_a,this.m_eSquared,h)),Et(n,a,d.first,e),_.assign(k(this.m_a,this.m_eSquared,e)),s.push(new R({start:r,end:_})),s.push(new R({start:_,end:h})),s;if(c.setPointDistFrom(new y(0,-90)),d=yt(c.makeFunctor(),0,1,1e-10),d.second<=l&&d.first>0&&d.first<1)return n.assign(x(this.m_a,this.m_eSquared,r)),a.assign(x(this.m_a,this.m_eSquared,h)),Et(n,a,d.first,e),_.assign(k(this.m_a,this.m_eSquared,e)),s.push(new R({start:r,end:_})),s.push(new R({start:_,end:h})),s}return s.push(new R({start:r,end:h})),s}catch(s){i.error=s,i.hasError=!0}finally{tt(i)}}adaptiveIntegrationWithRomberg(t,i){const s=t.makeFunctor();let n=0,a=1,e=s(n),_=s(a);const m=1e-17,o=1e-14;let l=(n+a)/2,r=s(l),h=Math.abs(r-e),u=Math.abs(_-r),c=0;for(;c++<32&&(h/u<.1||u/h<.1);)h<u?(i.pe(K(5,n,l,o,m,s)),n=l,e=r):(i.pe(K(5,l,a,o,m,s)),a=l,_=r),l=(n+a)/2,r=Math.abs(s(l)),h=Math.abs(r-e),u=Math.abs(_-r);i.pe(K(5,n,a,o,m,s))}loxodromeAreaHemi(t,i,s,n,a){const e=s.clone(),_=a.clone();let m,o,l,r,h,u,c,d,g,f,S,E,P,v,T,w;return e.make_negative&&e.changeSign(),_.make_negative&&_.changeSign(),S=n-i,Math.abs(e.sin_phi)===1||Math.abs(_.sin_phi)===1?t.half_qp*S:e.sin_phi===_.sin_phi?(f=.5*t.one_m_e_2*e.sin_phi*(1/e.one_m_e_2_sin_2_phi+U(t.e*e.sin_phi))*S,f):(T=Math.log(_.sin_half_phi_pf*e.sin_half_phi_pz/(_.sin_half_phi_pz*e.sin_half_phi_pf)),w=Math.log(_.sin_half_asin_e_sin_phi_pf*e.sin_half_asin_e_sin_phi_pz/(_.sin_half_asin_e_sin_phi_pz*e.sin_half_asin_e_sin_phi_pf)),this.m_eSquared===1?(h=0,m=.5*(T+_.sin_phi/_.one_m_e_2_sin_2_phi-e.sin_phi/e.one_m_e_2_sin_2_phi),o=0):(h=-2*t.atanh_e_over_e*(Math.log(_.one_p_sin_phi/e.one_p_sin_phi)-t.e*w),m=(T-t.e*w)/t.one_m_e_2,o=(Math.log(_.one_m_e_2_sin_2_phi/e.one_m_e_2_sin_2_phi)+h/t.atanh_e_over_e)/t.one_m_e_2),l=-w*(e.atanh_esin_phi+_.atanh_esin_phi),r=1/e.one_m_e_2_sin_2_phi-1/_.one_m_e_2_sin_2_phi,u=D(_.one_m_sin_phi/t.one_p_e,t.e)-D(e.one_m_sin_phi/t.one_p_e,t.e),c=D(_.one_p_sin_phi/t.one_p_e,t.e)-D(e.one_p_sin_phi/t.one_p_e,t.e),d=D(e.one_m_sin_phi/-t.one_m_e,t.e)-D(_.one_m_sin_phi/-t.one_m_e,t.e),g=D(e.one_p_sin_phi/-t.one_m_e,t.e)-D(_.one_p_sin_phi/-t.one_m_e,t.e),f=.25/m*(o+l+r+h+.5*(u+c+d+g)),f+=t.half_qp,E=.5*t.one_m_e_2*e.sin_phi*(1/e.one_m_e_2_sin_2_phi+U(t.e*e.sin_phi)),P=.5*t.one_m_e_2*_.sin_phi*(1/_.one_m_e_2_sin_2_phi+U(t.e*_.sin_phi)),P<E&&(v=E,E=P,P=v),f<E&&(f=E),f>P&&(f=P),f*=S,f)}loxodromeArea(t){const i=Math.PI/180;let s=0;const n=te(),a=ot(),e=ot();n.e=Math.sqrt(this.m_eSquared),n.one_p_e=1+n.e,n.one_m_e=1-n.e,n.one_m_e_2=1-this.m_eSquared,n.atanh_e_over_e=U(n.e),this.m_eSquared>=1?n.half_qp=1:n.half_qp=.5*(1+n.atanh_e_over_e*n.one_m_e_2),n.f=.25*Math.PI,n.z=.75*Math.PI,e.initialize(0,n.e,n.f,n.z);const _=t.getPathCount(),m=new y,o=new y,l=t.getImpl().getAttributeStreamRef(0);for(let r=0;r<_;r++){const h=t.getPathStart(r),u=t.getPathEnd(r);if(!(u-h<=1)){l.queryPoint2D(2*(u-1),m);for(let c=h;c<u;c++){l.queryPoint2D(2*c,o);const d=m.y*i,g=o.y*i;if(c===h?(a.initialize(d,n.e,n.f,n.z),a.make_negative=!1):a.assign(e),e.initialize(g,n.e,n.f,n.z),e.make_negative=!1,m.y*o.y<0){if(m.y>=90&&o.y<=-90||o.y>=90&&m.y<=-90)return Number.NaN;const f=ot();f.initialize(0,n.e,n.f,n.z),f.make_negative=!1;const S=a.atanh_sin_phi-n.e*a.atanh_esin_phi,E=e.atanh_sin_phi-n.e*e.atanh_esin_phi,P=(E*m.x-S*o.x)/(E-S);d<0?(a.make_negative=!0,s-=this.loxodromeAreaHemi(n,m.x*i,a,P*i,f),a.make_negative=!1,s+=this.loxodromeAreaHemi(n,P*i,f,o.x*i,e)):(s+=this.loxodromeAreaHemi(n,m.x*i,a,P*i,f),e.make_negative=!0,s-=this.loxodromeAreaHemi(n,P*i,f,o.x*i,e),e.make_negative=!1)}else m.y>=0?s+=this.loxodromeAreaHemi(n,m.x*i,a,o.x*i,e):(a.make_negative=!0,e.make_negative=!0,s-=this.loxodromeAreaHemi(n,m.x*i,a,o.x*i,e),a.make_negative=!1,e.make_negative=!1);m.assign(o)}}}return this.m_a*s*this.m_a}calculate(t){if(t.isEmpty()||t.getDimension()<2)return 0;if(t.getGeometryType()===Ct.enumEnvelope){const i=new wt;return i.addEnvelope(t,!1),this.calculate(i)}return this.m_inputSR!==this.m_inputGCS&&this.m_transformPCS2GCS===null&&(this.m_transformPCS2GCS=ct(this.m_inputSR,this.m_inputGCS,null)),this.executePolygonGeodeticArea(t)}}class Ze{getOperatorType(){return 10311}supportsCurves(){return!0}accelerateGeometry(t,i,s){return!1}canAccelerateGeometry(t){return!1}execute(t,i,s,n){return xt(t),s===4?new Vt().execute(t,i,n):new ae(i,s,n).calculate(t)}}export{Ze as OperatorGeodeticArea};
