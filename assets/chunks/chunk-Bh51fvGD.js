import{kA as p,kB as A,kC as n,kD as l,bh as x,kE as C,iz as h,b$ as I,kF as m,eK as E}from"./chunk-BrJ3DEnk.js";function M(t,u,e,s){if(u==null||s==null)return!1;const r=p(u,s);if(r?.projector==null)return!1;if(r.projector===A)return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],!0;const{source:i,dest:o,projector:R}=r;if(o.spatialReferenceId===n.WEB_MERCATOR){const a=l[i.spatialReferenceId][n.WGS84];return a!=null&&(a(t,0,f,0),C(f,0,e,0),e[3]=_(f[1],t[2],t[3],h.radius),!0)}if(i.spatialReferenceId!==n.WGS84&&i.spatialReferenceId!==n.CGCS2000||o.spatialReferenceId!==n.PLATE_CARREE){R(t,0,e,0);const a=i.metersPerUnit??1,c=o.metersPerUnit??1;e[3]=t[3]*a/c}else{const a=l[i.spatialReferenceId][n.SPHERICAL_ECEF],c=l[n.SPHERICAL_ECEF][n.PLATE_CARREE];let d=t[3];a!=null&&c!=null&&(d=_(t[1],t[2],t[3],h.radius)),R(t,0,e,0),e[3]=d}return!0}function _(t,u,e,s){const r=s+u;if(r<s/2||e>r)return Number.MAX_VALUE;const i=Math.abs(P*t)+Math.asin(e/r);return i>=Math.PI/2?Number.MAX_VALUE:e/Math.cos(i)}const f=x(),P=I(1);class k{constructor(u,e){this._textures=u,this.loadPromise=null,this._disposed=!1;const s=this._textures.acquire(e);m(s)?(s.then(r=>{this._disposed?E(r):this._textureRef=r}),this.loadPromise=s):this._textureRef=s}dispose(){this._textureRef=E(this._textureRef),this._disposed=!0}get glTexture(){return this._textureRef!=null?this._textureRef.glTexture:null}}export{M as l,k as s};
