import{f9 as X,hu as D,hv as L,hw as Y}from"./chunk-DbiObNSB.js";import{t as j}from"./chunk-CijFp2df.js";const q=.45;function G(n,t=.5){switch(n.type){case"CIMPointSymbol":{const e=n.symbolLayers;if(!e||e.length!==1)return null;const o=e[0];return o.type!=="CIMVectorMarker"?null:G(o)}case"CIMVectorMarker":{const e=n.markerGraphics;if(!e||e.length!==1)return null;const o=e[0];if(!o)return null;const a=o.geometry;if(!a)return null;const r=o.symbol;return!r||r.type!=="CIMPolygonSymbol"&&r.type!=="CIMLineSymbol"||r.symbolLayers?.some(i=>!!i.effects)?null:{type:"sdf",geom:a,sdfPaddingRatio:t,asFill:r.type==="CIMPolygonSymbol"}}}}function U(n){return n?n.rings?n.rings:n.paths?n.paths:n.xmin!==void 0&&n.ymin!==void 0&&n.xmax!==void 0&&n.ymax!==void 0?[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]:null:null}function B(n){let t=1/0,e=-1/0,o=1/0,a=-1/0;for(const r of n)for(const i of r)i[0]<t&&(t=i[0]),i[0]>e&&(e=i[0]),i[1]<o&&(o=i[1]),i[1]>a&&(a=i[1]);return new j(t,o,e-t,a-o)}function V(n){let t=1/0,e=-1/0,o=1/0,a=-1/0;for(const r of n)for(const i of r)i[0]<t&&(t=i[0]),i[0]>e&&(e=i[0]),i[1]<o&&(o=i[1]),i[1]>a&&(a=i[1]);return[t,o,e,a]}function E(n){return n?n.rings?V(n.rings):n.paths?V(n.paths):X(n)?[n.xmin,n.ymin,n.xmax,n.ymax]:null:null}function Q(n,t){const[e,o,a,r]=E(n),i=a-e,l=r-o,h=D,m=L,f=Math.floor(.5*(h*t-m)),s=(h-2*(f+m))/Math.max(i,l),d=Math.round(i*s),c=Math.round(l*s);return{pixelDimensions:[i,l],texelDimensions:[Math.round((d+2*f)/s),Math.round((c+2*f)/s)]}}function T(n,t,e,o,a,r,i){const[l,h,m,f]=n;if(m<l||f<h)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const s=m-l,d=f-h,c=Math.max(s,d);let u=.5;if(r!=null&&e!=null){!i&&t!=null&&(r*=(t.ymax-t.ymin)/e);const C=r/(r+c);C>q&&C<1&&(u=Math.min(C+.1,.99))}const x=D,M=L,p=Math.floor(.5*(x*u-M)),g=(x-2*(p+M))/c,I=Math.round(s*g)+2*p,R=Math.round(d*g)+2*p;let y=1;t&&(y=R*(1-u)/((t.ymax-t.ymin)*g));let P=0,w=0,b=1;o&&(a?t&&e&&t.ymax-t.ymin>0&&(b=(t.xmax-t.xmin)/(t.ymax-t.ymin),P=o.x/(e*b),w=o.y/e):(P=o.x,w=o.y)),t&&(P=.5*(t.xmax+t.xmin)+P*(t.xmax-t.xmin),w=.5*(t.ymax+t.ymin)+w*(t.ymax-t.ymin)),P-=l,w-=h,P*=g,w*=g,P+=p,w+=p;let S=P/I-.5,v=w/R-.5;return a&&e&&(S*=e*b,v*=e),{frameSizeRatio:y,anchorX:S,anchorY:v,widthRatio:b,sdfPaddingRatio:u}}function W(n){const t=U(n.geom),e=B(t),o=D,a=L,r=Math.floor(.5*(o*n.sdfPaddingRatio-a)),i=o-2*(r+a),l=i/Math.max(e.width,e.height),h=Math.round(e.width*l)+2*r,m=Math.round(e.height*l)+2*r,f=[];for(const d of t)if(d&&d.length>1){const c=[];for(const u of d){let[x,M]=u;x-=e.x,M-=e.y,x*=l,M*=l,x+=r-.5,M+=r-.5,n.asFill?c.push([x,M]):c.push([Math.round(x),Math.round(M)])}if(n.asFill){const u=c.length-1;c[0][0]===c[u][0]&&c[0][1]===c[u][1]||c.push(c[0])}f.push(c)}const s=H(f,h,m,r);return n.asFill&&J(f,h,m,r,s),{data:K(s,r),width:h,height:m,sdfPaddingRatio:n.sdfPaddingRatio,sdfDecodeCoeff:2*r/i}}function H(n,t,e,o){const a=t*e,r=new Array(a),i=o*o+1;for(let l=0;l<a;++l)r[l]=i;for(const l of n){const h=l.length;for(let m=1;m<h;++m){const f=l[m-1],s=l[m];let d,c,u,x;f[0]<s[0]?(d=f[0],c=s[0]):(d=s[0],c=f[0]),f[1]<s[1]?(u=f[1],x=s[1]):(u=s[1],x=f[1]);let M=Math.floor(d)-o,p=Math.floor(c)+o,g=Math.floor(u)-o,I=Math.floor(x)+o;M<0&&(M=0),p>t&&(p=t),g<0&&(g=0),I>e&&(I=e);const R=s[0]-f[0],y=s[1]-f[1],P=R*R+y*y;for(let w=M;w<p;w++)for(let b=g;b<I;b++){const S=w+.5,v=b+.5;let C,F,k=(S-f[0])*R+(v-f[1])*y;k<0?(C=f[0],F=f[1]):k>P?(C=s[0],F=s[1]):(k/=P,C=f[0]+k*R,F=f[1]+k*y);const z=(S-C)*(S-C)+(v-F)*(v-F),A=(e-b-1)*t+w;z<r[A]&&(r[A]=z)}}}for(let l=0;l<a;++l)r[l]=Math.sqrt(r[l]);return r}function J(n,t,e,o,a){for(const r of n){const i=r.length;for(let l=1;l<i;++l){const h=r[l-1],m=r[l];let f,s,d,c;h[0]<m[0]?(f=h[0],s=m[0]):(f=m[0],s=h[0]),h[1]<m[1]?(d=h[1],c=m[1]):(d=m[1],c=h[1]);let u=Math.floor(f),x=Math.floor(s)+1,M=Math.floor(d),p=Math.floor(c)+1;u<o&&(u=o),x>t-o&&(x=t-o),M<o&&(M=o),p>e-o&&(p=e-o);for(let g=M;g<p;++g){if(h[1]>g==m[1]>g)continue;const I=g+.5,R=(e-g-1)*t;for(let y=u;y<x;++y)y+.5<(m[0]-h[0])*(I-h[1])/(m[1]-h[1])+h[0]&&(a[R+y]=-a[R+y]);for(let y=o;y<u;++y)a[R+y]=-a[R+y]}}}}function K(n,t){const e=2*t,o=n.length,a=new Uint8Array(4*o);for(let r=0;r<o;++r){const i=.5-n[r]/e;Y(i,a,4*r)}return a}export{G as a,Q as c,T as h,E as m,W as u};
