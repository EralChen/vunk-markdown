import{_ as n}from"./chunk-DsYbGKja.js";import{ak as s,am as F,gP as O,gQ as x,s as j,gh as L,gR as $,gS as k,C as A,gk as C,gT as l,gi as z}from"./chunk-DbiObNSB.js";import{i as D}from"./chunk-rxAQtq3N.js";const B=E=>{const w=E;let r=class extends w{constructor(...t){super(...t),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return D(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){const{renderer:t}=this.layer;return!!(t?.type==="raster-stretch"&&t.dynamicRangeAdjustment&&!(t.stretchType==="min-max"||t.stretchType==="standard-deviation"))}get datumTransformation(){try{return this.layer.loaded?O(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(t){try{return!this.layer.loaded||!!x(this.layer.serviceRasterInfo,t)}catch{return!1}}async fetchPopupFeaturesAtLocation(t,h){const{layer:e}=this;if(!t)throw new j("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:T}=e,R=L(e,h);if(!T||R==null)return[];const p=[],{value:o,magdirValue:f,processedValue:I}=await e.identify(t,{timeExtent:this.timeExtent,signal:h?.signal});let c="";if(o?.length){c=e.type==="imagery-tile"&&e.hasStandardTime()&&o[0]!=null?o.map(y=>e.getStandardTimeValue(y)).join(", "):o.join(", ");const a={ObjectId:0};a[l.servicePixelValue]=e.type==="imagery-tile"&&$(e.raster)?I?.join(", "):c,a[l.rawServicePixelValue]=c;const d=e.raster?.rasterInfo??e.serviceRasterInfo,m=d?.attributeTable;if(m!=null){const{fields:y,features:P}=m,v=y.find(({name:i})=>i.toLowerCase()==="value"),_=a[l.servicePixelValue],u=v?P.find(i=>String(i.attributes[v.name])===_):null;if(u)for(const i in u.attributes)u.attributes.hasOwnProperty(i)&&(a[z+i]=u.attributes[i])}const g=d?.dataType;g!=="vector-magdir"&&g!=="vector-uv"||(a[l.magnitude]=f?.[0],a[l.direction]=f?.[1]);const{multidimensionalDefinition:b}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});k(e.rasterFields,a,b);const{graphicOrigin:V}=e,S=new A({geometry:this.fullExtent?.clone(),attributes:a,layer:e,origin:V,sourceLayer:e});p.push(S)}return p}async getSourceScale(){return await this.layer.load(),C(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return x(this.layer.serviceRasterInfo,this.view.spatialReference)}};return n([s()],r.prototype,"fullExtent",null),n([s()],r.prototype,"layer",void 0),n([s({readOnly:!0})],r.prototype,"timeExtent",null),n([s()],r.prototype,"tileInfo",void 0),n([s({readOnly:!0})],r.prototype,"hasTilingEffects",null),n([s()],r.prototype,"datumTransformation",null),r=n([F("esri.views.layers.ImageryTileLayerView")],r),r};export{B as f};
