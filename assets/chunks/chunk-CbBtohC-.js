const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/chunk-GEzYIl-R.js","assets/chunks/chunk-CuaFhuP3.js","assets/chunks/chunk-Dpk1TJd9.js","assets/chunks/chunk-iOPJXyP1.js","assets/static/onCreateApp.DRclb75I.css","assets/static/src_layouts_default_aside-6ea01de8.BjbON5Ij.css","assets/static/src_layouts_default_navbar-403af73f.u3IytZI2.css","assets/static/vitepress_components_VPDocOutlineItem-0942cada.tkRPm3MX.css","assets/static/vitepress_components_VPDocAsideOutline-b0d47973.Ds9uynvM.css","assets/static/src_styles_common_reset-f7a68b0e.BAKp5MHC.css","assets/static/src_styles_common_color-a7a524c7.CVau4Kly.css","assets/static/src_styles_common_is-19c6c24d.DKAKruk7.css","assets/static/style-bd199161.DVw0mqUT.css","assets/static/style-ee024ed9.COZrvgTQ.css","assets/static/src_styles_element-plus_reset-752cc03d.htEpr2M-.css","assets/static/src_styles_element-plus_form-item-877afd6a.Dy4HJB2K.css","assets/static/src_styles_element-plus_table-6cbc5816.DXG1SsxY.css","assets/static/src_styles_element-plus_tabs-67d1a98b.BMDMQPDv.css","assets/static/src_styles_element-plus_tree-cc28503d.nmT5n0wM.css","assets/static/src_styles_element-plus_dialog-7f91a00e.D4nTsJge.css","assets/static/src_styles_element-plus_breadcrumb-8ce3a1a1.CwEEGJYc.css","assets/static/src_styles_element-plus_menu-33b44202.hFAFO4eV.css","assets/static/style-769e248f.DDhCRjCR.css","assets/static/style-22d30bfc.TwvRHEyK.css","assets/static/style-d089cd8f.Cc2PI5FU.css","assets/static/style-e86a26b0.CqxSaK_p.css","assets/static/style-51eec318.o0zCZ1y4.css","assets/static/src_styles_form_sub-7371c85e.y3zh-mS3.css","assets/static/src_styles_layout_index-2891f17b.BNCqvENj.css","assets/static/style-ab3e4bd5.BuWAVw4m.css","assets/static/style-2bf8ed1f.CRScSR0a.css","assets/static/style-603b4474.BZwgKm1s.css","assets/static/style-c5252da0.CFNWXuiE.css","assets/static/style-6fd0e256.X9gIGpBH.css","assets/static/style-3c45b3af.Di2LGzYR.css","assets/static/style-27a3a9b4.C8H6Fcyw.css","assets/static/src_styles_markdown_reset-fbd16bdd.D3vNaEcf.css","assets/static/src_styles_markdown_shiki-0d2326df.uut6VZYd.css","assets/static/style-b2fddf65.BmytK7dW.css","assets/static/style-2208d37a.ChwmoEkt.css","assets/static/pages_uno-88a4f3d7.lpyrja-g.css","assets/chunks/chunk-DGmg3LSc.js","assets/chunks/chunk-D3U5BL7Y.js"])))=>i.map(i=>d[i]);
import{t4 as S,t5 as q,t6 as P,oU as N,gj as V,af as g,ag as m,ai as $,aG as G,an as z,bX as K,v as O,ao as U,oY as B,o_ as Q,d8 as H,eU as W,eh as X,da as j,dL as T,sW as R,eS as Y,eT as J,bR as Z}from"./chunk-CuaFhuP3.js";import{W as ee,S as te}from"./chunk-Dpk1TJd9.js";import{_ as re}from"./chunk-iOPJXyP1.js";import{a as ne,n as ie,b as oe}from"./chunk-BPKLJ0Es.js";const se={setAttribute(){},rollback(){},commit(){}};var w;function be(e,t){const r=t.attributes[e.objectIdField];if(r==null)return se;const n=e.sessions.get(r);if(n)return n;const i=ee(t.attributes),o=new Set,a=e.i3sOverrides.createInteractiveEditSession(r),s=new Map,f=(c,u)=>{const p=s.get(c);if(p==null){const y=u.indexOf(r);return s.set(c,y),y}return p};let l=w.EDITING;const d={setAttribute(c,u){if(l!==w.EDITING)return;const p=e.fieldsIndex.get(c);if(!p)return;const y=e.attributeStorageInfo.findIndex((b=>b.name===p.name));if(y<0)return;if(!(c in i))throw new Error(`Attribute "${c}" is not an attribute of the edited feature.`);a.setAttribute(y,u);const F=e.attributeStorageInfo[y];let E=!1;o.add(c),e.forEachNode(((b,x)=>{const A=f(b,x);if(A===-1)return;const _=e.getAttributeData(b.index);if(_){const v=_[F.name];v&&(v[A]=u,e.setAttributeData(b.index,_,t),E=!0)}})),E&&e.clearMemCache()},rollback(){if(l===w.EDITING){for(const c of o)this.setAttribute(c,i[c]);a.remove(),l=w.ROLLED_BACK,e.sessions.delete(r)}},commit(){l===w.EDITING&&(a.remove(),l=w.COMMITTED,e.sessions.delete(r))}};return e.sessions.set(r,d),d}function le(e,t,r){const{gidToFeatureInfo:n,oidToFeatureInfo:i,fieldsIndex:o,objectIdField:a,globalIdField:s,featureOrIdentifierList:f}=r;if(!r.featuresResolved&&f!=null){for(const l of f){const d={feature:null,oid:-1,gid:null};if("attributes"in l){d.feature=l;const c=l.attributes;if(c!=null)for(const u in c){if(d.oid!==-1&&d.gid!=null)break;const p=o.normalizeFieldName(u);p===a&&(d.oid=c[u]??-1),p===s&&(d.gid=c[u])}}else d.oid=l.objectId??-1,d.gid=l.globalId;d.gid!=null&&n.set(d.gid,d),d.oid!==-1&&i.set(d.oid,d)}r.featuresResolved=!0}return(e!==-1?i.get(e):null)??(t!=null?n.get(t):null)}function L(e,t,r,n,i=null,o=!0){const a=[],s={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:r==null,fieldsIndex:e.fieldsIndex,objectIdField:e.objectIdField,globalIdField:e.globalIdField,featureOrIdentifierList:r};for(const f of t){if(f.error!=null)continue;const l=f.objectId??-1,d=f.globalId,c=(l===-1||o?le(l,d,s):null)??{feature:null,oid:l,gid:d},u={oid:l===-1?c.oid:l,gid:d??c.gid,feature:c.feature,result:f};a.push(u);const p=u.gid?S(u.gid):null;if(u.oid===-1&&p!=null&&i!=null&&(u.oid=i.get(p)??-1),u.oid===-1&&p!=null){let y=n.get(p);y==null&&(y={gid:u.gid,edits:[]},n.set(p,y)),y.edits.push(u)}}return a}async function Fe(e,t){const r=new Map,n=L(e,t.addedFeatures,t.edits?.addFeatures,r),i=L(e,t.updatedFeatures,t.edits?.updateFeatures,r),o=L(e,t.deletedFeatures,t.edits?.deleteFeatures,r,t.globalIdToObjectId,!1);return r.size>0&&await ae(e,r),{adds:n.filter((a=>a.oid!==-1)),updates:i.filter((a=>a.oid!==-1)),deletes:o.filter((a=>a.oid!==-1))}}async function ae(e,t){const r=e.i3sOverrides.layer.associatedLayer;if(r?.globalIdField==null)return;const n=r.createQuery(),{objectIdField:i,globalIdField:o}=r;n.where=Array.from(t.values()).map((({gid:f})=>`${o}='${f}'`)).join(" OR "),n.returnGeometry=!1,n.outFields=[i,o],n.cacheHint=!1;const a=await q(P(r,n));if(!a.ok)return;const s=a.value.features;for(const f of s){const l=f.attributes[o],d=f.attributes[i];if(l==null||d==null||d===-1)continue;const c=t.get(S(l));if(c!=null)for(const u of c.edits)u.oid=d}}function Ie(e,t){const r=new Map,n=i=>{for(const{oid:o,feature:a}of i){const s=a?.geometry;s?.type==="mesh"&&r.set(o,s)}};n(t.adds),n(t.updates);for(const i of t.deletes)r.set(i.oid,null);for(const[i,o]of r)e.i3sOverrides.updateGeometry(i,o)}function we(e,t){const r=de(e,t),n=ue(e,t);if(r.size===0&&n.size===0)return;const i=new Map;for(let u=0;u<e.attributeStorageInfo.length;u++)i.set(e.attributeStorageInfo[u].name,u);let o=!1;r.forEach(((u,p)=>{const y=e.getAttributeData(p);let F=!1;u.forEach(((E,b)=>{const x=y!=null?y[b]:null,A=i.get(b);for(const{featureIndex:_,value:v,featureId:k}of E)x&&(x[_]=v,F=!0,o=!0),e.i3sOverrides.updateAttributeValue(k,A,v)})),F&&e.setAttributeData(p,y,null)})),o&&e.clearMemCache();const{fieldsIndex:a,i3sOverrides:s,objectIdField:f,globalIdField:l}=e,d=s.layer.associatedLayer?.infoFor3D,c=new Set(d?[...Object.values(d.assetMapFieldRoles),...Object.values(d.transformFieldRoles)]:[]);for(const[u,p]of n){s.featureAdded(u);const{attributes:y}=p;for(const F in y){if(F!==f&&F!==l&&c.has(F))continue;const E=a.normalizeFieldName(F),b=E!=null?i.get(E):null;if(b==null)continue;const x=y[F];s.updateAttributeValue(u,b,x)}}}function ue(e,t){const r=new Map,n=t.adds;if(!n||n.length===0||e.globalIdField==null)return r;for(const i of n){const o=i.oid,a=i.feature;a?.geometry?.type==="mesh"&&r.set(o,a)}return r}function de(e,t){const r=t.updates;if(!r||r.length===0)return new M;const n=new M,i=new Map;for(let o=0;o<e.attributeStorageInfo.length;o++)i.set(e.attributeStorageInfo[o].name,o);return e.forEachNode(((o,a)=>{for(const s of r){if(s.feature==null)continue;const f=s.feature,l=s.oid,d=a.indexOf(l);for(const c in f.attributes){const u=e.fieldsIndex.normalizeFieldName(c),p=ce(n,o.index,u),y=f.attributes[c];p.push({featureIndex:d,featureId:l,value:y})}}})),n}function ce(e,t,r){const n=fe(e,t),i=r!=null&&n.get(r);if(i)return i;const o=new Array;return n.set(r,o),o}function fe(e,t){const r=e.get(t);if(r)return r;const n=new ge;return e.set(t,n),n}(function(e){e[e.EDITING=0]="EDITING",e[e.ROLLED_BACK=1]="ROLLED_BACK",e[e.COMMITTED=2]="COMMITTED"})(w||(w={}));const ge=Map,M=Map;function Ee(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return e.outFields?N(t,[...V(t,e.outFields),...r]):N(t,r)}}}}const C=e=>{let t=class extends e{constructor(){super(...arguments),this._numUpdating=0}get updating(){return this._numUpdating>0}autoUpdateAsync(r,n){const i=K((async o=>{++this._numUpdating;try{const a=await o;this.destroyed||this._set(r,a)}catch{O.getLogger(this).warn(`Async update of "${String(r)}" failed. Async update functions should not throw exceptions.`)}--this._numUpdating}));return G(n,i,z)}};return g([m({readOnly:!0})],t.prototype,"updating",null),g([m()],t.prototype,"_numUpdating",void 0),t=g([$("esri.core.AsyncUpdate")],t),t};let D=class extends C(U){};D=g([$("esri.core.AsyncUpdate")],D);let I=class extends C(U){get layer(){return this.layerView.layer}get requiredFields(){const{layerView:{layer:{fieldsIndex:e},definitionExpressionFields:t},rendererFields:r,labelingFields:n,viewFilterFields:i}=this;return N(e,[...t??[],...r??[],...n??[],...i??[]])}constructor(e){super(e)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",(async()=>{const{fieldsIndex:e,renderer:t}=this.layer;return t?this._getFieldsAsync((r=>t.collectRequiredFields(r,e))):null})),this.autoUpdateAsync("labelingFields",(async()=>{const{layer:e}=this;return e.labelsVisible?this._getFieldsAsync((t=>B(t,e))):null})),this.autoUpdateAsync("viewFilterFields",(()=>{const{layer:e,mergedFilter:t}=this.layerView;return this._getFieldsAsync((r=>Q(r,e,t)))}))])}async _getFieldsAsync(e){const t=new Set;try{return await e(t),Array.from(t).sort()}catch(r){return O.getLogger(this).error(r),null}}};g([m()],I.prototype,"layerView",void 0),g([m()],I.prototype,"layer",null),g([m()],I.prototype,"requiredFields",null),g([m()],I.prototype,"rendererFields",void 0),g([m()],I.prototype,"labelingFields",void 0),g([m()],I.prototype,"viewFilterFields",void 0),I=g([$("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],I);let h=class extends H{constructor(){super(...arguments),this.layer=null,this.filter=null,this._geometryEngine=null,this._projectionEngineLoaded=!1,this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){throw new Error("Not implemented")}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return ne(this._layerFilter)}get _layerFilter(){const e=this.layer?.filter;if(e==null||e.geometries.length<1)return null;const t=this._geometryEngine;if(t==null||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return ie;const r=e.geometries.at(0).spatialReference,n=e.geometries.toArray().map((s=>{try{s=t.simplify(s)}catch{return O.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(s==null)return null;if(s.spatialReference.equals(r))return s;try{return W(s,r)}catch{return O.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}})).filter(te).sort(((s,f)=>s.extent.xmin-f.extent.xmin)),i=new Set,o=new Array,a=new Array;for(let s of n){const f=s.extent.xmin;if(o.length=0,i.forEach((l=>{if(f>=l.extent.xmax)return a.push(l),void i.delete(l);s.extent.ymin<=l.extent.ymax&&s.extent.ymax>=l.extent.ymin&&t.intersects(s,l)&&o.push(l)})),o.length>0){o.push(s);try{s=t.union(o)}catch{O.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}o.pop(),o.forEach((l=>i.delete(l)))}i.add(s)}return i.forEach((s=>a.push(s))),a.length>0?{spatialRelationship:e.spatialRelationship,geometries:a}:null}get _filterNeedsProjectionEngine(){const e=this.layer.filter;if(e==null||e.geometries.length<=1)return!1;const t=e.geometries.at(0).spatialReference;return e.geometries.some((({spatialReference:r})=>!r.equals(t)&&!X(r,t)))}get layerFilterUpdating(){return oe(this._layerFilter)}initialize(){const{signal:e}=this._abortController;j((()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length),e).then((async()=>{T(e),this._geometryEngine=await re(()=>import("./chunk-GEzYIl-R.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]))})).catch(R),this._projectionEngineLoaded=Y(),j((()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine),e).then((async()=>{T(e),await J(),this._projectionEngineLoaded=!0})).catch(R)}destroy(){this._abortController=Z(this._abortController)}highlight(e){throw new Error("Not implemented")}queryFeatures(e,t){throw new Error("Not implemented")}queryObjectIds(e,t){throw new Error("Not implemented")}queryFeatureCount(e,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,t){throw new Error("Not implemented")}};g([m()],h.prototype,"layer",void 0),g([m()],h.prototype,"availableFields",null),g([m()],h.prototype,"maximumNumberOfFeatures",null),g([m({readOnly:!0})],h.prototype,"maximumNumberOfFeaturesExceeded",null),g([m()],h.prototype,"filter",void 0),g([m({readOnly:!0})],h.prototype,"layerFilter",null),g([m({readOnly:!0})],h.prototype,"_layerFilter",null),g([m()],h.prototype,"_geometryEngine",void 0),g([m()],h.prototype,"_projectionEngineLoaded",void 0),g([m()],h.prototype,"_filterNeedsProjectionEngine",null),g([m()],h.prototype,"layerFilterUpdating",null),h=g([$("esri.views.layers.SceneLayerView")],h);export{I as a,Fe as b,we as c,h as d,Ie as f,Ee as i,be as s};
