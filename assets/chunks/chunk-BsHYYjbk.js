import{af as i,ag as n,ai as S,gA as j,gB as x,s as O,g9 as P,gC as L,gD as $,t as A,ga as C,gE as s,gF as _}from"./chunk-CuaFhuP3.js";import"./chunk-Dpk1TJd9.js";import{i as D}from"./chunk-PM-0Myzz.js";const k=E=>{let t=class extends E{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return D(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?j(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(l){try{return!this.layer.loaded||!!x(this.layer.serviceRasterInfo,l)}catch{return!1}}async fetchPopupFeaturesAtLocation(l,f){const{layer:e}=this;if(!l)throw new O("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:w}=e,R=P(e,f);if(!w||R==null)return[];const d=[],{value:o,magdirValue:h,processedValue:T}=await e.identify(l,{timeExtent:this.timeExtent,signal:f?.signal});let c="";if(o?.length){c=e.type==="imagery-tile"&&e.hasStandardTime()&&o[0]!=null?o.map((y=>e.getStandardTimeValue(y))).join(", "):o.join(", ");const r={ObjectId:0};r[s.servicePixelValue]=e.type==="imagery-tile"&&L(e.raster)?T?.join(", "):c,r[s.rawServicePixelValue]=c;const m=e.raster?.rasterInfo??e.serviceRasterInfo,p=m?.attributeTable;if(p!=null){const{fields:y,features:V}=p,v=y.find((({name:a})=>a.toLowerCase()==="value")),F=r[s.servicePixelValue],u=v?V.find((a=>String(a.attributes[v.name])===F)):null;if(u)for(const a in u.attributes)u.attributes.hasOwnProperty(a)&&(r[_+a]=u.attributes[a])}const g=m?.dataType;g!=="vector-magdir"&&g!=="vector-uv"||(r[s.magnitude]=h?.[0],r[s.direction]=h?.[1]);const{multidimensionalDefinition:b}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});$(e.rasterFields,r,b);const I=new A({geometry:this.fullExtent?.clone(),attributes:r,layer:e,sourceLayer:e});d.push(I)}return d}async getSourceScale(){return await this.layer.load(),C(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return x(this.layer.serviceRasterInfo,this.view.spatialReference)}};return i([n()],t.prototype,"fullExtent",null),i([n()],t.prototype,"layer",void 0),i([n({readOnly:!0})],t.prototype,"timeExtent",null),i([n()],t.prototype,"tileInfo",void 0),i([n({readOnly:!0})],t.prototype,"hasTilingEffects",null),i([n()],t.prototype,"datumTransformation",null),t=i([S("esri.views.layers.ImageryTileLayerView")],t),t};export{k as f};
