import{eQ as D,xP as Ue,GI as Ye,GJ as Ze,bR as J,GK as Te,GL as $e,GM as ze,GN as Je,GO as Qe,GP as Ke,GQ as et,GR as tt,oA as st,GS as rt,GT as at,p5 as nt,GU as it,GV as ot,GW as ct,j5 as T,GX as lt,j4 as dt,j8 as Oe,kq as ut,rv as Ne,rw as gt,yp as ht,pq as Ve,b9 as ft,jh as pt,dE as M,nV as l,bs as bt,ye as we,sT as je,GY as oe,rF as mt,b$ as Ie,nW as f,A$ as _t,Y as Tt,GZ as $t,xQ as se,bv as Q,d0 as b,xm as ge,rM as F,iD as He,iI as k,d2 as R,yq as We,dG as Ot,c$ as w,rE as N,rH as wt,Dp as It,fo as x,G_ as ce,G$ as At,H0 as Ct,lx as Et,xB as De,fn as C,bA as Pt,xf as he,jj as W,yn as vt,aP as fe,aw as pe,aA as E,c_ as v,xk as m,ym as L,xl as _,yr as ke,xx as Rt,xv as Fe,bP as Mt,bS as Ae,xn as X,jb as Y,bh as K,yo as Ce,q8 as Ee,hC as ne,hB as Pe,H1 as ve,H2 as Re,xD as Me,Dm as xt}from"./chunk-DM6Pdl6C.js";import{j as St,g as Gt,u as xe,v as Lt,C as z,e as yt,i as Se,b as Ut,d as Ge,s as Nt,k as Vt,q as jt,n as Be,x as le,U as Ht,S as Wt,l as Dt,a as kt,c as Ft}from"./chunk-BxBXNXx2.js";import{I as Bt}from"./chunk-BtqJ1NFA.js";import{d as qt,r as Xt}from"./chunk-BDP5dvQ0.js";import{f as Yt}from"./chunk-BW2E32-A.js";import{_ as Zt}from"./chunk-xyJqyGK2.js";const zt=D(0,0,0,.04);function Jt({accentColor:e}){return Ue(e,.5)}function Qt({accentColor:e}){return Ue(e,.7)}function qe(e){const t=new Ye,{vertex:i,fragment:a,attributes:r,varyings:n}=t;return Ze(i,e),r.add(J.POSITION,"vec3"),r.add(J.UV0,"vec2"),n.add("vUV","vec2"),i.main.add(Te`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),a.uniforms.add(new $e("backgroundColor",s=>s.backgroundColor),new $e("gridColor",s=>s.gridColor),new ze("gridWidth",s=>s.gridWidth)).main.add(Te`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}const Kt=Object.freeze(Object.defineProperty({__proto__:null,build:qe},Symbol.toStringTag,{value:"Module"}));class es extends Je{constructor(){super(...arguments),this.backgroundColor=D(1,0,0,.5),this.gridColor=D(0,1,0,.5),this.gridWidth=4}}let ts=class extends Qe{constructor(t,i){super(t,i,new Ke(Kt,()=>Zt(()=>Promise.resolve().then(()=>bs),void 0)))}initializePipeline(){return et({blending:rt,depthTest:{func:st.LESS},colorWrite:tt})}},ss=class extends at{constructor(t){super(t,as),this.produces=new Map([[nt.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,i=>it(i)]])}get visible(){return!0}createGLMaterial(t){return new rs(t)}createBufferWriter(){return new ot(Yt)}getConfiguration(){return ct}};class rs extends lt{constructor(t){super(t)}beginSlot(t){return this.getTechnique(ts,t)}}class as extends es{constructor(){super(...arguments),this.renderOccluded=T.Occlude,this.isDecoration=!1}}class ns extends dt{constructor(t){super(t),this._material=null,this._renderOccluded=T.OccludeAndTransparent,this._gridWidth=1,this._gridColor=D(1,0,0,1),this._backgroundColor=D(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){Oe(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){Oe(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new ss(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){this._material!=null&&t(this._material)}createGeometries(t){if(this._material!=null){const i=ut(this._material);t.addGeometry(i)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this._material!=null&&this._material.setParameters(this._materialParameters)}}function Cs(e,t,i,a,r,n,s,o){return is(t,s.worldUpAtPosition(e,l.get()),r,n,o.basis1,o.basis2),f(o.basis1,o.basis1,i),f(o.basis2,o.basis2,a),R(o.origin,e),je(o.basis2,o.basis1,o.origin,o.plane),o}function is(e,t,i,a,r,n){const s=N(e,t),o=l.get(),d=l.get();switch(a===P.HORIZONTAL_OR_VERTICAL?Math.abs(s)>yt?P.HORIZONTAL:P.VERTICAL:a){case P.VERTICAL:{const c=Math.abs(s)<=Se?e:i.viewUp;C(o,c,t),R(d,t);break}case P.HORIZONTAL:C(o,i.viewUp,t),C(d,t,o);break;case P.TILTED:{const c=Math.abs(s)<=Se?t:i.viewUp;C(o,c,e),C(d,e,o);break}}const u=C(l.get(),o,d);N(u,i.viewForward)>0&&f(d,d,-1),x(r,o),x(n,d)}function os(e,t,i){const a=t.worldUpAtPosition(e.origin,l.get()),r=e.basis1,n=_e(e,a),s=Math.round(n/V)*V;return oe(e,s-n,r,i)}function Es(e,t,i,a,r,n){const s=R(l.get(),r.origin);b(s,s,f(l.get(),r.basis1,e.direction[0]<0?1:-1)),b(s,s,f(l.get(),r.basis2,e.direction[1]<0?1:-1));const o=M(r.basis1),d=M(r.basis2),u=w(l.get(),i,s),c=w(l.get(),t,s);let g=0,h=0;if(me(e)){const re=de(r),j=de(n);g=o-.5*e.direction[0]*N(r.basis1,c)/o,h=d-.5*e.direction[1]*N(r.basis2,c)/d;const B=j/re;g*=B,h*=B}const p=g+.5*e.direction[0]*N(r.basis1,u)/o,O=h+.5*e.direction[1]*N(r.basis2,u)/d,y=f(l.get(),r.basis1,p/o),S=f(l.get(),r.basis2,O/d);(p<=0||Le(n.origin,y,a)<=xe)&&R(y,n.basis1),(O<=0||Le(n.origin,S,a)<=xe)&&R(S,n.basis2);const $=R(l.get(),s);return b($,$,f(l.get(),y,e.direction[0]<0?-1:1)),b($,$,f(l.get(),S,e.direction[1]<0?-1:1)),wt($,y,S,n)}function Ps(e,t){return Lt*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function vs(e,t,i,a){const r=C(l.get(),t,i);return C(r,r,t),We(e,r,a)}function Rs(e,t){return ht(e.basis1,e.basis2,e.origin,t)}function Ms(e,t,i,a){const r=t.worldUpAtPosition(e.origin,l.get()),n=l.get();switch(i){case ee.HEADING:R(n,r);break;case ee.TILT:R(n,e.basis1)}return We(e.origin,n,a)}function xs(e,t,i,a){const r=be(i,I.NEGATIVE_X),n=F.get();It(n,t,r.edge*Math.PI/2);const s=x(l.get(),r.basis);let o=f(l.get(),s,r.direction*a.computeScreenPixelSizeAt(r.position)*z);b(o,o,r.position);const d=a.projectToRenderScreen(o,ce(l.get())),u=cs(a,d);At(a,d,Z),x(Z.direction,Z.direction);const c=l.get();!u&&Ct(i,Z,c)&&(o=c),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=Et(o),u?e.state|=te:e.state&=~te}function cs(e,t){const[i,a,r,n]=e.viewport,s=Math.min(r,n)/16;let o=!0;return t[0]<i+s?(t[0]=i+s,o=!1):t[0]>i+r-s&&(t[0]=i+r-s,o=!1),t[1]<a+s?(t[1]=a+s,o=!1):t[1]>a+n-s&&(t[1]=a+n-s,o=!1),o}function Ss(e,t,i,a){const r=M(a.basis1),n=M(a.basis2),s=Xe(a),o=de(a),d=Q(l.get(),0,0,0);b(d,f(l.get(),a.basis1,t.direction[0]),f(l.get(),a.basis2,t.direction[1])),b(d,a.origin,d);let u=0,c=1;if(me(t))t.direction[0]===1&&t.direction[1]===-1?u=V:t.direction[0]===1&&t.direction[1]===1?u=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(u=3*Math.PI/2),c=o;else{const h=t.direction[0]!==0?1:2;u=h===1?V:0,c=(h===1?n:r)-s}const g=ge(F.get(),u);He(g,g,Q(l.get(),c,c,c)),k(g,i,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=d}function Gs(e,t,i,a){const r=a.worldUpAtPosition(i.origin,l.get()),n=be(i,I.POSITIVE_X),s=ge(F.get(),n.edge*Math.PI/2);De(s,s,-_e(i,r)),k(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=n.position}function Ls(e,t,i){const a=be(i,I.POSITIVE_Y),r=ge(F.get(),a.edge*Math.PI/2);De(r,r,V),k(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=a.position}var I;function be(e,t){switch(t){case I.POSITIVE_X:return{basis:e.basis1,direction:1,position:b(l.get(),e.origin,e.basis1),edge:t};case I.POSITIVE_Y:return{basis:e.basis2,direction:1,position:b(l.get(),e.origin,e.basis2),edge:t};case I.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:w(l.get(),e.origin,e.basis1),edge:t};case I.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:w(l.get(),e.origin,e.basis2),edge:t}}}function Le(e,t,i){const a=i.projectToRenderScreen(b(l.get(),e,t),ce(l.get())),r=i.projectToRenderScreen(w(l.get(),e,t),ce(l.get()));return Pt(w(a,a,r))}function Xe(e){const t=M(e.basis1),i=M(e.basis2);return Gt*Math.min(t,i)}function de(e){return Xe(e)}function me(e){return e.direction[0]!==0&&e.direction[1]!==0}function ys(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new qt({view:e,attached:!1,color:Qt(e.effectiveTheme),width:St,renderOccluded:T.OccludeAndTransparent,geometry:[t],isDecoration:!0})}function Us(e){return new ns({view:e,attached:!1,backgroundColor:zt,gridColor:Jt(e.effectiveTheme),gridWidth:4,renderOccluded:T.OccludeAndTransparent,isDecoration:!0})}function Ns(e,t,i,a=new gt){if(e==null)return null;const{renderCoordsHelper:r}=t,n=r.fromRenderCoords(e.origin,new ft({spatialReference:t.spatialReference}));if(n==null)return null;const s=pt(n,i);if(s==null)return null;a.position=s;const o=2*M(e.basis1),d=2*M(e.basis2),u=Ve.renderUnitScaleFactor(t.spatialReference,i);a.width=o*u,a.height=d*u;const c=r.worldUpAtPosition(e.origin,l.get());return a.tilt=bt(_e(e,c)),a.heading=r.headingAtPosition(e.origin,e.basis1)-90,a}function _e(e,t){return $t(t,e.basis2,e.basis1)+V}function ls(e,t,i,a,r,n,s=Ne()){return n.toRenderCoords(e,s.origin)?(n.worldBasisAtPosition(s.origin,we.X,s.basis1),n.worldBasisAtPosition(s.origin,we.Y,s.basis2),je(s.basis2,s.basis1,s.origin,s.plane),oe(s,-Ie(t),mt(s),s),oe(s,Ie(i),s.basis1,s),f(s.basis1,s.basis1,a/2),f(s.basis2,s.basis2,r/2),_t(s),s):(Tt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Vs(e,t){if(e?.position==null)return null;const i=Xt(e.position,t.spatialReference,t.elevationProvider);if(i==null)return null;const a=Ve.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),r=e.width*a,n=e.height*a;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:r,renderHeight:n}}function js(e,t,i,a=Ne()){if(e==null)return null;const r=ls(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return i.tiltEnabled||r==null||os(r,t.renderCoordsHelper,r),r}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(I||(I={}));const A=se.Custom1;var ee,P;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(ee||(ee={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(P||(P={}));const te=se.Custom2,Z=Ot(),V=Math.PI/2,ie=se.Custom1,ds=se.Custom2;function Hs(e){return(e.type==="building-scene-3d"?e:null)!=null}let Ws=class extends he{constructor(t,i){const a=me(i),r=a?Ut:Ge,n=r*Nt,s=Ge,o={renderOccluded:T.OccludeAndTransparent,isDecoration:!0},d=new W({...o,width:r}),u=new W({...o,width:n}),c=new W({...o,width:s});super({view:t,...vt,...us({isCorner:a,unfocusedMaterial:d,focusedMaterial:u,outlineMaterial:c})}),this._themeHandle=fe(()=>t.effectiveTheme.accentColor,g=>{const h=E.toUnitRGBA(g);d.setParameters({color:h}),u.setParameters({color:h}),c.setParameters({color:h})},pe)}destroy(){this._themeHandle.remove(),super.destroy()}};function us({isCorner:e,unfocusedMaterial:t,focusedMaterial:i,outlineMaterial:a}){const r=e?[v(1,0,0),v(0,0,0),v(0,1,0)]:[v(1,0,0),v(-1,0,0)];return{renderObjects:[new m(L(t,r),_.Unfocused|ie),new m(L(i,r),_.Focused|ie),new m(L(a,r),ds)],collisionType:{type:"line",paths:[r]},radius:e?Vt:jt,state:ie}}class ks extends he{constructor(t,i){const a=new Bt({writeDepth:!1,renderOccluded:T.Opaque,isDecoration:!0}),r=ke.calloutWidth,n=new W({width:r,renderOccluded:T.OccludeAndTransparent,isDecoration:!0});super({view:t,...gs({imageMaterial:a,calloutMaterial:n})}),this._currentTexture=null,this._themeHandle=fe(()=>t.effectiveTheme.accentColor,s=>{const o=Rt(s,.5),d=Fe(s),u=this._currentTexture,c=i(o,d);a.setParameters({textureId:c.texture.id}),n.setParameters({color:E.toUnitRGBA(s)}),this._currentTexture=c,u?.release()},pe)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}}function gs({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:i,calloutLength:a,discRadius:r}=ke,n=r*i,s=(c,g)=>{const h=[0,1,2,2,3,0];return new Mt(g,[[J.POSITION,new Ae([a-c,-c,0,a+c,-c,0,a+c,c,0,a-c,c,0],h,3,!0)],[J.UV0,new Ae([0,0,1,0,1,1,0,1],h,2,!0)]])},o=L(t,[[0,0,0],[a-r,0,0]]),d=L(t,[[0,0,0],[a-n,0,0]]),u=A;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},focusMultiplier:i,radius:r,renderObjects:[new m(s(r,e),_.Unfocused|u),new m(o,_.Unfocused|u),new m(s(n,e),_.Focused|u),new m(d,_.Focused|u)],state:u}}var ue;(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(ue||(ue={}));class Fs extends he{constructor(t,i){const a=new W({width:1,renderOccluded:T.OccludeAndTransparent,isDecoration:!0}),r=new X({cullFace:Y.Back,renderOccluded:T.Opaque,isDecoration:!0}),n=new X({cullFace:Y.Back,renderOccluded:T.Opaque,isDecoration:!0}),s=new X({cullFace:Y.Back,renderOccluded:T.Opaque,isDecoration:!0}),o=new X({writeDepth:!1,cullFace:Y.Front,renderOccluded:T.Transparent,isDecoration:!0});super({view:t,...hs({offsetMode:i,tubeMaterial:r,tipMaterial:n,capMaterial:s,outlineMaterial:o,calloutMaterial:a})}),this._themeHandle=fe(()=>t.effectiveTheme.accentColor,d=>{const u=Fe(d),c=E.toUnitRGBA(d),g=E.toUnitRGBA(u),h=E.toUnitRGBA(E.blendColors(u,d,.4)),p=E.toUnitRGBA(E.blendColors(u,d,.14));a.setParameters({color:c}),r.setParameters({color:p}),n.setParameters({color:g}),s.setParameters({color:h}),o.setParameters({color:c})},pe)}destroy(){this._themeHandle.remove(),super.destroy()}}function hs({offsetMode:e,tubeMaterial:t,tipMaterial:i,capMaterial:a,outlineMaterial:r,calloutMaterial:n}){const s=e===ue.CENTER_ON_CALLOUT?z:0,o=[v(s,0,-24),v(s,0,Wt/2)],d=ps(o),u=ye({vertices:o,padding:0,materials:{tube:t,tip:i,cap:a}}),c=ye({vertices:o,padding:Ht,materials:{tube:r,tip:r,cap:r}}),g=L(n,[[s,0,0],[s-z,0,0]]),h=L(n,[[s,0,0],[s-z,0,0]]);return{renderObjects:[...u.normal.map(p=>new m(p,_.Unfocused|A)),...c.normal.map(p=>new m(p,_.Unfocused|A)),new m(g,_.Unfocused|A|te),...u.focused.map(p=>new m(p,_.Focused|A)),...c.focused.map(p=>new m(p,_.Focused|A)),new m(h,_.Focused|A|te)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[d]},collisionPriority:1,radius:Be,state:A}}function ye({vertices:e,padding:t,materials:i}){const a=r=>{const n=e.slice(),s=w(l.get(),n[0],n[1]);x(s,s);const o=w(l.get(),n[n.length-1],n[n.length-2]);if(x(o,o),t>0){const H=f(K(),o,-t);n[n.length-1]=b(H,H,n[n.length-1]);const U=f(K(),s,-t);n[0]=b(U,U,n[0])}const d=r?Ft:1,u=le*d,c=Be*d,g=Ce(F.get());if(t>0){const H=u/4,U=Q(l.get(),0,H,0),q=1+t/H;Ee(g,g,U),He(g,g,Q(l.get(),q,q,q)),Ee(g,g,f(U,U,-1/q))}const h=Ce(ne()),p=v(0,1,0),O=Pe(ne(),ve(Re.get(),p,o));O[12]=n[n.length-1][0],O[13]=n[n.length-1][1],O[14]=n[n.length-1][2],k(O,O,g);const y=i.tube,S=fs(Dt*(r?kt:1)+t,n,y);S.transformation=h;const $=[S],re=i.tip,j=Me(re,u,c,24,!1,!1,!0);j.transformation=O,$.push(j);const B=i.cap,ae=Me(B,u,c,24,!1,!0,!1);ae.transformation=O,$.push(ae);const G=Pe(ne(),ve(Re.get(),p,s));return G[12]=n[0][0],G[13]=n[0][1],G[14]=n[0][2],k(G,G,g),$.push(j.instantiate({transformation:G})),$.push(ae.instantiate({transformation:G})),$};return{normal:a(!1),focused:a(!0)}}function fs(e,t,i){const a=[];for(let n=0;n<12;n++){const s=n/12*2*Math.PI;a.push([Math.cos(s)*e,Math.sin(s)*e])}return xt(i,a,t,[],[],!1)}function ps(e,t){const i=w(K(),e[e.length-1],e[e.length-2]);x(i,i),f(i,i,le),b(i,i,e[e.length-1]);{const a=w(K(),e[0],e[1]);return x(a,a),f(a,a,le),b(a,a,e[0]),[a,...e,i]}}const bs=Object.freeze(Object.defineProperty({__proto__:null,build:qe},Symbol.toStringTag,{value:"Module"}));export{ys as A,A as C,me as E,ue as H,Fs as I,Vs as L,P as M,Ns as R,te as S,ds as U,js as V,ee as _,Ss as a,Qt as b,Rs as c,vs as d,Cs as e,Jt as f,ks as g,de as h,ie as i,Us as j,Ms as l,Gs as m,Ls as p,Es as r,Ps as s,zt as t,xs as u,Ws as v,Hs as x};
